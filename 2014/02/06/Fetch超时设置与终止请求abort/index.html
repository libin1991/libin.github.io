<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="fetch请求和ajax请求   fetch与ajax（XMLHttpRequest）相比 ES6中新增了一种HTTP数据请求的方式，就是fetch，它和XMLHttpRequest有许多相似的功能，但是相比XMLHttpRequest,fetch被设计成更具可扩展性和高效性。江湖上一直流传着 “传统ajax已死，fetch永生”的说法，下面详细说下二者  1234567891011121314r">
<meta property="og:type" content="article">
<meta property="og:title" content="Fetch超时设置与终止请求abort">
<meta property="og:url" content="http://yoursite.com/2014/02/06/Fetch超时设置与终止请求abort/index.html">
<meta property="og:site_name" content="啷哩咯啷">
<meta property="og:description" content="fetch请求和ajax请求   fetch与ajax（XMLHttpRequest）相比 ES6中新增了一种HTTP数据请求的方式，就是fetch，它和XMLHttpRequest有许多相似的功能，但是相比XMLHttpRequest,fetch被设计成更具可扩展性和高效性。江湖上一直流传着 “传统ajax已死，fetch永生”的说法，下面详细说下二者  1234567891011121314r">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2020-02-06T13:53:16.511Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Fetch超时设置与终止请求abort">
<meta name="twitter:description" content="fetch请求和ajax请求   fetch与ajax（XMLHttpRequest）相比 ES6中新增了一种HTTP数据请求的方式，就是fetch，它和XMLHttpRequest有许多相似的功能，但是相比XMLHttpRequest,fetch被设计成更具可扩展性和高效性。江湖上一直流传着 “传统ajax已死，fetch永生”的说法，下面详细说下二者  1234567891011121314r">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2014/02/06/Fetch超时设置与终止请求abort/">





  <title>Fetch超时设置与终止请求abort | 啷哩咯啷</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband">
    	<div class="eevee"><div class="body"><div class="head"><div class="ears"><div class="ear"><div class="lobe"></div></div><div class="ear"><div class="lobe"></div></div></div><div class="face"><div class="eyes"><div class="eye"><div class="eyelid"></div></div><div class="eye"><div class="eyelid"></div></div></div><div class="nose"></div><div class="mouth"></div></div></div><div class="chest"><div class="fur"><div class="patch"></div></div><div class="fur"><div class="patch"></div></div><div class="fur"><div class="patch"></div></div></div><div class="legs"><div class="leg"><div class="inner-leg"></div></div><div class="leg"><div class="inner-leg"></div></div><div class="leg"><div class="inner-leg"></div></div><div class="leg"><div class="inner-leg"></div></div></div><div class="tail"><div class="tail"><div class="tail"><div class="tail"><div class="tail"><div class="tail -end"></div></div></div></div></div></div></div></div>
    </div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
    	<div id="sky">
				<div id="background" class="container">
			<!-- svg file -->
			<svg id="svgout" height="100%" width="100%" viewbox="0 0 550 400">
				<defs>
					<g id="bottomShadow">
						<path fill="#000000" stroke="none" d="
		M 270.5 225.95
		L 127.35 316.65 266.8 400 409.6 309.25 270.5 225.95 Z"/>
					</g>
					<g id="Layer52_0_FILL">
						<path class="topGrass" fill="#B9D668" stroke="none" d="
	M 397.85 229.3
	L 397.85 225.6 269.85 152 135.75 228.6 135.75 233.65 262.1 306.55 397.85 229.3 Z"/>
					</g>
					<g id="Layer51_0_FILL">
						<path class="leftSideGrass" fill="#6E9E4F" stroke="none" d="
	M 135.1 229.95
	L 135.1 256.85 262.1 328.4 262.1 301.85 135.1 229.95 Z"/>
					</g>
					<g id="Layer50_0_FILL">
						<path class="rightGrassTop" fill="#8CB154" stroke="none" d="
	M 397.85 225.95
	L 395.8 225.95 261.75 301.55 261.75 328.4 397.85 251.15 397.85 225.95 Z"/>
					</g>
					<g id="Layer48_0_FILL">
						<path class="crustLeftTop" fill="#955541" stroke="none" d="
	M 135.45 282.4
	L 135.75 298.15 262.1 372.1 261.75 355.65 135.45 282.4 Z"/>
					</g>
					<g id="Layer47_0_FILL">
						<path class="middleLeftCrust" fill="#C77E61" stroke="none" d="
	M 135.1 270.3
	L 135.1 283.05 275.9 364.35 271.85 348.9 135.1 270.3 Z"/>
					</g>
					<g id="Layer46_0_FILL">
						<path class="crustLeftTop" fill="#955541" stroke="none" d="
	M 135.1 255.15
	L 135.1 270.3 262.1 343.55 262.1 328.05 135.1 255.15 Z"/>
					</g>
					<g id="Layer45_0_FILL">
						<path class="topRightCrust" fill="#A47237" stroke="none" d="
	M 397.5 294.5
	L 397.5 277 261.75 355.3 261.75 372.75 397.5 294.5 Z"/>
					</g>
					<g id="Layer44_0_FILL">
						<path class="middleRightCrust" fill="#C89451" stroke="none" d="
	M 397.5 269.95
	L 397.15 266.6 262.1 343.2 262.1 355.95 397.5 279.7 397.5 269.95 Z"/>
					</g>
					<g id="Layer43_0_FILL">
						<path class="topRightCrust" fill="#A47237" stroke="none" d="
	M 397.5 266.6
	L 397.5 250.45 261.75 328.4 261.75 343.85 397.5 266.6 Z"/>
					</g>
					<g id="Layer41_0_FILL">
						<path class="greyRoad" fill="#B2B2B1" stroke="none" d="
	M 295.05 283.05
	Q 299.05 280.35 308.45 275.3 317.85 269.95 323.6 266.9
	L 268.8 233.65 338.05 191.35 309.15 174.55 177.75 254.5
	Q 191.55 262.2 198.25 266.25 204.65 269.95 209.7 271.95
	L 241.6 250.45 295.05 283.05 Z"/>
					</g>
					<g id="Layer40_0_FILL">
						<path fill="#FFFFFF" stroke="none" d="
	M 199.95 256.85
	Q 194.55 261.2 191.9 262.2
	L 194.9 263.9 200.95 259.2 199.95 256.85
	M 225.8 243.75
	L 224.8 241.75 211.05 250.8 212.05 252.8 225.8 243.75
	M 308.15 275.65
	L 296.7 266.6 295.35 268.6 306.8 277.7 308.15 275.65
	M 275.9 253.5
	L 274.55 255.5 285.95 264.55 287.3 262.55 275.9 253.5
	M 251.7 227.3
	L 250.7 225.25 236.9 234.35 237.9 236.35 251.7 227.3
	M 257.05 240.7
	L 254.05 240.7 268.8 249.8 269.5 247.75 257.05 240.7
	M 277.2 207.8
	L 263.45 216.85 264.45 218.9 278.25 209.8 277.2 207.8
	M 305.1 192.65
	L 304.1 190.65 290.3 199.75 291.35 201.75 305.1 192.65 Z"/>
					</g>
					<g id="Layer38_0_FILL">
						<path class="frontFascia" fill="#ECB27B" stroke="none" d="
	M 359.25 187.95
	L 346.4 174.95 333.85 202.9 359.25 187.95 Z"/>
					</g>
					<g id="Layer37_0_FILL">
						<path class="frontWall" fill="#EFA258" stroke="none" d="
	M 334 201.05
	L 334.35 232 359.2 217.55 359.25 187.95 334 201.05 Z"/>
					</g>
					<g id="Layer36_0_FILL">
						<path class="leftWall" fill="#C57F42" stroke="none" d="
	M 334.35 232.3
	L 334.35 205.1 305.1 191.35 305.1 216.85 334.35 232.3 Z"/>
					</g>
					<g id="Layer35_0_FILL">
						<path class="rightRoof" fill="#EF4427" stroke="none" d="
	M 329.7 167.9
	L 331.05 167.9 344.55 176.7 347.85 176.7 363 192.25 363.15 189.55 350.65 176.7 350.55 176.7 334.25 167.5 334.25 159.1 329.7 159.1 329.7 164.9 322.65 160.95 322.3 162.15 329.7 167 329.7 167.9 Z"/>
					</g>
					<g id="Layer34_0_FILL">
						<path class="leftRoof" fill="#F2563B" stroke="none" d="
	M 334.05 207.05
	L 350.65 176.7 322.1 160.45 302.1 192.05 334.05 207.05 Z"/>
					</g>
					<g id="Layer30_0_FILL">
						<path id="windowFour" class="windows" stroke="none" fill="#975A42" d="
	M 341.35 203.3
	Q 340.9 203.45 340.5 203.8 340.1 204.2 339.85 204.75 339.7 205 339.7 205.3 339.6 205.75 339.7 206.1 339.7 206.15 339.7 206.2 339.8 206.5 340 206.8 340.55 207.4 341.45 207.4 342.35 207.4 343 206.8 343.4 206.5 343.65 206.1 343.85 205.75 343.95 205.3 344.05 204.4 343.55 203.8 343.3 203.45 343 203.3 342.65 203.15 342.2 203.15 341.8 203.15 341.35 203.3
	M 355.85 198.45
	Q 355.8 198.2 355.6 198 355.1 197.4 354.2 197.4 353.35 197.4 352.6 198 351.85 198.65 351.7 199.55 351.7 199.7 351.7 199.85 351.6 200.5 352 201.05 352.55 201.65 353.45 201.65 354.3 201.65 355.05 201.05 355.45 200.7 355.7 200.25 355.8 200.05 355.9 199.85 355.95 199.7 355.95 199.55 356.05 198.95 355.85 198.45 Z"/>
						<path class="door" fill="#B65041" stroke="none" d="
	M 351.95 211.2
	L 351.8 211.2 346.05 215.1 346.05 225.2 351.95 221.6 351.95 211.2
	M 351.2 211.2
	L 351.35 211.2 351.35 211.1 351.2 211.2 Z"/>
					</g>
					<g>
						<path id="Layer30_0_FILL" fill="#000000" fill-opacity="1" stroke="none" d="
	M 183.7 215.3
	L 183.7 215.6
	Q 187.25 231.75 212.25 234.35
	L 183.7 215.3 Z"/>
					</g>
					<g id="Layer29_0_FILL">
						<path fill="#000000" fill-opacity="0.4" stroke="none" d="
	M 305.1 216.85
	L 305.15 217.2
	Q 309.45 233.2 334.35 232.3
	L 305.1 216.85 Z"/>
					</g>
					<g id="Layer27_0_FILL">
						<path class="vegetation" fill="#78A950" stroke="none" d="
	M 177.45 231.65
	Q 175.75 235.35 181.8 239.35 185.5 235.7 185.15 231.3 182.8 230.65 181.45 234 179.45 231.3 177.45 231.65
	M 236.9 266.6
	Q 235.2 270.3 241.25 274.3 244.95 270.6 244.65 266.25 242.3 265.6 240.95 268.95 238.9 266.25 236.9 266.6
	M 254.7 277
	Q 253.05 280.7 259.1 284.75 262.75 281.05 262.45 276.65 260.1 276 258.75 279.35 256.7 276.65 254.7 277
	M 315.5 245.75
	Q 313.5 243.05 311.5 243.4 309.8 247.1 315.85 251.15 319.55 247.45 319.2 243.05 316.85 242.4 315.5 245.75
	M 295.35 232.65
	Q 293.7 236.35 299.75 240.4 303.45 236.7 303.1 232.3 300.75 231.65 299.4 235 297.4 232.3 295.35 232.65
	M 277.2 171.85
	Q 275.55 175.55 281.6 179.55 285.3 175.85 284.95 171.5 282.6 170.85 281.25 174.2 279.25 171.5 277.2 171.85 Z"/>
					</g>
					<g id="Layer26_0_FILL">
						<path class="treeWood" fill="#AE663D" stroke="none" d="
	M 175.1 177.55
	L 172.05 177.55 172.05 191.1 159.3 172.85
	Q 154.6 171.5 172.05 195.7
	L 172.05 212.5 175.1 212.5 175.1 177.55
	M 252.7 151.35
	L 249 151.35 249 176.9 252.7 176.9 252.7 151.35 Z"/>
					</g>
					<g id="Layer25_0_FILL">
						<path class="vegetation" fill="#77A951" stroke="none" d="
	M 192.55 179.55
	Q 200.95 173.5 200.95 165.1 200.95 156.4 192.55 150 184.15 144.3 172.05 144.3 160.3 144.3 151.9 150 143.15 156.4 143.15 165.1 143.15 173.5 151.9 179.55 160.3 185.95 172.05 185.95 184.15 185.95 192.55 179.55
	M 236.25 106.65
	Q 230.2 116.05 230.2 129.15 230.2 142.25 236.25 151.35 242.3 160.75 250.7 160.75 258.75 160.75 264.8 151.35 270.85 142.25 270.85 129.15 270.85 116.05 264.8 106.65 258.75 97.6 250.7 97.6 242.3 97.6 236.25 106.65 Z"/>
					</g>
					<g id="Layer24_0_FILL">
						<path class="vegetation" fill="#77A951" stroke="none" d="
	M 158.3 221.9
	Q 160.65 221.9 161.95 220.2 163 219.55 163.3 218.55 164.65 218.9 166.35 218.9 170.05 218.9 172.4 216.2 175.1 213.85 175.1 210.15 175.1 206.45 172.4 203.75 170.05 201.4 166.35 201.4 162.65 201.4 159.95 203.75 157.6 206.45 157.6 210.15 157.6 210.8 157.6 211.15 155.95 211.5 154.6 212.5 152.9 214.15 152.9 216.55 152.9 218.9 154.6 220.2 156.25 221.9 158.3 221.9
	M 338.35 240.05
	Q 341.05 237.7 341.05 234 341.05 230.3 338.35 227.6 336 225.25 332.3 225.25 328.65 225.25 325.95 227.6 323.6 230.3 323.6 234 323.6 237.7 325.95 240.05 328.65 242.75 332.3 242.75 336 242.75 338.35 240.05 Z"/>
					</g>
					<g id="Layer22_0_FILL">
						<path class="rightRoof" fill="#D05041" stroke="none" d="
	M 220 173.85
	L 236.8 186.7 264.35 171.15 244.5 159.55 220 173.85 Z"/>
					</g>
					<g id="Layer21_0_FILL">
						<path class="leftWall" fill="#C57F42" stroke="none" d="
	M 212.25 191.35
	L 183.35 172.3 183.7 215.3 212.25 234.35 212.25 191.35 Z"/>
					</g>
					<g id="Layer20_0_FILL">
						<path class="rightRoof" fill="#EF4427" stroke="none" d="
	M 192.1 149.85
	L 236.45 174.8 243.1 171.4
	Q 220.05 150.55 196.3 139.95
	L 192.1 149.85 Z"/>
					</g>
					<g id="Layer19_0_FILL">
						<path class="frontFascia" fill="#EBB17B" stroke="none" d="
	M 226.85 160.95
	L 212 190.6 229.75 192.6 239.75 172.85 226.85 160.95 Z"/>
					</g>
					<g id="Layer18_0_FILL">
						<path class="frontWall" fill="#EFA258" stroke="none" d="
	M 240.15 172.65
	L 211.9 191.6 212.25 233.65 264.35 201.7 264.35 170.8 240.8 184.45 240.15 172.65 Z"/>
					</g>
					<g id="Layer17_0_FILL">
						<path class="rightRoof" fill="#EF4427" stroke="none" d="
	M 210.9 142.2
	L 205.9 142.2 205.9 152.65 210.9 152.65 210.9 142.2 Z"/>
					</g>
					<g>
						<path id="Layer16_0_FILL" class="leftRoof" fill="#F2563B" stroke="none" d="
	M 210.25 195.5
	L 227.4 160.95 195.45 141.35 177.65 175.85 210.25 195.5 Z"/>
					</g>
					<g>
						<path id="sun" fill="#E3BD0E" stroke="none" d="
	M 257.05 15.95
	Q 251.7 15.95 248 19.65 244.3 23.35 244.3 28.7 244.3 34.1 248 37.8 251.7 41.5 257.05 41.5 262.45 41.5 266.15 37.8 269.85 34.1 269.85 28.7 269.85 23.35 266.15 19.65 262.45 15.95 257.05 15.95 Z"/>
					</g>
					<g id="Layer8_0_FILL">
						<path fill="#975A42" stroke="none" d="
	M 238.45 189.65
	Q 238.295703125 189.362109375 238.05 189.1 237.35 188.3 236.2 188.3 235.05 188.3 234.15 189.1 233.3 189.9 233.2 191.05 233.1 192.2 233.8 193 234.55 193.8 235.7 193.8 236.85 193.8 237.7 193 238.1970703125 192.558203125 238.45 192 238.6552734375 191.56484375 238.7 191.05 238.7671875 190.276953125 238.45 189.65
	M 220.55 197.55
	Q 220 197.55 219.5 197.75 218.95 197.95 218.5 198.35 217.933203125 198.8833984375 217.7 199.55 217.5833984375 199.916796875 217.55 200.3 217.4923828125 200.96171875 217.7 201.5 217.852734375 201.9103515625 218.15 202.25 218.95 203.05 220.1 203.05 221.25 203.05 222.05 202.25 222.95 201.45 223.05 200.3 223.15 199.15 222.4 198.35 222.05 197.95 221.65 197.75 221.15 197.55 220.55 197.55 Z"/>
					</g>
					<g id="Layer7_0_FILL">
						<path class="door" fill="#B65041" stroke="none" d="
	M 233.55 206.75
	L 225.9 211.95 226.25 225.5 233.95 220.35 233.55 206.75 Z"/>
					</g>
					<g>
						<path id="windowOne" class="windows" fill="#975A42" stroke="none" d="
	M 188.65 198.4
	L 188.8 204.1 198.65 210.45 198.55 204.75 188.65 198.4
	M 208.45 216.8
	L 208.35 211.1 198.55 204.75 198.65 210.45 208.45 216.8
	M 188.8 204.1
	L 188.95 209.8 198.8 216.15 198.65 210.45 188.8 204.1
	M 208.6 222.5
	L 208.45 216.8 198.65 210.45 198.8 216.15 208.6 222.5 Z"/>
					</g>
					<g>
						<path id="windowThree" class="windows" fill="#975A42" stroke="none" d="
	M 311.7 214.1
	L 318.55 217.55 318.45 211.9 311.6 208.45 311.7 214.1
	M 325.4 221
	L 325.25 215.35 318.45 211.9 318.55 217.55 325.4 221
	M 318.4 206.2
	L 311.5 202.75 311.6 208.45 318.45 211.9 318.4 206.2
	M 325.25 215.35
	L 325.2 209.7 318.4 206.2 318.45 211.9 325.25 215.35 Z"/>
					</g>
					<g id="Layer2_0_FILL">
						<path class="door" fill="#B65041" stroke="none" d="
	M 259.7 183.25
	L 244.6 191.9 244.6 213.8 259.7 204.55 259.7 183.25 Z"/>
					</g>
					<path id="windowTwo" fill="#975A42" class="windows" stroke-width="1" stroke-linejoin="round" stroke-linecap="round" d="
	M 223.05 200.3
	Q 222.95 201.45 222.05 202.25 221.25 203.05 220.1 203.05 218.95 203.05 218.15 202.25 217.852734375 201.9103515625 217.7 201.5 217.4923828125 200.96171875 217.55 200.3 217.5833984375 199.916796875 217.7 199.575 217.933203125 198.8833984375 218.5 198.35 218.95 197.95 219.5 197.75 220 197.55 220.55 197.55 221.15 197.55 221.65 197.75 222.05 197.95 222.4 198.35 223.15 199.15 223.05 200.3 Z
	M 238.7 191.05
	Q 238.6552734375 191.56484375 238.45 192 238.1970703125 192.558203125 237.7 193 236.85 193.8 235.7 193.8 234.55 193.8 233.8 193 233.1 192.2 233.2 191.05 233.3 189.9 234.15 189.1 235.05 188.3 236.2 188.3 237.35 188.3 238.05 189.1 238.295703125 189.362109375 238.45 189.65 238.7671875 190.276953125 238.7 191.05 Z"/>
					<path fill="#F2563B" stroke="none" d=" M 351.95 211.2 L 351.8 211.2 346.05 215.1 346.05 225.2 351.95 221.6 351.95 211.2 Z"/>
					<path id="Layer6_0_1_STROKES" class="windowRims" stroke="#AE663D" stroke-width="1" stroke-linejoin="round" stroke-linecap="round" fill="none" d="
	M 198.55 204.75
	L 208.35 211.1 208.45 216.8 208.6 222.5 198.8 216.15 188.95 209.8 188.8 204.1 188.65 198.4 198.55 204.75 198.65 210.45 208.45 216.8
	M 198.8 216.15
	L 198.65 210.45 188.8 204.1"/>
					<path id="Layer5_0_1_STROKES" class="windowRims" stroke="#AE663D" stroke-width="1" stroke-linejoin="round" stroke-linecap="round" fill="none" d="
	M 325.25 215.35
	L 325.4 221 318.55 217.55 311.7 214.1 311.6 208.45 311.5 202.75 318.4 206.2 325.2 209.7 325.25 215.35 318.45 211.9 318.55 217.55
	M 318.4 206.2
	L 318.45 211.9 311.6 208.45"/>
				</defs>
				<g id="shadow">
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use xlink:href="#bottomShadow"/>
					</g>
				</g>
				<g transform="matrix( 1, 0, 0, 1, 0,0) ">
					<use xlink:href="#sun"/>
				</g>
				<g id="earth">
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer52_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer51_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer50_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer48_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer47_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer46_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer45_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer44_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer43_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer41_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer40_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer38_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer37_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer36_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer35_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer34_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#windowFour"/>
						<use class="element" xlink:href="#Layer32_0_1_STROKES"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer30_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer27_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer26_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer25_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer24_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer22_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer21_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer20_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer19_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer18_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer17_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer16_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer8_0_FILL"/>
						<use class="element" xlink:href="#windowTwo"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer7_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#windowOne"/>
						<use class="element" xlink:href="#Layer6_0_1_STROKES"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#windowThree"/>
						<use class="element" xlink:href="#Layer5_0_1_STROKES"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer2_0_FILL"/>
					</g>
				</g>
			</svg>
			<! -- End of SVG file -->
			<! -- Moon/Sun Toggle -->
			<div id="toggleButton" class="day-toggle">
				<div class="sun-icon"></div>
				<label class="switch">
            <input id="toggleCheckbox" type="checkbox">
            <div class="slider"></div>
        </label>
				<div class="cloud-icon"></div>
			</div>
			<! -- Moon/Sun Toggle -->
			<! -- End of Container -->
		</div>
			</div>
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">啷哩咯啷</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">打工， 打工是不可能打工的， 这辈子都不可能打工的！</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2014/02/06/Fetch超时设置与终止请求abort/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="李斌">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="啷哩咯啷">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Fetch超时设置与终止请求abort</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-02-06T17:18:23+08:00">
                2014-02-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="fetch请求和ajax请求-fetch与ajax（XMLHttpRequest）相比"><a href="#fetch请求和ajax请求-fetch与ajax（XMLHttpRequest）相比" class="headerlink" title="fetch请求和ajax请求   fetch与ajax（XMLHttpRequest）相比"></a>fetch请求和ajax请求   <a href="https://segmentfault.com/a/1190000013927644" target="_blank" rel="noopener">fetch与ajax（XMLHttpRequest）相比</a></h3><blockquote>
<p>ES6中新增了一种HTTP数据请求的方式，就是fetch，它和XMLHttpRequest有许多相似的功能，但是相比XMLHttpRequest,fetch被设计成更具可扩展性和高效性。江湖上一直流传着 “传统ajax已死，fetch永生”的说法，下面详细说下二者</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">response.arrayBuffer()</span><br><span class="line">读取 Response对象并且将它设置为已读（因为Responses对象被设置为了 stream 的方式，所以它们只能被读取一次） ,并返回一个被解析为<span class="built_in">ArrayBuffer</span>格式的promise对象</span><br><span class="line"></span><br><span class="line">response.blob()</span><br><span class="line">读取 Response对象并且将它设置为已读（因为Responses对象被设置为了 stream 的方式，所以它们只能被读取一次） ,并返回一个被解析为Blob格式的promise对象</span><br><span class="line"></span><br><span class="line">response.formData()</span><br><span class="line">读取Response对象并且将它设置为已读（因为Responses对象被设置为了 stream 的方式，所以它们只能被读取一次） ,并返回一个被解析为FormData格式的promise对象</span><br><span class="line"></span><br><span class="line">response.json()</span><br><span class="line">读取 Response对象并且将它设置为已读（因为Responses对象被设置为了 stream 的方式，所以它们只能被读取一次） ,并返回一个被解析为<span class="built_in">JSON</span>格式的promise对象</span><br><span class="line"></span><br><span class="line">response.text()</span><br><span class="line">读取 Response对象并且将它设置为已读（因为Responses对象被设置为了 stream 的方式，所以它们只能被读取一次） ,并返回一个被解析为USVString格式的promise对象</span><br></pre></td></tr></table></figure>
<ul>
<li>语法简洁，更加语义化</li>
<li>基于标准 Promise 实现，支持 async/await</li>
<li>同构方便，使用 isomorphic-fetch</li>
<li><strong>fetch 一直没有传统的 XHR 所拥有的 abort() ,setTimeout超时回调 和 onprogress 功能</strong><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fetch(url,&#123;</span><br><span class="line">           method:&apos;POST&apos;,    // method:&apos;PUT&apos;,     method:&apos;DELETE&apos;,   </span><br><span class="line">           headers:&#123;</span><br><span class="line">               &apos;Content-type&apos;:&apos;application/json&apos;// 设置请求头数据类型</span><br><span class="line">           &#125;,</span><br><span class="line">           body:data</span><br><span class="line">       &#125;)</span><br><span class="line">       .then(res=&gt;res.json())</span><br><span class="line">       .then(data=&gt;console.log(data))</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="fetch可以在header中设置CORS跨域"><a href="#fetch可以在header中设置CORS跨域" class="headerlink" title="fetch可以在header中设置CORS跨域"></a>fetch可以在header中设置CORS跨域</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">var u = new URLSearchParams();</span><br><span class="line">u.append(&apos;method&apos;, &apos;flickr.interestingness.getList&apos;);</span><br><span class="line">u.append(&apos;api_key&apos;, &apos;&lt;insert api key here&gt;&apos;);</span><br><span class="line">u.append(&apos;format&apos;, &apos;json&apos;);</span><br><span class="line">u.append(&apos;nojsoncallback&apos;, &apos;1&apos;);</span><br><span class="line"></span><br><span class="line">fetch(url,&#123;</span><br><span class="line">            method:&apos;POST&apos;,</span><br><span class="line">            headers:u,</span><br><span class="line">            body:data</span><br><span class="line">        &#125;)</span><br><span class="line">        .then(res=&gt;res.json())</span><br><span class="line">        .then(data=&gt;console.log(data))</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line"> u.append(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;);  </span><br><span class="line">    u.append(&quot;Access-Control-Allow-Headers&quot;, &quot;X-Requested-With&quot;);  </span><br><span class="line">    u.append(&quot;Access-Control-Allow-Methods&quot;,&quot;PUT,POST,GET,DELETE,OPTIONS&quot;);  </span><br><span class="line">    u.append(&quot;X-Powered-By&quot;,&apos; 3.2.1&apos;)</span><br></pre></td></tr></table></figure>
<h4 id="ajax"><a href="#ajax" class="headerlink" title="ajax"></a>ajax</h4><ul>
<li>1.是XMLHTTPRequest的一个实例，需要new</li>
<li>2.只有当状态为200或者304时才会请求成功</li>
<li>3.格式零散，容易出现回调地狱的问题</li>
</ul>
<h3 id="fetch"><a href="#fetch" class="headerlink" title="fetch"></a>fetch</h3><ul>
<li>1.fetch是基于promise实现的，也可以结合async/await</li>
<li>2.fetch请求默认是不带cookie的，需要设置fetch（URL，{credentials:’include’})。 </li>
<li>Credentials有三种参数：same-origin，include，*</li>
<li>3.服务器返回400 500 状态码时并不会reject，只有网络出错导致请求不能完成时，fetch才会被reject</li>
<li>4.<strong>所有版本的 IE 均不支持原生 Fetch</strong></li>
<li>5.fetch是widow的一个方法,不需要new</li>
<li>6.<strong>fetch 一直没有传统的 XHR 所拥有的 abort() ,setTimeout超时回调 和 onprogress 功能</strong></li>
</ul>
<h3 id="fetch和ajax-的主要区别"><a href="#fetch和ajax-的主要区别" class="headerlink" title="fetch和ajax 的主要区别"></a>fetch和ajax 的主要区别</h3><ul>
<li>1、fetch()返回的promise将不会拒绝http的错误状态，即使响应是一个HTTP 404或者500 </li>
<li>2、在默认情况下 fetch不会接受或者发送cookies</li>
<li>3、所有的IE浏览器都不会支持 fetch()方法</li>
<li>4、服务器端返回 状态码 400 500的时候 不会reject</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fetch(url).then(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> response.json()   <span class="comment">//执行成功第一步</span></span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params">returnedValue</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//执行成功的第二步</span></span><br><span class="line">&#125;).catch(<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//中途的任何地方出错  都会在这里被捕获到</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>fetch 的第二参数中<br>1、默认的请求为get请求 可以使用method:post 来进行配置<br>2、第一步中的 response有许多方法 json() text() formData()<br>3、Fetch跨域的时候默认不会带cookie 需要手动的指定 credentials:’include’<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">var promise=fetch(&apos;http://localhost:3000/news&apos;, &#123;</span><br><span class="line">       method: &apos;get&apos;</span><br><span class="line">   &#125;).then(function(response) &#123;</span><br><span class="line">            return  response.json()</span><br><span class="line">   &#125;).catch(function(err) &#123;</span><br><span class="line">       // Error :(</span><br><span class="line">   &#125;);</span><br><span class="line">   promise.then(function (data) &#123;</span><br><span class="line">         console.log(data)</span><br><span class="line">   &#125;).catch(function (error) &#123;</span><br><span class="line">       console.log(error)</span><br><span class="line">   &#125;)</span><br></pre></td></tr></table></figure></p>
<h3 id="fetch模拟abort请求-🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥"><a href="#fetch模拟abort请求-🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥" class="headerlink" title="fetch模拟abort请求 🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥"></a>fetch模拟abort请求 🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥</h3><blockquote>
<p>超时设置<br>原生的XMLHttpRequest可以设置请求超时时间的方法回调；<br>ES6以后Promise 出现解决地狱回调等不优雅的代码风格。个人理解这个更像是一个生产者和消费者的关系，查看 Promise文档，有以下两个方法</p>
</blockquote>
<ul>
<li>Promise.race([promise1,promise2]) 传入多个Promise对象，等待最快对象完成</li>
<li>Promise.all([promise1,promise2]) 传入多个Promise 对象，等待所有对象完成</li>
</ul>
<p>有了以上知识后,结合函数setTimeout就可以实现超时设置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">//ahutor:herbert qq:464884492</span><br><span class="line">let timeoutPromise = (timeout) =&gt; &#123;</span><br><span class="line"> return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">  setTimeout(() =&gt; &#123;</span><br><span class="line">   resolve(&quot;我是 timeoutPromise，已经完成了&quot;);</span><br><span class="line">  &#125;, timeout);</span><br><span class="line"> &#125;);</span><br><span class="line">&#125;</span><br><span class="line">let requestPromise = (url) =&gt; &#123;</span><br><span class="line"> return fetch(url);</span><br><span class="line">&#125;;</span><br><span class="line">Promise.race([timeoutPromise(1000), requestPromise(&quot;https://www.baidu.com&quot;)])</span><br><span class="line"> .then(resp =&gt; &#123;</span><br><span class="line">  console.log(resp);</span><br><span class="line"> &#125;)</span><br><span class="line"> .catch(error =&gt; &#123;</span><br><span class="line">  console.log(error);</span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure></p>
<h3 id="Ajax与Comet"><a href="#Ajax与Comet" class="headerlink" title="Ajax与Comet"></a><a href="https://libin1991.github.io/2015/04/26/Ajax%E4%B8%8EComet/" target="_blank" rel="noopener">Ajax与Comet</a></h3><blockquote>
<p>可以检测XHR对象的readyState属性，该属性表示请求/响应过程的当前活动阶段</p>
</blockquote>
<ul>
<li>0：未初始化。尚未调用open()方法</li>
<li>1：启动。已经调用open()方法，但尚未调用send()方法</li>
<li>2：发送。已经调用send()方法，但尚未接收到响应</li>
<li>3：接收。已经接收到部分响应数据</li>
<li>4：完成。已经接收全部响应数据，而且已经可以在客户端使用了。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">function createXHR() &#123;</span><br><span class="line">   try &#123;</span><br><span class="line">     return new XMLHttpRequest();</span><br><span class="line">  &#125; catch (e) &#123;</span><br><span class="line">     return new ActiveXObject(&quot;Microsoft.XMLHTTP&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">var xhr = createXHR();     // return new XMLHttpRequest()     or     new ActiveXObject()        </span><br><span class="line">xhr.onreadystatechange = function(event)&#123;</span><br><span class="line">    // 不要使用this，作用域会产生问题，在部分浏览器中会执行失败</span><br><span class="line">    if (xhr.readyState == 4)&#123;</span><br><span class="line">        if ((xhr.status &gt;= 200 &amp;&amp; xhr.status &lt; 300) || xhr.status == 304)&#123;</span><br><span class="line">            console.log(xhr.responseText);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            console.log(&quot;Request was unsuccessful: &quot; + xhr.status);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// xhr.setRequestHeader(&quot;Content-Type&quot;, &quot;application/x-www-form-urlencoded&quot;);</span><br><span class="line"></span><br><span class="line">xhr.open(&quot;get&quot;, &quot;example.txt&quot;, true);</span><br><span class="line">xhr.send(null);</span><br></pre></td></tr></table></figure>
<h3 id="Ajax"><a href="#Ajax" class="headerlink" title="Ajax"></a>Ajax</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取异步请求对象</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getXhr</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">   <span class="keyword">var</span> xhr=<span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">window</span>.XMLHttpRequest)&#123;</span><br><span class="line">            xhr=<span class="keyword">new</span> XMLHttprequest();</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">// 如果浏览器版本是IE8以下浏览器</span></span><br><span class="line">            xhr=<span class="keyword">new</span> ActiveXObject(<span class="string">'Microsoft.XMLHttp'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">return</span> xhr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// url:"url路径"  type:请求方式  data:请求参数类型  dataType：返回的字符串类型</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ajax</span>(<span class="params">&#123;url,type,data,dataType&#125;</span>)</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">open,err</span>)</span>&#123;</span><br><span class="line">	<span class="comment">//1. 创建异步请求对象</span></span><br><span class="line">	<span class="keyword">var</span> xhr=<span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">	<span class="comment">//2.绑定监听事件</span></span><br><span class="line">	xhr.onreadystatechange=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="comment">// 当异步请求状态变为4时，并且返回的状态码为200，接收响应成功</span></span><br><span class="line">		<span class="keyword">if</span>(xhr.readyState==<span class="number">4</span>&amp;&amp;xhr.status==<span class="number">200</span>)&#123;</span><br><span class="line">			<span class="comment">// 当返回接收的字符串类型为json串时，自动转换json串</span></span><br><span class="line">			<span class="keyword">if</span>(dataType!==<span class="literal">undefined</span></span><br><span class="line">				&amp;&amp;dataType.toLowerCase()===<span class="string">"json"</span>)</span><br><span class="line">				<span class="keyword">var</span> res=<span class="built_in">JSON</span>.parse(xhr.responseText)</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				<span class="comment">// 否则直接获取返回的响应文本中的内容</span></span><br><span class="line">				<span class="keyword">var</span> res=xhr.responseText</span><br><span class="line">			<span class="comment">// 通过Promise，将返回的数据向后传递	</span></span><br><span class="line">			open(res);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 如果请求方式为get请求，则将请求参数拼接在url后</span></span><br><span class="line">	<span class="keyword">if</span>(type.toLowerCase()==<span class="string">"get"</span>&amp;&amp;data!=<span class="literal">undefined</span>)&#123;</span><br><span class="line">		url+=<span class="string">"?"</span>+data;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//3.打开连接</span></span><br><span class="line">	xhr.open(type,url,<span class="literal">true</span>);</span><br><span class="line">	<span class="comment">// 如果请求方式为post请求，则修改请求消息头</span></span><br><span class="line">	<span class="keyword">if</span>(type.toLowerCase()===<span class="string">"post"</span>)</span><br><span class="line">		<span class="comment">//增加：设置请求消息头</span></span><br><span class="line">		xhr.setRequestHeader(<span class="string">"Content-Type"</span>,<span class="string">"application/x-www-form-urlencoded"</span>);</span><br><span class="line">	<span class="comment">//4.发送请求</span></span><br><span class="line">	<span class="keyword">if</span>(type.toLowerCase()==<span class="string">"post"</span>&amp;&amp;data!==<span class="literal">undefined</span>)</span><br><span class="line">		xhr.send(data);</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		xhr.send(<span class="literal">null</span>);&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="HTTP缓存机制-200还是304"><a href="#HTTP缓存机制-200还是304" class="headerlink" title="HTTP缓存机制(200还是304)"></a><a href="https://libin1991.github.io/2018/11/22/HTTP%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6-200%E8%BF%98%E6%98%AF304/" target="_blank" rel="noopener">HTTP缓存机制(200还是304)</a></h3><blockquote>
<p>Expires Cache-Control</p>
<ul>
<li>Cache-Control: no-cache 必须先与代理服务器确认是否更改，然后在在决定使用缓存还是请求，类似于协商缓存（304）</li>
<li>Cache-Control: no-store 才是真正的不缓存数据到本地</li>
<li>Cache-Control: public 可以被所有用户缓存（多用户共享），包括终端和CDN等中间代理服务器</li>
<li>Cache-Control: private 只能被终端浏览器缓存（而且是私有缓存），不允许中继缓存服务器进行缓存</li>
<li>Cache-Control: must-revalidate如果缓存内容失效，请求必须发送服务器进行验证</li>
<li>Cache-Control: max-age=s 缓存内容在<strong>s秒</strong>后失效，仅HTTP1.1可用</li>
</ul>
</blockquote>
<h3 id="HTTP缓存机制及原理"><a href="#HTTP缓存机制及原理" class="headerlink" title="HTTP缓存机制及原理"></a><a href="https://libin1991.github.io/2019/03/31/HTTP%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6%E5%8F%8A%E5%8E%9F%E7%90%86/" target="_blank" rel="noopener">HTTP缓存机制及原理</a></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Expires</span><br><span class="line">Expires是http1.0提出的一个表示资源过期时间的header，它描述的是一个绝对时间，由服务器返回。</span><br><span class="line">Expires第二次请求时，将和本地时间比对。</span><br><span class="line">Expires 第一次请求服务器是，响应头会返回一个Expires的文件过期时间。</span><br><span class="line">Expires 第二次请求，客户端使用本地时间和文件的过期时间进行比对，如果文件未过期则直接使用本地缓存，</span><br><span class="line">        返回状态码200(from memory cache)或200(from disk cache)。</span><br></pre></td></tr></table></figure>
<h3 id="BFC是什么"><a href="#BFC是什么" class="headerlink" title="BFC是什么"></a><a href="https://www.cnblogs.com/mlw1814011067/p/10397999.html" target="_blank" rel="noopener">BFC是什么</a></h3><h3 id="什么是BFC？"><a href="#什么是BFC？" class="headerlink" title="什么是BFC？"></a><a href="https://www.jianshu.com/p/0d713b32cd0d" target="_blank" rel="noopener">什么是BFC？</a></h3><ul>
<li>根元素或其它包含它的元素</li>
<li>浮动元素 (元素的 float 不是 none)</li>
<li>绝对定位元素 (元素具有 position 为 absolute 或 fixed)</li>
<li>内联块 (元素具有 display: inline-block)</li>
<li>表格单元格 (元素具有 display: table-cell，HTML表格单元格默认属性)</li>
<li>表格标题 (元素具有 display: table-caption, HTML表格标题默认属性)</li>
<li>具有overflow 且值不是 visible 的块元素，</li>
<li>display: flow-root</li>
<li>column-span: all 应当总是会创建一个新的格式化上下文，即便具有 column-span: all 的元素并不被包裹在一个多列容器中。</li>
<li>一个块格式化上下文包括创建它的元素内部所有内容，除了被包含于创建新的块级格式化上下文的后代元素内的元素。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">哪些元素会生成BFC?</span><br><span class="line">根元素</span><br><span class="line">float属性不为none</span><br><span class="line">position为absolute或fixed</span><br><span class="line">display为inline-block, table-cell, table-caption, flex, inline-flex</span><br><span class="line">overflow不为visible</span><br></pre></td></tr></table></figure>
<h3 id="BFC的布局规则-什么是BFC？看这一篇就够了"><a href="#BFC的布局规则-什么是BFC？看这一篇就够了" class="headerlink" title="BFC的布局规则 什么是BFC？看这一篇就够了"></a>BFC的布局规则 <a href="https://blog.csdn.net/sinat_36422236/article/details/88763187" target="_blank" rel="noopener">什么是BFC？看这一篇就够了</a></h3><h4 id="BFC就是页面上的一个隔离的独立容器，容器里面的子元素不会影响到外面的元素。"><a href="#BFC就是页面上的一个隔离的独立容器，容器里面的子元素不会影响到外面的元素。" class="headerlink" title="BFC就是页面上的一个隔离的独立容器，容器里面的子元素不会影响到外面的元素。"></a>BFC就是页面上的一个隔离的独立容器，容器里面的子元素不会影响到外面的元素。</h4><blockquote>
<p>BFC是一个独立的布局环境，其中的元素布局是不受外界的影响，并且在一个BFC中，块盒与行盒（行盒由一行中所有的内联元素所组成）都会垂直的沿着其父元素的边框排列。</p>
</blockquote>
<ul>
<li>内部的Box会在垂直方向，一个接一个地放置。</li>
<li>Box垂直方向的距离由margin决定。属于同一个BFC的两个相邻Box的margin会发生重叠。</li>
<li><p>每个盒子（块盒与行盒）的margin box的左边，与包含块border box的左边相接触(对于从左往右的格式化，否则相反)。即使存在浮动也是如此。</p>
</li>
<li><p>BFC的区域不会与float box重叠。</p>
</li>
<li>BFC就是页面上的一个隔离的独立容器，容器里面的子元素不会影响到外面的元素。反之也如此。</li>
<li>计算BFC的高度时，浮动元素也参与计算。</li>
</ul>
<h3 id="如何创建BFC"><a href="#如何创建BFC" class="headerlink" title="如何创建BFC"></a>如何创建BFC</h3><p>1、float的值不是none。<br>2、position的值不是static或者relative。<br>3、display的值是inline-block、table-cell、flex、table-caption或者inline-flex<br>4、overflow的值不是visible</p>
<h3 id="BFC的作用"><a href="#BFC的作用" class="headerlink" title="BFC的作用"></a>BFC的作用</h3><p>1.利用BFC避免margin重叠。<br>2.自适应两栏布局<br>3.清楚浮动</p>
<h3 id="🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥"><a href="#🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥" class="headerlink" title="🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥"></a>🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥</h3><h3 id="React-HOC的两种实践"><a href="#React-HOC的两种实践" class="headerlink" title="React HOC的两种实践"></a><a href="https://www.jianshu.com/p/9cf91fb065bf" target="_blank" rel="noopener">React HOC的两种实践</a></h3><h3 id="从-0-到-1-实现-React-系列-——-5-PureComponent-实现-amp-amp-HOC-探幽"><a href="#从-0-到-1-实现-React-系列-——-5-PureComponent-实现-amp-amp-HOC-探幽" class="headerlink" title="从 0 到 1 实现 React 系列 —— 5.PureComponent 实现 &amp;&amp; HOC 探幽"></a><a href="https://www.cnblogs.com/MuYunyun/p/9541455.html" target="_blank" rel="noopener">从 0 到 1 实现 React 系列 —— 5.PureComponent 实现 &amp;&amp; HOC 探幽</a></h3><h3 id="react高阶组件的理解"><a href="#react高阶组件的理解" class="headerlink" title="react高阶组件的理解"></a><a href="http://www.bubuko.com/infodetail-2517494.html" target="_blank" rel="noopener">react高阶组件的理解</a></h3><h3 id="React进阶之高阶组件"><a href="#React进阶之高阶组件" class="headerlink" title="React进阶之高阶组件"></a><a href="https://www.cnblogs.com/libin-1/p/7087605.html" target="_blank" rel="noopener">React进阶之高阶组件</a></h3><ul>
<li>属性代理</li>
<li>渲染劫持</li>
<li>反向继承</li>
</ul>
<blockquote>
<p>存在两种高阶组件： </p>
<ul>
<li>属性代理—主要进行组件的复用</li>
<li>反向集成【渲染的劫持】—主要进行渲染的劫持</li>
</ul>
</blockquote>
<h3 id="箭头函数和普通函数的区别-🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥"><a href="#箭头函数和普通函数的区别-🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥" class="headerlink" title="箭头函数和普通函数的区别 🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥"></a>箭头函数和普通函数的区别 🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥</h3><ul>
<li>箭头函数是匿名函数，不能作为构造函数，不能使用new</li>
<li>箭头函数的 this 永远指向其上下文的  this ，任何方法都改变不了其指向，如 call() ,  bind() ,  apply() </li>
<li>箭头函数通过 call()  或   apply() 方法调用一个函数时，只传入了一个参数，对 this 并没有影响。</li>
<li>箭头函数不能绑定arguments，取而代之用rest参数…解决</li>
<li>箭头函数没有原型属性</li>
<li>头函数的this永远指向其上下文的this，没有办改变其指向，普通函数的this指向调用它的对象</li>
<li>箭头函数不绑定this，会捕获其所在的上下文的this值，作为自己的this值</li>
<li>箭头函数不能当做Generator函数,不能使用yield关键字</li>
<li>普通函数的this指向调用它的那个对象</li>
</ul>
<h3 id="fetch-的控制器和观察者-fetch-的控制器和观察者"><a href="#fetch-的控制器和观察者-fetch-的控制器和观察者" class="headerlink" title="fetch 的控制器和观察者   fetch 的控制器和观察者"></a>fetch 的控制器和观察者   <a href="https://www.cnblogs.com/ziyunfei/p/6617900.html" target="_blank" rel="noopener">fetch 的控制器和观察者</a></h3><p>因为受 cancelable promise 的拖延，fetch 一直没有传统的 XHR 所拥有的 abort() 和 onprogress 功能，去年年底 cancelable promise 草案被彻底废弃了，所以今年年初的这几个月里，一份完全新的、fetch 专用的、不依赖 JS 规范、与 Promise 没有任何直接关系的草案诞生了，而且 Firefox 已经率先实现了其中的大部分功能。</p>
<p>这份草案中引入了 3 种新的对象类型，FetchController（fetch 控制器）、FetchSignal（fetch 信号）、FetchObserver（fetch 观察者），虽然这三个都是全局构造函数，但其实只有 FetchController 对象是真的需要你手动 new 出来的，其它两种对象都是浏览器为你生成的，我们下面分别演示下如何中断（取消、中止）一个 fetch 请求，以及如何监听 fetch 请求的执行进度。</p>
<h4 id="中断-fetch-请求"><a href="#中断-fetch-请求" class="headerlink" title="中断 fetch 请求"></a>中断 fetch 请求</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">const controller = new FetchController()</span><br><span class="line">const signal = controller.signal</span><br><span class="line"></span><br><span class="line">fetch(&quot;https://tc39.github.io/ecma262/&quot;, &#123; signal &#125;).then(() =&gt; &#123;</span><br><span class="line">  alert(&quot;请求成功&quot;)</span><br><span class="line">&#125;).catch(err =&gt; &#123;</span><br><span class="line">  if (err.name === &quot;AbortError&quot;) &#123;</span><br><span class="line">    alert(&quot;请求被中断&quot;) </span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">setTimeout(() =&gt; controller.abort(), 500)</span><br></pre></td></tr></table></figure>
<p>这段代码中，我们先创建了一个 fetch 控制器 controller，每个控制器都自带一个 fetch 信号对象（signal 属性），然后在你用 fetch() 发送请求的时候把这个信号对象带上（signal 参数）。之后，你就可以通过控制器的 abort() 方法，来中断那个 fetch 请求了。只要在你执行 abort() 方法的时候，那个 fetch 请求还没有执行完毕（请求还没发出去、请求发出去了还没接收到响应、响应还没接收完），那么当初 fetch() 返回的那个 promise 就会被 reject，所产生的 error 对象的 name 为 AbortError。</p>
<p>上面这个例子中，我是在 500 毫秒的时候中断了这个请求，这是个绝对的数字，所以根据你的网速不同，执行代码时你有可能会看到弹出“请求成功”，也有能看到“请求被中断”。</p>
<p>一个信号对象还可以同时传递给多个 fetch 请求：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> controller = <span class="keyword">new</span> FetchController()</span><br><span class="line"><span class="keyword">const</span> signal = controller.signal</span><br><span class="line"></span><br><span class="line">fetch(<span class="string">"https://tc39.github.io/ecma262/"</span>, &#123; signal &#125;)</span><br><span class="line">fetch(<span class="string">"https://fetch.spec.whatwg.org/"</span>, &#123; signal &#125;)</span><br><span class="line">fetch(<span class="string">"https://dom.spec.whatwg.org/"</span>, &#123; signal &#125;)</span><br><span class="line"></span><br><span class="line">controller.abort() <span class="comment">// 同时中断三个请求</span></span><br></pre></td></tr></table></figure></p>
<p>信号对象有一个 aborted 属性表明自己是否已经被中断过了，一旦被中断，它不可能回到当初的状态，也就是说，你不能二次利用一个已经被中断过的信号对象，把这样的信号对象传给 fetch() 的话，fetch() 会立即结束，不会发出请求：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const controller = new FetchController()</span><br><span class="line">const signal = controller.signal</span><br><span class="line"></span><br><span class="line">controller.abort()</span><br><span class="line"></span><br><span class="line">alert(signal.aborted) // true</span><br><span class="line"></span><br><span class="line">fetch(&quot;https://tc39.github.io/ecma262/&quot;, &#123; signal &#125;) // 直接被 reject，请求不会发出</span><br></pre></td></tr></table></figure></p>
<p>信号对象上还可以监听 abort 事件，不过我想一般用不上，因为请求中断后的处理代码一般写在 fetch(…).catch(…) 里面：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">const controller = new FetchController()</span><br><span class="line">const signal = controller.signal</span><br><span class="line"></span><br><span class="line">signal.addEventListener(&quot;abort&quot;, function(e) &#123; // 使用 signal.onabort = 注册监听函数也可以</span><br><span class="line">  alert(e.type) // abort</span><br><span class="line">  alert(signal.aborted) // true</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">alert(signal.aborted) // false</span><br><span class="line"></span><br><span class="line">controller.abort()</span><br></pre></td></tr></table></figure></p>
<p>一个控制器除了可以让自己的信号对象 abort，还可以关注（跟随、监听）一个别的控制器的信号对象，只要关注的这个信号对象被 abort 了，自己的 abort() 方法就会被自动执行，从而自己的信号对象也会被 abort：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fc1 = <span class="keyword">new</span> FetchController()</span><br><span class="line"><span class="keyword">const</span> fc2 = <span class="keyword">new</span> FetchController()</span><br><span class="line"></span><br><span class="line">fc1.follow(fc2.signal)</span><br><span class="line"></span><br><span class="line">fc2.abort()</span><br><span class="line"></span><br><span class="line">alert(fc1.signal.aborted) <span class="comment">// true，即便你没有手动执行 fc1.abort()</span></span><br></pre></td></tr></table></figure>
<p>再来看个更复杂的例子：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fc1 = <span class="keyword">new</span> FetchController()</span><br><span class="line"><span class="keyword">const</span> fc2 = <span class="keyword">new</span> FetchController()</span><br><span class="line"><span class="keyword">const</span> fc3 = <span class="keyword">new</span> FetchController()</span><br><span class="line"></span><br><span class="line">fc1.follow(fc2.signal)</span><br><span class="line">fc2.follow(fc3.signal)</span><br><span class="line"></span><br><span class="line">fetch(<span class="string">"https://tc39.github.io/ecma262/"</span>, &#123; <span class="attr">signal</span>: fc1.signal &#125;)</span><br><span class="line">fetch(<span class="string">"https://fetch.spec.whatwg.org/"</span>, &#123; <span class="attr">signal</span>: fc2.signal &#125;)</span><br><span class="line">fetch(<span class="string">"https://dom.spec.whatwg.org/"</span>, &#123; <span class="attr">signal</span>: fc3.signal &#125;)</span><br><span class="line"></span><br><span class="line">fc3.abort() <span class="comment">//  三个请求都中断了</span></span><br></pre></td></tr></table></figure></p>
<p>一个控制器只能关注一个别人家的信号对象，而一个信号对象可以被任意多个别家的控制器关注。不能直接或间接的关注自己的信号对象，比如上面的代码中再增加一行 fc3.follow(fc1.signal) 就会产生环形关注，所以那句代码会没有任何效果。还有一个 unfollow() 方法可以取消关注。</p>
<p>总结下就是，一个控制器对象有一个 signal 属性指向一个信号对象，还有 abort()、follow()、unfollow() 这三个方法。一个信号对象有一个 aborted 属性，还有一个 onabort 事件监听函数。</p>
<h3 id="监听-fetch-请求"><a href="#监听-fetch-请求" class="headerlink" title="监听 fetch 请求"></a>监听 fetch 请求</h3><p>上面说到了 FetchController 和 FetchSignal，接下来要说说 fetch 观察者 - FetchObserver 对象。fetch 观察者对象上可以监听 statechange、requestprogress、responseprogress 三种事件，分别用来获取 fetch 请求的状态信息变化、请求数据发送的大小变化（POST 请求）、响应数据接收的大小变化信息，先来看看如何监听状态信息的变化：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fetch(<span class="string">"https://tc39.github.io/ecma262/"</span>, &#123;</span><br><span class="line">  observe(observer) &#123;</span><br><span class="line">    observer.onstatechange = <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="comment">// 也可以用 addEventListener("statechange"...</span></span><br><span class="line">      alert(observer.state) <span class="comment">// "requesting"、"responding"、"aborted", "errored"、"complete" 中的某个值</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>FetchObserver 对象不用你手动 new，浏览器会为你 new 一个，在 fetch 请求开始之前，通过你事先指定的 observe 回调函数的参数传递给你。然后你在这个观察者对象上注册 statechange 监听函数，就可以在请求的不同阶段执行特定的代码了。</p>
<p>监听响应的接收进度使用 responseprogress 事件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fetch(&quot;https://img.alicdn.com/tfscom/TB1y6icQXXXXXaQXFXXXXXXXXXX.mp4&quot;, &#123;</span><br><span class="line">  observe(observer) &#123;</span><br><span class="line">    observer.onresponseprogress = e =&gt; &#123; </span><br><span class="line">      if(e.lengthComputable) &#123;</span><br><span class="line">        console.log(&quot;视频下载进度：&quot; + parseInt(e.loaded / e.total * 100) + &quot;%&quot;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>监听 POST 数据的发送进度使用 requestprogress 事件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">fetch(<span class="string">"/upload"</span>, &#123;</span><br><span class="line">  method: <span class="string">"POST"</span>,</span><br><span class="line">  credentials: <span class="string">"include"</span>,</span><br><span class="line">  body: canvas.toBlob(),</span><br><span class="line">  observe(observer) &#123;</span><br><span class="line">    observer.onrequestprogress = <span class="function"><span class="params">e</span> =&gt;</span> &#123; </span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"图片上传进度："</span> + <span class="built_in">parseInt</span>(e.loaded / e.total * <span class="number">100</span>) + <span class="string">"%"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>在本文发布的现在，规范草案还只是最初的阶段，可能有很多细节没考虑，目前 Firefox 也没有实现我上面所说的所有功能，实现了的也有一些 bug，而且还需要事先在 about:config 手动添加某两个选项才可以使用，所以本文仅仅是简要介绍，大家暂时眼睛看看就够了。</p>
<p>以后 fetch 控制器的功能可能还会增加，不仅仅能让一个 fetch 请求中断，比如还可以指定这个请求的优先级，fetch 观察者同时也可以用来监听 fetch 请求优先级的变化。</p>
<h3 id="fetch默认不携带cookie"><a href="#fetch默认不携带cookie" class="headerlink" title="fetch默认不携带cookie"></a>fetch默认不携带cookie</h3><p>fetch发送请求默认是不发送cookie的，不管是同域还是跨域；那么问题就来了，对于那些需要权限验证的请求就可能无法正常获取数据，这时可以配置其credentials项，其有3个值：</p>
<ul>
<li>omit: 默认值，忽略cookie的发送</li>
<li>same-origin: 表示cookie只能同域发送，不能跨域发送</li>
<li>include: cookie既可以同域发送，也可以跨域发送</li>
</ul>
<p>credentials所表达的含义，其实与XHR2中的withCredentials属性类似，表示请求是否携带cookie；具体可以参考阮一峰老师的跨域资源共享 CORS 详解中withCredentials一节的介绍；<br>若要fetch请求携带cookie信息，只需设置一下credentials选项即可，例如</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fetch(url, &#123;credentials: &apos;include&apos;&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="fetch请求对某些错误http状态不会reject"><a href="#fetch请求对某些错误http状态不会reject" class="headerlink" title="fetch请求对某些错误http状态不会reject"></a>fetch请求对某些错误http状态不会reject</h3><p>这主要是由fetch返回promise导致的，因为fetch返回的promise在某些错误的http状态下如400 、500等不会reject，相反它会被resolve；只有网络错误会导致请求不能完成时，fetch 才会被 reject；所以一般会对fetch请求做一层封装，例如下面代码所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkStatus</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (response.status &gt;= <span class="number">200</span> &amp;&amp; response.status &lt; <span class="number">300</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> error = <span class="keyword">new</span> <span class="built_in">Error</span>(response.statusText);</span><br><span class="line">  error.response = response;</span><br><span class="line">  <span class="keyword">throw</span> error;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parseJSON</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> response.json();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">request</span>(<span class="params">url, options</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> opt = options||&#123;&#125;;</span><br><span class="line">  <span class="keyword">return</span> fetch(url, &#123;<span class="attr">credentials</span>: <span class="string">'include'</span>, ...opt&#125;)</span><br><span class="line">    .then(checkStatus)</span><br><span class="line">    .then(parseJSON)</span><br><span class="line">    .then(<span class="function">(<span class="params">data</span>) =&gt;</span> ( data ))</span><br><span class="line">    .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> ( err ));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="fetch不支持超时timeout处理"><a href="#fetch不支持超时timeout处理" class="headerlink" title="fetch不支持超时timeout处理"></a>fetch不支持超时timeout处理</h3><p>用过fetch的都知道，fetch不像大多数ajax库那样对请求设置超时timeout，它没有有关请求超时的feature，这一点比较蛋疼。所以在fetch标准添加超时feature之前，都需要polyfill该特性。</p>
<p>实际上，我们真正需要的是abort()， timeout可以通过timeout+abort方式来实现，起到真正超时丢弃当前的请求。</p>
<p>而在目前的fetch指导规范中，fetch并不是一个具体实例，而只是一个方法；其返回的promise实例根据Promise指导规范标准是不能abort的，也不能手动改变promise实例的状态，只能由内部来根据请求结果来改变promise的状态。</p>
<p>既然不能手动控制fetch方法执行后返回的promise实例状态，那么是不是可以创建一个可以手动控制状态的新Promise实例呢。所以：</p>
<h4 id="方法一：单纯setTimeout方式"><a href="#方法一：单纯setTimeout方式" class="headerlink" title="方法一：单纯setTimeout方式"></a>方法一：单纯setTimeout方式</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> oldFetchfn = fetch; <span class="comment">//拦截原始的fetch方法</span></span><br><span class="line"><span class="built_in">window</span>.fetch = <span class="function"><span class="keyword">function</span>(<span class="params">input, opts</span>)</span>&#123;<span class="comment">//定义新的fetch方法，封装原有的fetch方法</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> timeoutId = setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"fetch timeout"</span>))</span><br><span class="line">        &#125;, opts.timeout);</span><br><span class="line">        oldFetchfn(input, opts).then(</span><br><span class="line">            res=&gt;&#123;</span><br><span class="line">                clearTimeout(timeoutId);</span><br><span class="line">                resolve(res)</span><br><span class="line">            &#125;,</span><br><span class="line">            err=&gt;&#123;</span><br><span class="line">                clearTimeout(timeoutId);</span><br><span class="line">                reject(err)</span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="方法二：利用Promise-race方法"><a href="#方法二：利用Promise-race方法" class="headerlink" title="方法二：利用Promise.race方法"></a>方法二：利用Promise.race方法</h4><p>Promise.race方法接受一个promise实例数组参数，表示多个promise实例中任何一个最先改变状态，那么race方法返回的promise实例状态就跟着改变，具体可以参考这里。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">var oldFetchfn = fetch; //拦截原始的fetch方法</span><br><span class="line">window.fetch = function(input, opts)&#123;//定义新的fetch方法，封装原有的fetch方法</span><br><span class="line">    var fetchPromise = oldFetchfn(input, opts);</span><br><span class="line">    var timeoutPromise = new Promise(function(resolve, reject)&#123;</span><br><span class="line">        setTimeout(()=&gt;&#123;</span><br><span class="line">             reject(new Error(&quot;fetch timeout&quot;))</span><br><span class="line">        &#125;, opts.timeout)</span><br><span class="line">    &#125;);</span><br><span class="line">    retrun Promise.race([fetchPromise, timeoutPromise])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="fetch不支持取消请求"><a href="#fetch不支持取消请求" class="headerlink" title="fetch不支持取消请求"></a>fetch不支持取消请求</h3><p>我们可以看看AbortController</p>
<p>首先通过AbortController() 构造函数来创建一个controller实例, 然后通过AbortController.signal 属性获取到它的关联对象AbortSignal 的引用.</p>
<p>当 fetch request 初始化后, 将 AbortSignal 作为一个选项传入请求的选项参数中 (如下 {signal}). 这将signal,controller与fetch请求关联起来, 允许我们通过调用AbortController.abort()来取消fetch请求, 正如下第二个事件监听器所示.</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">var</span> oldFetchfn = fetch; </span><br><span class="line"><span class="keyword">var</span> controller = <span class="keyword">new</span> AbortController();</span><br><span class="line"><span class="keyword">var</span> signal = controller.signal;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> downloadBtn = <span class="built_in">document</span>.querySelector(<span class="string">'.download'</span>);</span><br><span class="line"><span class="keyword">var</span> abortBtn = <span class="built_in">document</span>.querySelector(<span class="string">'.abort'</span>);</span><br><span class="line"></span><br><span class="line">downloadBtn.addEventListener(<span class="string">'click'</span>, fetchVideo);</span><br><span class="line"></span><br><span class="line">abortBtn.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  controller.abort();</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Download aborted'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fetchVideo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  fetch(url, &#123;signal&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;).catch(<span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    reports.textContent = <span class="string">'Download error: '</span> + e.message;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Fetch-——-中止尚未完成的接口请求"><a href="#Fetch-——-中止尚未完成的接口请求" class="headerlink" title="Fetch —— 中止尚未完成的接口请求"></a><a href="https://blog.csdn.net/Wu_shuxuan/article/details/80831150" target="_blank" rel="noopener">Fetch —— 中止尚未完成的接口请求</a></h3>
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2015/01/01/JS原生常用API大全/" rel="prev" title="JS原生常用API大全">
                JS原生常用API大全 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/tx.jpg" alt="李斌">
            
              <p class="site-author-name" itemprop="name">李斌</p>
              <p class="site-description motion-element" itemprop="description">人生如逆旅     我亦是行人</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">204</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">121</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/libin1991" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://juejin.im/user/57e737f6c4c971005f6bcd8d" target="_blank" title="juejin">
                      
                        <i class="fa fa-fw fa-spinner"></i>juejin</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#fetch请求和ajax请求-fetch与ajax（XMLHttpRequest）相比"><span class="nav-number">1.</span> <span class="nav-text">fetch请求和ajax请求   fetch与ajax（XMLHttpRequest）相比</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#fetch可以在header中设置CORS跨域"><span class="nav-number">2.</span> <span class="nav-text">fetch可以在header中设置CORS跨域</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ajax"><span class="nav-number">2.1.</span> <span class="nav-text">ajax</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#fetch"><span class="nav-number">3.</span> <span class="nav-text">fetch</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#fetch和ajax-的主要区别"><span class="nav-number">4.</span> <span class="nav-text">fetch和ajax 的主要区别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#fetch模拟abort请求-🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥"><span class="nav-number">5.</span> <span class="nav-text">fetch模拟abort请求 🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Ajax与Comet"><span class="nav-number">6.</span> <span class="nav-text">Ajax与Comet</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Ajax"><span class="nav-number">7.</span> <span class="nav-text">Ajax</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HTTP缓存机制-200还是304"><span class="nav-number">8.</span> <span class="nav-text">HTTP缓存机制(200还是304)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HTTP缓存机制及原理"><span class="nav-number">9.</span> <span class="nav-text">HTTP缓存机制及原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BFC是什么"><span class="nav-number">10.</span> <span class="nav-text">BFC是什么</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#什么是BFC？"><span class="nav-number">11.</span> <span class="nav-text">什么是BFC？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BFC的布局规则-什么是BFC？看这一篇就够了"><span class="nav-number">12.</span> <span class="nav-text">BFC的布局规则 什么是BFC？看这一篇就够了</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#BFC就是页面上的一个隔离的独立容器，容器里面的子元素不会影响到外面的元素。"><span class="nav-number">12.1.</span> <span class="nav-text">BFC就是页面上的一个隔离的独立容器，容器里面的子元素不会影响到外面的元素。</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#如何创建BFC"><span class="nav-number">13.</span> <span class="nav-text">如何创建BFC</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BFC的作用"><span class="nav-number">14.</span> <span class="nav-text">BFC的作用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥"><span class="nav-number">15.</span> <span class="nav-text">🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#React-HOC的两种实践"><span class="nav-number">16.</span> <span class="nav-text">React HOC的两种实践</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#从-0-到-1-实现-React-系列-——-5-PureComponent-实现-amp-amp-HOC-探幽"><span class="nav-number">17.</span> <span class="nav-text">从 0 到 1 实现 React 系列 —— 5.PureComponent 实现 &amp;&amp; HOC 探幽</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#react高阶组件的理解"><span class="nav-number">18.</span> <span class="nav-text">react高阶组件的理解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#React进阶之高阶组件"><span class="nav-number">19.</span> <span class="nav-text">React进阶之高阶组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#箭头函数和普通函数的区别-🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥"><span class="nav-number">20.</span> <span class="nav-text">箭头函数和普通函数的区别 🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#fetch-的控制器和观察者-fetch-的控制器和观察者"><span class="nav-number">21.</span> <span class="nav-text">fetch 的控制器和观察者   fetch 的控制器和观察者</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#中断-fetch-请求"><span class="nav-number">21.1.</span> <span class="nav-text">中断 fetch 请求</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#监听-fetch-请求"><span class="nav-number">22.</span> <span class="nav-text">监听 fetch 请求</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#fetch默认不携带cookie"><span class="nav-number">23.</span> <span class="nav-text">fetch默认不携带cookie</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#fetch请求对某些错误http状态不会reject"><span class="nav-number">24.</span> <span class="nav-text">fetch请求对某些错误http状态不会reject</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#fetch不支持超时timeout处理"><span class="nav-number">25.</span> <span class="nav-text">fetch不支持超时timeout处理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#方法一：单纯setTimeout方式"><span class="nav-number">25.1.</span> <span class="nav-text">方法一：单纯setTimeout方式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#方法二：利用Promise-race方法"><span class="nav-number">25.2.</span> <span class="nav-text">方法二：利用Promise.race方法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#fetch不支持取消请求"><span class="nav-number">26.</span> <span class="nav-text">fetch不支持取消请求</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Fetch-——-中止尚未完成的接口请求"><span class="nav-number">27.</span> <span class="nav-text">Fetch —— 中止尚未完成的接口请求</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">李斌</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

  
  <!--
  	描述：点击红心
  -->
  <script type="text/javascript" src="/js/src/clicklove.js"></script>
  <!--
  	描述：复制代码
  -->
  <script type="text/javascript" src="/js/src/clipboard.min.js"></script>
  <script type="text/javascript" src="/js/src/clipboard-use.js"></script>
</body>
</html>


