<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Vue,Vue-cli,">










<meta name="description" content="目前 vue-cli3 生成的配置是做单页面的，然而，我们有时也会有多页面的需求 。比如我们最常见的一个项目跑多个独立的小型的H5页面，这些页面不可能每一次都开一个新项目.但是在实际的项目中，我们需要这样的脚手架，参考了很多大牛的脚手架，这里提供了一种我的单页面脚手架转换为多页面脚手架的方案，供大家参考。 要求： 1.首页显示项目所有的H5链接列表； 2.支持小型本地收据mock,方便本地测试接口">
<meta name="keywords" content="Vue,Vue-cli">
<meta property="og:type" content="article">
<meta property="og:title" content="Vue-cli3通用多页面脚手架">
<meta property="og:url" content="http://yoursite.com/2018/10/29/Vue-cli3通用多页面脚手架/index.html">
<meta property="og:site_name" content="Zero Days">
<meta property="og:description" content="目前 vue-cli3 生成的配置是做单页面的，然而，我们有时也会有多页面的需求 。比如我们最常见的一个项目跑多个独立的小型的H5页面，这些页面不可能每一次都开一个新项目.但是在实际的项目中，我们需要这样的脚手架，参考了很多大牛的脚手架，这里提供了一种我的单页面脚手架转换为多页面脚手架的方案，供大家参考。 要求： 1.首页显示项目所有的H5链接列表； 2.支持小型本地收据mock,方便本地测试接口">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://yoursite.com/2018/10/29/Vue-cli3通用多页面脚手架/1.webp">
<meta property="og:image" content="http://yoursite.com/2018/10/29/Vue-cli3通用多页面脚手架/2.webp">
<meta property="og:updated_time" content="2019-01-19T09:16:19.446Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Vue-cli3通用多页面脚手架">
<meta name="twitter:description" content="目前 vue-cli3 生成的配置是做单页面的，然而，我们有时也会有多页面的需求 。比如我们最常见的一个项目跑多个独立的小型的H5页面，这些页面不可能每一次都开一个新项目.但是在实际的项目中，我们需要这样的脚手架，参考了很多大牛的脚手架，这里提供了一种我的单页面脚手架转换为多页面脚手架的方案，供大家参考。 要求： 1.首页显示项目所有的H5链接列表； 2.支持小型本地收据mock,方便本地测试接口">
<meta name="twitter:image" content="http://yoursite.com/2018/10/29/Vue-cli3通用多页面脚手架/1.webp">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2018/10/29/Vue-cli3通用多页面脚手架/">





  <title>Vue-cli3通用多页面脚手架 | Zero Days</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband">
    	<div class="eevee"><div class="body"><div class="head"><div class="ears"><div class="ear"><div class="lobe"></div></div><div class="ear"><div class="lobe"></div></div></div><div class="face"><div class="eyes"><div class="eye"><div class="eyelid"></div></div><div class="eye"><div class="eyelid"></div></div></div><div class="nose"></div><div class="mouth"></div></div></div><div class="chest"><div class="fur"><div class="patch"></div></div><div class="fur"><div class="patch"></div></div><div class="fur"><div class="patch"></div></div></div><div class="legs"><div class="leg"><div class="inner-leg"></div></div><div class="leg"><div class="inner-leg"></div></div><div class="leg"><div class="inner-leg"></div></div><div class="leg"><div class="inner-leg"></div></div></div><div class="tail"><div class="tail"><div class="tail"><div class="tail"><div class="tail"><div class="tail -end"></div></div></div></div></div></div></div></div>
    </div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
    	<div id="sky">
				<div id="background" class="container">
			<!-- svg file -->
			<svg id="svgout" height="100%" width="100%" viewbox="0 0 550 400">
				<defs>
					<g id="bottomShadow">
						<path fill="#000000" stroke="none" d="
		M 270.5 225.95
		L 127.35 316.65 266.8 400 409.6 309.25 270.5 225.95 Z"/>
					</g>
					<g id="Layer52_0_FILL">
						<path class="topGrass" fill="#B9D668" stroke="none" d="
	M 397.85 229.3
	L 397.85 225.6 269.85 152 135.75 228.6 135.75 233.65 262.1 306.55 397.85 229.3 Z"/>
					</g>
					<g id="Layer51_0_FILL">
						<path class="leftSideGrass" fill="#6E9E4F" stroke="none" d="
	M 135.1 229.95
	L 135.1 256.85 262.1 328.4 262.1 301.85 135.1 229.95 Z"/>
					</g>
					<g id="Layer50_0_FILL">
						<path class="rightGrassTop" fill="#8CB154" stroke="none" d="
	M 397.85 225.95
	L 395.8 225.95 261.75 301.55 261.75 328.4 397.85 251.15 397.85 225.95 Z"/>
					</g>
					<g id="Layer48_0_FILL">
						<path class="crustLeftTop" fill="#955541" stroke="none" d="
	M 135.45 282.4
	L 135.75 298.15 262.1 372.1 261.75 355.65 135.45 282.4 Z"/>
					</g>
					<g id="Layer47_0_FILL">
						<path class="middleLeftCrust" fill="#C77E61" stroke="none" d="
	M 135.1 270.3
	L 135.1 283.05 275.9 364.35 271.85 348.9 135.1 270.3 Z"/>
					</g>
					<g id="Layer46_0_FILL">
						<path class="crustLeftTop" fill="#955541" stroke="none" d="
	M 135.1 255.15
	L 135.1 270.3 262.1 343.55 262.1 328.05 135.1 255.15 Z"/>
					</g>
					<g id="Layer45_0_FILL">
						<path class="topRightCrust" fill="#A47237" stroke="none" d="
	M 397.5 294.5
	L 397.5 277 261.75 355.3 261.75 372.75 397.5 294.5 Z"/>
					</g>
					<g id="Layer44_0_FILL">
						<path class="middleRightCrust" fill="#C89451" stroke="none" d="
	M 397.5 269.95
	L 397.15 266.6 262.1 343.2 262.1 355.95 397.5 279.7 397.5 269.95 Z"/>
					</g>
					<g id="Layer43_0_FILL">
						<path class="topRightCrust" fill="#A47237" stroke="none" d="
	M 397.5 266.6
	L 397.5 250.45 261.75 328.4 261.75 343.85 397.5 266.6 Z"/>
					</g>
					<g id="Layer41_0_FILL">
						<path class="greyRoad" fill="#B2B2B1" stroke="none" d="
	M 295.05 283.05
	Q 299.05 280.35 308.45 275.3 317.85 269.95 323.6 266.9
	L 268.8 233.65 338.05 191.35 309.15 174.55 177.75 254.5
	Q 191.55 262.2 198.25 266.25 204.65 269.95 209.7 271.95
	L 241.6 250.45 295.05 283.05 Z"/>
					</g>
					<g id="Layer40_0_FILL">
						<path fill="#FFFFFF" stroke="none" d="
	M 199.95 256.85
	Q 194.55 261.2 191.9 262.2
	L 194.9 263.9 200.95 259.2 199.95 256.85
	M 225.8 243.75
	L 224.8 241.75 211.05 250.8 212.05 252.8 225.8 243.75
	M 308.15 275.65
	L 296.7 266.6 295.35 268.6 306.8 277.7 308.15 275.65
	M 275.9 253.5
	L 274.55 255.5 285.95 264.55 287.3 262.55 275.9 253.5
	M 251.7 227.3
	L 250.7 225.25 236.9 234.35 237.9 236.35 251.7 227.3
	M 257.05 240.7
	L 254.05 240.7 268.8 249.8 269.5 247.75 257.05 240.7
	M 277.2 207.8
	L 263.45 216.85 264.45 218.9 278.25 209.8 277.2 207.8
	M 305.1 192.65
	L 304.1 190.65 290.3 199.75 291.35 201.75 305.1 192.65 Z"/>
					</g>
					<g id="Layer38_0_FILL">
						<path class="frontFascia" fill="#ECB27B" stroke="none" d="
	M 359.25 187.95
	L 346.4 174.95 333.85 202.9 359.25 187.95 Z"/>
					</g>
					<g id="Layer37_0_FILL">
						<path class="frontWall" fill="#EFA258" stroke="none" d="
	M 334 201.05
	L 334.35 232 359.2 217.55 359.25 187.95 334 201.05 Z"/>
					</g>
					<g id="Layer36_0_FILL">
						<path class="leftWall" fill="#C57F42" stroke="none" d="
	M 334.35 232.3
	L 334.35 205.1 305.1 191.35 305.1 216.85 334.35 232.3 Z"/>
					</g>
					<g id="Layer35_0_FILL">
						<path class="rightRoof" fill="#EF4427" stroke="none" d="
	M 329.7 167.9
	L 331.05 167.9 344.55 176.7 347.85 176.7 363 192.25 363.15 189.55 350.65 176.7 350.55 176.7 334.25 167.5 334.25 159.1 329.7 159.1 329.7 164.9 322.65 160.95 322.3 162.15 329.7 167 329.7 167.9 Z"/>
					</g>
					<g id="Layer34_0_FILL">
						<path class="leftRoof" fill="#F2563B" stroke="none" d="
	M 334.05 207.05
	L 350.65 176.7 322.1 160.45 302.1 192.05 334.05 207.05 Z"/>
					</g>
					<g id="Layer30_0_FILL">
						<path id="windowFour" class="windows" stroke="none" fill="#975A42" d="
	M 341.35 203.3
	Q 340.9 203.45 340.5 203.8 340.1 204.2 339.85 204.75 339.7 205 339.7 205.3 339.6 205.75 339.7 206.1 339.7 206.15 339.7 206.2 339.8 206.5 340 206.8 340.55 207.4 341.45 207.4 342.35 207.4 343 206.8 343.4 206.5 343.65 206.1 343.85 205.75 343.95 205.3 344.05 204.4 343.55 203.8 343.3 203.45 343 203.3 342.65 203.15 342.2 203.15 341.8 203.15 341.35 203.3
	M 355.85 198.45
	Q 355.8 198.2 355.6 198 355.1 197.4 354.2 197.4 353.35 197.4 352.6 198 351.85 198.65 351.7 199.55 351.7 199.7 351.7 199.85 351.6 200.5 352 201.05 352.55 201.65 353.45 201.65 354.3 201.65 355.05 201.05 355.45 200.7 355.7 200.25 355.8 200.05 355.9 199.85 355.95 199.7 355.95 199.55 356.05 198.95 355.85 198.45 Z"/>
						<path class="door" fill="#B65041" stroke="none" d="
	M 351.95 211.2
	L 351.8 211.2 346.05 215.1 346.05 225.2 351.95 221.6 351.95 211.2
	M 351.2 211.2
	L 351.35 211.2 351.35 211.1 351.2 211.2 Z"/>
					</g>
					<g>
						<path id="Layer30_0_FILL" fill="#000000" fill-opacity="1" stroke="none" d="
	M 183.7 215.3
	L 183.7 215.6
	Q 187.25 231.75 212.25 234.35
	L 183.7 215.3 Z"/>
					</g>
					<g id="Layer29_0_FILL">
						<path fill="#000000" fill-opacity="0.4" stroke="none" d="
	M 305.1 216.85
	L 305.15 217.2
	Q 309.45 233.2 334.35 232.3
	L 305.1 216.85 Z"/>
					</g>
					<g id="Layer27_0_FILL">
						<path class="vegetation" fill="#78A950" stroke="none" d="
	M 177.45 231.65
	Q 175.75 235.35 181.8 239.35 185.5 235.7 185.15 231.3 182.8 230.65 181.45 234 179.45 231.3 177.45 231.65
	M 236.9 266.6
	Q 235.2 270.3 241.25 274.3 244.95 270.6 244.65 266.25 242.3 265.6 240.95 268.95 238.9 266.25 236.9 266.6
	M 254.7 277
	Q 253.05 280.7 259.1 284.75 262.75 281.05 262.45 276.65 260.1 276 258.75 279.35 256.7 276.65 254.7 277
	M 315.5 245.75
	Q 313.5 243.05 311.5 243.4 309.8 247.1 315.85 251.15 319.55 247.45 319.2 243.05 316.85 242.4 315.5 245.75
	M 295.35 232.65
	Q 293.7 236.35 299.75 240.4 303.45 236.7 303.1 232.3 300.75 231.65 299.4 235 297.4 232.3 295.35 232.65
	M 277.2 171.85
	Q 275.55 175.55 281.6 179.55 285.3 175.85 284.95 171.5 282.6 170.85 281.25 174.2 279.25 171.5 277.2 171.85 Z"/>
					</g>
					<g id="Layer26_0_FILL">
						<path class="treeWood" fill="#AE663D" stroke="none" d="
	M 175.1 177.55
	L 172.05 177.55 172.05 191.1 159.3 172.85
	Q 154.6 171.5 172.05 195.7
	L 172.05 212.5 175.1 212.5 175.1 177.55
	M 252.7 151.35
	L 249 151.35 249 176.9 252.7 176.9 252.7 151.35 Z"/>
					</g>
					<g id="Layer25_0_FILL">
						<path class="vegetation" fill="#77A951" stroke="none" d="
	M 192.55 179.55
	Q 200.95 173.5 200.95 165.1 200.95 156.4 192.55 150 184.15 144.3 172.05 144.3 160.3 144.3 151.9 150 143.15 156.4 143.15 165.1 143.15 173.5 151.9 179.55 160.3 185.95 172.05 185.95 184.15 185.95 192.55 179.55
	M 236.25 106.65
	Q 230.2 116.05 230.2 129.15 230.2 142.25 236.25 151.35 242.3 160.75 250.7 160.75 258.75 160.75 264.8 151.35 270.85 142.25 270.85 129.15 270.85 116.05 264.8 106.65 258.75 97.6 250.7 97.6 242.3 97.6 236.25 106.65 Z"/>
					</g>
					<g id="Layer24_0_FILL">
						<path class="vegetation" fill="#77A951" stroke="none" d="
	M 158.3 221.9
	Q 160.65 221.9 161.95 220.2 163 219.55 163.3 218.55 164.65 218.9 166.35 218.9 170.05 218.9 172.4 216.2 175.1 213.85 175.1 210.15 175.1 206.45 172.4 203.75 170.05 201.4 166.35 201.4 162.65 201.4 159.95 203.75 157.6 206.45 157.6 210.15 157.6 210.8 157.6 211.15 155.95 211.5 154.6 212.5 152.9 214.15 152.9 216.55 152.9 218.9 154.6 220.2 156.25 221.9 158.3 221.9
	M 338.35 240.05
	Q 341.05 237.7 341.05 234 341.05 230.3 338.35 227.6 336 225.25 332.3 225.25 328.65 225.25 325.95 227.6 323.6 230.3 323.6 234 323.6 237.7 325.95 240.05 328.65 242.75 332.3 242.75 336 242.75 338.35 240.05 Z"/>
					</g>
					<g id="Layer22_0_FILL">
						<path class="rightRoof" fill="#D05041" stroke="none" d="
	M 220 173.85
	L 236.8 186.7 264.35 171.15 244.5 159.55 220 173.85 Z"/>
					</g>
					<g id="Layer21_0_FILL">
						<path class="leftWall" fill="#C57F42" stroke="none" d="
	M 212.25 191.35
	L 183.35 172.3 183.7 215.3 212.25 234.35 212.25 191.35 Z"/>
					</g>
					<g id="Layer20_0_FILL">
						<path class="rightRoof" fill="#EF4427" stroke="none" d="
	M 192.1 149.85
	L 236.45 174.8 243.1 171.4
	Q 220.05 150.55 196.3 139.95
	L 192.1 149.85 Z"/>
					</g>
					<g id="Layer19_0_FILL">
						<path class="frontFascia" fill="#EBB17B" stroke="none" d="
	M 226.85 160.95
	L 212 190.6 229.75 192.6 239.75 172.85 226.85 160.95 Z"/>
					</g>
					<g id="Layer18_0_FILL">
						<path class="frontWall" fill="#EFA258" stroke="none" d="
	M 240.15 172.65
	L 211.9 191.6 212.25 233.65 264.35 201.7 264.35 170.8 240.8 184.45 240.15 172.65 Z"/>
					</g>
					<g id="Layer17_0_FILL">
						<path class="rightRoof" fill="#EF4427" stroke="none" d="
	M 210.9 142.2
	L 205.9 142.2 205.9 152.65 210.9 152.65 210.9 142.2 Z"/>
					</g>
					<g>
						<path id="Layer16_0_FILL" class="leftRoof" fill="#F2563B" stroke="none" d="
	M 210.25 195.5
	L 227.4 160.95 195.45 141.35 177.65 175.85 210.25 195.5 Z"/>
					</g>
					<g>
						<path id="sun" fill="#E3BD0E" stroke="none" d="
	M 257.05 15.95
	Q 251.7 15.95 248 19.65 244.3 23.35 244.3 28.7 244.3 34.1 248 37.8 251.7 41.5 257.05 41.5 262.45 41.5 266.15 37.8 269.85 34.1 269.85 28.7 269.85 23.35 266.15 19.65 262.45 15.95 257.05 15.95 Z"/>
					</g>
					<g id="Layer8_0_FILL">
						<path fill="#975A42" stroke="none" d="
	M 238.45 189.65
	Q 238.295703125 189.362109375 238.05 189.1 237.35 188.3 236.2 188.3 235.05 188.3 234.15 189.1 233.3 189.9 233.2 191.05 233.1 192.2 233.8 193 234.55 193.8 235.7 193.8 236.85 193.8 237.7 193 238.1970703125 192.558203125 238.45 192 238.6552734375 191.56484375 238.7 191.05 238.7671875 190.276953125 238.45 189.65
	M 220.55 197.55
	Q 220 197.55 219.5 197.75 218.95 197.95 218.5 198.35 217.933203125 198.8833984375 217.7 199.55 217.5833984375 199.916796875 217.55 200.3 217.4923828125 200.96171875 217.7 201.5 217.852734375 201.9103515625 218.15 202.25 218.95 203.05 220.1 203.05 221.25 203.05 222.05 202.25 222.95 201.45 223.05 200.3 223.15 199.15 222.4 198.35 222.05 197.95 221.65 197.75 221.15 197.55 220.55 197.55 Z"/>
					</g>
					<g id="Layer7_0_FILL">
						<path class="door" fill="#B65041" stroke="none" d="
	M 233.55 206.75
	L 225.9 211.95 226.25 225.5 233.95 220.35 233.55 206.75 Z"/>
					</g>
					<g>
						<path id="windowOne" class="windows" fill="#975A42" stroke="none" d="
	M 188.65 198.4
	L 188.8 204.1 198.65 210.45 198.55 204.75 188.65 198.4
	M 208.45 216.8
	L 208.35 211.1 198.55 204.75 198.65 210.45 208.45 216.8
	M 188.8 204.1
	L 188.95 209.8 198.8 216.15 198.65 210.45 188.8 204.1
	M 208.6 222.5
	L 208.45 216.8 198.65 210.45 198.8 216.15 208.6 222.5 Z"/>
					</g>
					<g>
						<path id="windowThree" class="windows" fill="#975A42" stroke="none" d="
	M 311.7 214.1
	L 318.55 217.55 318.45 211.9 311.6 208.45 311.7 214.1
	M 325.4 221
	L 325.25 215.35 318.45 211.9 318.55 217.55 325.4 221
	M 318.4 206.2
	L 311.5 202.75 311.6 208.45 318.45 211.9 318.4 206.2
	M 325.25 215.35
	L 325.2 209.7 318.4 206.2 318.45 211.9 325.25 215.35 Z"/>
					</g>
					<g id="Layer2_0_FILL">
						<path class="door" fill="#B65041" stroke="none" d="
	M 259.7 183.25
	L 244.6 191.9 244.6 213.8 259.7 204.55 259.7 183.25 Z"/>
					</g>
					<path id="windowTwo" fill="#975A42" class="windows" stroke-width="1" stroke-linejoin="round" stroke-linecap="round" d="
	M 223.05 200.3
	Q 222.95 201.45 222.05 202.25 221.25 203.05 220.1 203.05 218.95 203.05 218.15 202.25 217.852734375 201.9103515625 217.7 201.5 217.4923828125 200.96171875 217.55 200.3 217.5833984375 199.916796875 217.7 199.575 217.933203125 198.8833984375 218.5 198.35 218.95 197.95 219.5 197.75 220 197.55 220.55 197.55 221.15 197.55 221.65 197.75 222.05 197.95 222.4 198.35 223.15 199.15 223.05 200.3 Z
	M 238.7 191.05
	Q 238.6552734375 191.56484375 238.45 192 238.1970703125 192.558203125 237.7 193 236.85 193.8 235.7 193.8 234.55 193.8 233.8 193 233.1 192.2 233.2 191.05 233.3 189.9 234.15 189.1 235.05 188.3 236.2 188.3 237.35 188.3 238.05 189.1 238.295703125 189.362109375 238.45 189.65 238.7671875 190.276953125 238.7 191.05 Z"/>
					<path fill="#F2563B" stroke="none" d=" M 351.95 211.2 L 351.8 211.2 346.05 215.1 346.05 225.2 351.95 221.6 351.95 211.2 Z"/>
					<path id="Layer6_0_1_STROKES" class="windowRims" stroke="#AE663D" stroke-width="1" stroke-linejoin="round" stroke-linecap="round" fill="none" d="
	M 198.55 204.75
	L 208.35 211.1 208.45 216.8 208.6 222.5 198.8 216.15 188.95 209.8 188.8 204.1 188.65 198.4 198.55 204.75 198.65 210.45 208.45 216.8
	M 198.8 216.15
	L 198.65 210.45 188.8 204.1"/>
					<path id="Layer5_0_1_STROKES" class="windowRims" stroke="#AE663D" stroke-width="1" stroke-linejoin="round" stroke-linecap="round" fill="none" d="
	M 325.25 215.35
	L 325.4 221 318.55 217.55 311.7 214.1 311.6 208.45 311.5 202.75 318.4 206.2 325.2 209.7 325.25 215.35 318.45 211.9 318.55 217.55
	M 318.4 206.2
	L 318.45 211.9 311.6 208.45"/>
				</defs>
				<g id="shadow">
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use xlink:href="#bottomShadow"/>
					</g>
				</g>
				<g transform="matrix( 1, 0, 0, 1, 0,0) ">
					<use xlink:href="#sun"/>
				</g>
				<g id="earth">
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer52_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer51_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer50_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer48_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer47_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer46_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer45_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer44_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer43_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer41_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer40_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer38_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer37_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer36_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer35_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer34_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#windowFour"/>
						<use class="element" xlink:href="#Layer32_0_1_STROKES"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer30_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer27_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer26_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer25_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer24_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer22_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer21_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer20_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer19_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer18_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer17_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer16_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer8_0_FILL"/>
						<use class="element" xlink:href="#windowTwo"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer7_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#windowOne"/>
						<use class="element" xlink:href="#Layer6_0_1_STROKES"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#windowThree"/>
						<use class="element" xlink:href="#Layer5_0_1_STROKES"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer2_0_FILL"/>
					</g>
				</g>
			</svg>
			<! -- End of SVG file -->
			<! -- Moon/Sun Toggle -->
			<div id="toggleButton" class="day-toggle">
				<div class="sun-icon"></div>
				<label class="switch">
            <input id="toggleCheckbox" type="checkbox">
            <div class="slider"></div>
        </label>
				<div class="cloud-icon"></div>
			</div>
			<! -- Moon/Sun Toggle -->
			<! -- End of Container -->
		</div>
			</div>
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Zero Days</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">人生如逆旅    我亦是行人</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/29/Vue-cli3通用多页面脚手架/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="李斌">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zero Days">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Vue-cli3通用多页面脚手架</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-29T12:17:19+08:00">
                2018-10-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>目前 vue-cli3 生成的配置是做单页面的，然而，我们有时也会有多页面的需求 。比如我们最常见的一个项目跑多个独立的小型的H5页面，这些页面不可能每一次都开一个新项目.但是在实际的项目中，我们需要这样的脚手架，参考了很多大牛的脚手架，这里提供了一种我的单页面脚手架转换为多页面脚手架的方案，供大家参考。</p>
<h3 id="要求："><a href="#要求：" class="headerlink" title="要求："></a>要求：</h3><ul>
<li>1.首页显示项目所有的H5链接列表；</li>
<li>2.支持小型本地收据mock,方便本地测试接口【我个人不推荐，建议mock和项目分离】</li>
</ul>
<h3 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h3><p>使用vue-cli生成一个你需要的单页面项目脚手架，然后我们就可以为所欲为了，目录我就不说明了，默认大家都知道。</p>
<p><img src="/2018/10/29/Vue-cli3通用多页面脚手架/1.webp" alt></p>
<blockquote>
<p>每一次新开的页面都在pages里面起一个文件夹,<strong>文件夹名字就是H5页面名字,入口文件是文件夹的index.html和index.js</strong>。</p>
</blockquote>
<p>修改vue.config.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">let path = require(&apos;path&apos;)</span><br><span class="line">let glob = require(&apos;glob&apos;)</span><br><span class="line">let mock = require(&apos;./src/mock/index.json&apos;);</span><br><span class="line">var BundleAnalyzerPlugin = require(&apos;webpack-bundle-analyzer&apos;).BundleAnalyzerPlugin;</span><br><span class="line">//配置pages多页面获取当前文件夹下的html和js</span><br><span class="line">function getEntry(globPath) &#123;</span><br><span class="line">	let entries = &#123;&#125;;</span><br><span class="line">	glob.sync(globPath).forEach(function(entry) &#123;</span><br><span class="line">		var tmp = entry.split(&apos;/&apos;).splice(-3);</span><br><span class="line">		entries[tmp[1]] = &#123;</span><br><span class="line">			entry: &apos;src/&apos; + tmp[0] + &apos;/&apos; + tmp[1] + &apos;/&apos; + &apos;index.js&apos;,</span><br><span class="line">			template: &apos;src/&apos; + tmp[0] + &apos;/&apos; + tmp[1] + &apos;/&apos; + &apos;index.html&apos;,</span><br><span class="line">			filename: tmp[1]</span><br><span class="line">		&#125;;</span><br><span class="line">	&#125;);</span><br><span class="line">	return entries;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let pages = getEntry(&apos;./src/pages/**?/*.html&apos;);</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">	lintOnSave: false, </span><br><span class="line">	baseUrl: process.env.NODE_ENV === &quot;production&quot; ? &apos;https://www.baidu.com/&apos; : &apos;/&apos;,</span><br><span class="line">	productionSourceMap: false,</span><br><span class="line">	pages,</span><br><span class="line">	devServer: &#123;</span><br><span class="line">		index: &apos;/&apos;, </span><br><span class="line">		open: process.platform === &apos;darwin&apos;,</span><br><span class="line">		host: &apos;&apos;,</span><br><span class="line">		port: 9527,</span><br><span class="line">		https: false,</span><br><span class="line">		hotOnly: false,</span><br><span class="line">		proxy: &#123;</span><br><span class="line">			&apos;/xrf/&apos;: &#123;</span><br><span class="line">				target: &apos;http://reg.tool.hexun.com/&apos;,</span><br><span class="line">				changeOrigin: true,</span><br><span class="line">				pathRewrite: &#123;</span><br><span class="line">					&apos;^/xrf&apos;: &apos;&apos;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;,</span><br><span class="line">		&#125;, // 设置代理</span><br><span class="line">		before: app =&gt; &#123;     </span><br><span class="line">			app.get(&apos;/&apos;, (req, res, next) =&gt; &#123;</span><br><span class="line">				for(let i in pages)&#123;</span><br><span class="line">					res.write(`&lt;a target=&quot;_self&quot; href=&quot;/$&#123;i&#125;&quot;&gt;/$&#123;i&#125;&lt;/a&gt;&lt;/br&gt;`);</span><br><span class="line">				&#125;</span><br><span class="line">				res.end()</span><br><span class="line">			&#125;);</span><br><span class="line">			app.get(&apos;/goods/list&apos;, (req, res, next) =&gt; &#123;  //mock数据</span><br><span class="line">				res.status(299).json(mock)</span><br><span class="line">			&#125;)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	chainWebpack: config =&gt; &#123;</span><br><span class="line">		config.module</span><br><span class="line">			.rule(&apos;images&apos;)</span><br><span class="line">			.use(&apos;url-loader&apos;)</span><br><span class="line">			.loader(&apos;url-loader&apos;)</span><br><span class="line">			.tap(options =&gt; &#123;</span><br><span class="line">				// 修改它的选项...</span><br><span class="line">				options.limit = 100</span><br><span class="line">				return options</span><br><span class="line">			&#125;)</span><br><span class="line">		Object.keys(pages).forEach(entryName =&gt; &#123;</span><br><span class="line">			config.plugins.delete(`prefetch-$&#123;entryName&#125;`);</span><br><span class="line">		&#125;);</span><br><span class="line">		if(process.env.NODE_ENV === &quot;production&quot;) &#123;</span><br><span class="line">			config.plugin(&quot;extract-css&quot;).tap(() =&gt; [&#123;</span><br><span class="line">				path: path.join(__dirname, &quot;./dist&quot;),</span><br><span class="line">				filename: &quot;css/[name].[contenthash:8].css&quot;</span><br><span class="line">			&#125;]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	configureWebpack: config =&gt; &#123;</span><br><span class="line">		//		if(process.env.NODE_ENV === &quot;production&quot;) &#123;</span><br><span class="line">		//			config.output = &#123;</span><br><span class="line">		//				path: path.join(__dirname, &quot;./dist&quot;),</span><br><span class="line">		//				filename: &quot;js/[name].[contenthash:8].js&quot;			</span><br><span class="line">		//			&#125;;</span><br><span class="line">		//		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>启动项目，显示项目所有H5连接</p>
<p><img src="/2018/10/29/Vue-cli3通用多页面脚手架/2.webp" alt></p>
<p>最主要的是修改：</p>
<blockquote>
<p><strong> before第一个参数express实例。</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">before: app =&gt; &#123;     </span><br><span class="line">		app.get(&apos;/&apos;, (req, res, next) =&gt; &#123;</span><br><span class="line">			for(let i in pages)&#123;    //遍历项目链接</span><br><span class="line">				res.write(`&lt;a target=&quot;_self&quot; href=&quot;/$&#123;i&#125;&quot;&gt;/$&#123;i&#125;&lt;/a&gt;&lt;/br&gt;`);</span><br><span class="line">			&#125;</span><br><span class="line">			res.end()</span><br><span class="line">		&#125;);</span><br><span class="line">		app.get(&apos;/goods/list&apos;, (req, res, next) =&gt; &#123;  //mock数据</span><br><span class="line">			res.status(299).json(mock)</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h3 id="拦截器"><a href="#拦截器" class="headerlink" title="拦截器"></a>拦截器</h3><p><a href="https://juejin.im/post/5c403bcaf265da61587765c9" target="_blank" rel="noopener">【vue-cli3升级】老项目提速50%（二）</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">import store from &apos;@/store&apos;</span><br><span class="line">import axios from &apos;axios&apos;</span><br><span class="line">import &#123; Toast &#125; from &apos;vant&apos;</span><br><span class="line">import util from &apos;@/libs/util&apos;</span><br><span class="line"></span><br><span class="line">// 创建一个错误</span><br><span class="line">const errorCreate = msg =&gt; &#123;</span><br><span class="line">  const err = new Error(msg)</span><br><span class="line">  errorLog(err)</span><br><span class="line">  throw err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 记录和显示错误</span><br><span class="line">const errorLog = err =&gt; &#123;</span><br><span class="line">  // 添加到日志</span><br><span class="line">  store.dispatch(&apos;xxx/log/add&apos;, &#123;</span><br><span class="line">    type: &apos;error&apos;,</span><br><span class="line">    err,</span><br><span class="line">    info: &apos;数据请求异常&apos;</span><br><span class="line">  &#125;)</span><br><span class="line">  // 打印到控制台</span><br><span class="line">  if (process.env.NODE_ENV === &apos;development&apos;) &#123;</span><br><span class="line">    util.log.danger(&apos;&gt;&gt;&gt;&gt;&gt;&gt; Error &gt;&gt;&gt;&gt;&gt;&gt;&apos;)</span><br><span class="line">    console.log(err)</span><br><span class="line">  &#125;</span><br><span class="line">  // 显示提示</span><br><span class="line">  Toast(&#123;</span><br><span class="line">    message: err.message,</span><br><span class="line">    type: &apos;error&apos;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 创建一个 axios 实例</span><br><span class="line">const service = axios.create(&#123;</span><br><span class="line">  baseURL: process.env.VUE_APP_BASE_API,</span><br><span class="line">  timeout: 5000 // 请求超时时间</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 请求拦截器</span><br><span class="line">service.interceptors.request.use(</span><br><span class="line">  config =&gt; &#123;</span><br><span class="line">    // 在请求发送之前做一些处理</span><br><span class="line">    const token = util.cookies.get(&apos;token&apos;)</span><br><span class="line">    config.headers[&apos;X-Token&apos;] = token</span><br><span class="line">    // 处理mock</span><br><span class="line">    if (process.env.VUE_APP_MOCK &amp;&amp; config.isMock) &#123;</span><br><span class="line">      config.url = `$&#123;process.env.VUE_APP_MOCK_BASE_URL&#125;/$&#123;config.url&#125;`</span><br><span class="line">    &#125;</span><br><span class="line">    return config</span><br><span class="line">  &#125;,</span><br><span class="line">  error =&gt; &#123;</span><br><span class="line">    // 发送失败</span><br><span class="line">    console.log(error)</span><br><span class="line">    Promise.reject(error)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">// 响应拦截器</span><br><span class="line">service.interceptors.response.use(</span><br><span class="line">  response =&gt; &#123;</span><br><span class="line">    const dataAxios = response.data</span><br><span class="line">    const &#123; code &#125; = dataAxios</span><br><span class="line">    if (!code) return dataAxios</span><br><span class="line">    switch (code) &#123;</span><br><span class="line">      case 0:</span><br><span class="line">      case 10000:</span><br><span class="line">        // 成功</span><br><span class="line">        return dataAxios.data</span><br><span class="line">      case &apos;xxx&apos;:</span><br><span class="line">        errorCreate(`[ code: xxx ] $&#123;dataAxios.msg&#125;: $&#123;response.config.url&#125;`)</span><br><span class="line">        break</span><br><span class="line">      default:</span><br><span class="line">        // 不是正确的 code</span><br><span class="line">        errorCreate(`$&#123;dataAxios.msg&#125;: $&#123;response.config.url&#125;`)</span><br><span class="line">        break</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  error =&gt; &#123;</span><br><span class="line">    if (error &amp;&amp; error.response) &#123;</span><br><span class="line">      switch (error.response.status) &#123;</span><br><span class="line">        case 400: error.message = &apos;请求错误&apos;; break</span><br><span class="line">        case 401: error.message = &apos;未授权，请登录&apos;; break</span><br><span class="line">        case 403: error.message = &apos;拒绝访问&apos;; break</span><br><span class="line">        case 404: error.message = `请求地址出错: $&#123;error.response.config.url&#125;`; break</span><br><span class="line">        case 408: error.message = &apos;请求超时&apos;; break</span><br><span class="line">        case 500: error.message = &apos;服务器内部错误&apos;; break</span><br><span class="line">        case 501: error.message = &apos;服务未实现&apos;; break</span><br><span class="line">        case 502: error.message = &apos;网关错误&apos;; break</span><br><span class="line">        case 503: error.message = &apos;服务不可用&apos;; break</span><br><span class="line">        case 504: error.message = &apos;网关超时&apos;; break</span><br><span class="line">        case 505: error.message = &apos;HTTP版本不受支持&apos;; break</span><br><span class="line">        default: break</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    errorLog(error)</span><br><span class="line">    return Promise.reject(error)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line">export default service</span><br></pre></td></tr></table></figure></p>
<hr>
<h3 id="vue-cli3-全面配置-持续更新"><a href="#vue-cli3-全面配置-持续更新" class="headerlink" title="vue-cli3 全面配置(持续更新)"></a>vue-cli3 全面配置(持续更新)</h3><p><span id="top">目录</span></p>
<ul>
<li><a href="#env">√ 配置多环境变量</a></li>
<li><a href="#base">√ 配置基础 vue.config.js</a></li>
<li><a href="#proxy">√ 配置 proxy 跨域</a></li>
<li><a href="#hmr">√ 修复 HMR(热更新)失效</a></li>
<li><a href="#lazyloading">√ 修复 Lazy loading routes Error： Cyclic dependency</a></li>
<li><a href="#alias">√ 添加别名</a></li>
<li><a href="#removecss">√ 去除多余无效的 css</a></li>
<li><a href="#analyze">√ 添加打包分析</a></li>
<li><a href="#externals">√ 配置 externals</a></li>
<li><a href="#log">√ 去掉 console.log</a></li>
<li><a href="#gzip">√ 开启 gzip 压缩</a></li>
<li><a href="#globalscss">√ 为 sass 提供全局样式，以及全局变量</a></li>
<li><a href="#ie">√ 添加 IE 兼容</a></li>
<li><a href="#alioss">√ 文件上传 ali oss</a></li>
<li><a href="#allconfig">√ 完整依赖</a></li>
</ul>
<h3 id="☞-配置多环境变量"><a href="#☞-配置多环境变量" class="headerlink" title="☞ 配置多环境变量"></a><span id="env">☞ 配置多环境变量</span></h3><p>&emsp;&emsp;通过在 package.json 里的 scripts 配置项中添加–mode xxx 来选择不同环境</p>
<p>&emsp;&emsp;在项目根目录中新建.env, .env.production, .env.analyz 等文件</p>
<p>&emsp;&emsp;只有以 VUE<em>APP</em> 开头的变量会被 webpack.DefinePlugin 静态嵌入到客户端侧的包中，代码中可以通过 process.env.VUE_APP_BASE_API 访问</p>
<p>&emsp;&emsp;NODE_ENV 和 BASE_URL 是两个特殊变量，在代码中始终可用</p>
<h5 id="env-serve-默认的环境变量"><a href="#env-serve-默认的环境变量" class="headerlink" title=".env serve 默认的环境变量"></a>.env serve 默认的环境变量</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NODE_ENV = &apos;development&apos;</span><br><span class="line">VUE_APP_BASE_API = &apos;https://demo.cn/api&apos;</span><br></pre></td></tr></table></figure>
<h5 id="env-production-build-默认的环境变量"><a href="#env-production-build-默认的环境变量" class="headerlink" title=".env.production build 默认的环境变量"></a>.env.production build 默认的环境变量</h5><p>&emsp;&emsp;如果开启 ali oss,VUE_APP_SRC 配置为 ali oss 资源 url 前缀，如：’<a href="https://staven.oss-cn-hangzhou.aliyuncs.com/demo&#39;" target="_blank" rel="noopener">https://staven.oss-cn-hangzhou.aliyuncs.com/demo&#39;</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">NODE_ENV = &apos;production&apos;</span><br><span class="line"></span><br><span class="line">VUE_APP_BASE_API = &apos;https://demo.com/api&apos;</span><br><span class="line">VUE_APP_SRC = &apos;/&apos;</span><br><span class="line"></span><br><span class="line">ACCESS_KEY_ID = &apos;&apos;</span><br><span class="line">ACCESS_KEY_SECRET = &apos;&apos;</span><br><span class="line">REGION = &apos;oss-cn-hangzhou&apos;</span><br><span class="line">BUCKET = &apos;staven&apos;</span><br><span class="line">PREFIX = &apos;demo&apos;</span><br></pre></td></tr></table></figure>
<h5 id="env-analyz-用于-webpack-bundle-analyzer-打包分析"><a href="#env-analyz-用于-webpack-bundle-analyzer-打包分析" class="headerlink" title=".env.analyz 用于 webpack-bundle-analyzer 打包分析"></a>.env.analyz 用于 webpack-bundle-analyzer 打包分析</h5><p>&emsp;&emsp;如果开启 ali oss,VUE_APP_SRC 配置为 ali oss 资源 url 前缀，如：’<a href="https://staven.oss-cn-hangzhou.aliyuncs.com/demo&#39;" target="_blank" rel="noopener">https://staven.oss-cn-hangzhou.aliyuncs.com/demo&#39;</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">NODE_ENV = &apos;production&apos;</span><br><span class="line">IS_ANALYZ = &apos;analyz&apos;</span><br><span class="line"></span><br><span class="line">VUE_APP_BASE_API = &apos;https://demo.com/api&apos;</span><br><span class="line">VUE_APP_SRC = &apos;/&apos;</span><br><span class="line"></span><br><span class="line">ACCESS_KEY_ID = &apos;&apos;</span><br><span class="line">ACCESS_KEY_SECRET = &apos;&apos;</span><br><span class="line">REGION = &apos;oss-cn-hangzhou&apos;</span><br><span class="line">BUCKET = &apos;staven&apos;</span><br><span class="line">PREFIX = &apos;demo&apos;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;修改 package.json</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">  &quot;serve&quot;: &quot;vue-cli-service serve&quot;,</span><br><span class="line">  &quot;build&quot;: &quot;vue-cli-service build&quot;,</span><br><span class="line">  &quot;analyz&quot;: &quot;vue-cli-service build --mode analyz&quot;,</span><br><span class="line">  &quot;lint&quot;: &quot;vue-cli-service lint&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="#top">▲ 回顶部</a></p>
<h3 id="☞-配置基础-vue-config-js"><a href="#☞-配置基础-vue-config-js" class="headerlink" title="☞ 配置基础 vue.config.js"></a><span id="base">☞ 配置基础 vue.config.js</span></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">const IS_PROD = [&apos;production&apos;, &apos;prod&apos;].includes(process.env.NODE_ENV);</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">  baseUrl: &apos;./&apos;, // 默认&apos;/&apos;，部署应用包时的基本 URL</span><br><span class="line">  outputDir: process.env.outputDir || &apos;dist&apos;, // &apos;dist&apos;, 生产环境构建文件的目录</span><br><span class="line">  assetsDir: &apos;&apos;,  // 相对于outputDir的静态资源(js、css、img、fonts)目录</span><br><span class="line">  lintOnSave: false,</span><br><span class="line">  runtimeCompiler: true, // 是否使用包含运行时编译器的 Vue 构建版本</span><br><span class="line">  productionSourceMap: false,  // 生产环境的 source map</span><br><span class="line">  parallel: require(&apos;os&apos;).cpus().length &gt; 1,</span><br><span class="line">  pwa: &#123;&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><a href="#top">▲ 回顶部</a></p>
<h3 id="☞-配置-proxy-跨域"><a href="#☞-配置-proxy-跨域" class="headerlink" title="☞ 配置 proxy 跨域"></a><span id="proxy">☞ 配置 proxy 跨域</span></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">const IS_PROD = [&apos;production&apos;, &apos;prod&apos;].includes(process.env.NODE_ENV);</span><br><span class="line">module.exports = &#123;</span><br><span class="line">    devServer: &#123;</span><br><span class="line">        // overlay: &#123;</span><br><span class="line">        //   warnings: true,</span><br><span class="line">        //   errors: true</span><br><span class="line">        // &#125;,</span><br><span class="line">        open: IS_PROD,</span><br><span class="line">        host: &apos;0.0.0.0&apos;,</span><br><span class="line">        port: 8000,</span><br><span class="line">        https: false,</span><br><span class="line">        hotOnly: false,</span><br><span class="line">        proxy: &#123;</span><br><span class="line">          &apos;/api&apos;: &#123;</span><br><span class="line">            target: process.env.VUE_APP_BASE_API || &apos;http://127.0.0.1:8080&apos;,</span><br><span class="line">            changeOrigin: true</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="#top">▲ 回顶部</a></p>
<h3 id="☞-修复-HMR-热更新-失效"><a href="#☞-修复-HMR-热更新-失效" class="headerlink" title="☞ 修复 HMR(热更新)失效"></a><span id="hmr">☞ 修复 HMR(热更新)失效</span></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">    chainWebpack: config =&gt; &#123;</span><br><span class="line">        // 修复HMR</span><br><span class="line">        config.resolve.symlinks(true);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="#top">▲ 回顶部</a></p>
<h3 id="☞-修复-Lazy-loading-routes-Error：-Cyclic-dependency-https-github-com-vuejs-vue-cli-issues-1669"><a href="#☞-修复-Lazy-loading-routes-Error：-Cyclic-dependency-https-github-com-vuejs-vue-cli-issues-1669" class="headerlink" title="☞ 修复 Lazy loading routes Error： Cyclic dependency https://github.com/vuejs/vue-cli/issues/1669"></a><span id="lazyloading">☞ 修复 Lazy loading routes Error： Cyclic dependency</span> <a href="https://github.com/vuejs/vue-cli/issues/1669" target="_blank" rel="noopener">https://github.com/vuejs/vue-cli/issues/1669</a></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">    chainWebpack: config =&gt; &#123;</span><br><span class="line">        config.plugin(&apos;html&apos;).tap(args =&gt; &#123;</span><br><span class="line">            args[0].chunksSortMode = &apos;none&apos;;</span><br><span class="line">            return args;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="#top">▲ 回顶部</a></p>
<h3 id="☞-添加别名"><a href="#☞-添加别名" class="headerlink" title="☞ 添加别名"></a><span id="alias">☞ 添加别名</span></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">const path =  require(&apos;path&apos;);</span><br><span class="line">const resolve = (dir) =&gt; path.join(__dirname, dir);</span><br><span class="line">const IS_PROD = [&apos;production&apos;, &apos;prod&apos;].includes(process.env.NODE_ENV);</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">    chainWebpack: config =&gt; &#123;</span><br><span class="line">        // 添加别名</span><br><span class="line">        config.resolve.alias</span><br><span class="line">          .set(&apos;@&apos;, resolve(&apos;src&apos;))</span><br><span class="line">          .set(&apos;assets&apos;, resolve(&apos;src/assets&apos;))</span><br><span class="line">          .set(&apos;components&apos;, resolve(&apos;src/components&apos;))</span><br><span class="line">          .set(&apos;layout&apos;, resolve(&apos;src/layout&apos;))</span><br><span class="line">          .set(&apos;base&apos;, resolve(&apos;src/base&apos;))</span><br><span class="line">          .set(&apos;static&apos;, resolve(&apos;src/static&apos;));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="#top">▲ 回顶部</a></p>
<h3 id="☞-去除多余无效的-css"><a href="#☞-去除多余无效的-css" class="headerlink" title="☞ 去除多余无效的 css"></a><span id="removecss">☞ 去除多余无效的 css</span></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i --save-dev glob-all purgecss-webpack-plugin</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">const PurgecssPlugin = require(&apos;purgecss-webpack-plugin&apos;);</span><br><span class="line">const glob = require(&apos;glob-all&apos;);</span><br><span class="line">const path = require(&apos;path&apos;)</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">    configureWebpack: config =&gt; &#123;</span><br><span class="line">        if (IS_PROD) &#123;</span><br><span class="line">            const plugins = [];</span><br><span class="line">            plugins.push(</span><br><span class="line">                new PurgecssPlugin(&#123;</span><br><span class="line">                    paths: glob.sync([</span><br><span class="line">                    path.join(__dirname, &apos;./src/index.html&apos;),</span><br><span class="line">                    path.join(__dirname, &apos;./**/*.vue&apos;),</span><br><span class="line">                    path.join(__dirname, &apos;./src/**/*.js&apos;)</span><br><span class="line">                    ])</span><br><span class="line">                &#125;)</span><br><span class="line">            );</span><br><span class="line">            config.plugins = [</span><br><span class="line">                ...config.plugins,</span><br><span class="line">                ...plugins</span><br><span class="line">            ];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="#top">▲ 回顶部</a></p>
<h3 id="☞-添加打包分析"><a href="#☞-添加打包分析" class="headerlink" title="☞ 添加打包分析"></a><span id="analyze">☞ 添加打包分析</span></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">const BundleAnalyzerPlugin = require(&apos;webpack-bundle-analyzer&apos;).BundleAnalyzerPlugin;</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">    chainWebpack: config =&gt; &#123;</span><br><span class="line">        // 打包分析</span><br><span class="line">        if (process.env.IS_ANALYZ) &#123;</span><br><span class="line">          config.plugin(&apos;webpack-report&apos;)</span><br><span class="line">            .use(BundleAnalyzerPlugin, [&#123;</span><br><span class="line">              analyzerMode: &apos;static&apos;,</span><br><span class="line">            &#125;]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="#top">▲ 回顶部</a></p>
<h3 id="☞-配置-externals"><a href="#☞-配置-externals" class="headerlink" title="☞ 配置 externals"></a><span id="externals">☞ 配置 externals</span></h3><p>&emsp;&emsp;防止将某些 import 的包(package)打包到 bundle 中，而是在运行时(runtime)再去从外部获取这些扩展依赖</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">    configureWebpack: config =&gt; &#123;</span><br><span class="line">        config.externals = &#123;</span><br><span class="line">          &apos;vue&apos;: &apos;Vue&apos;,</span><br><span class="line">          &apos;element-ui&apos;: &apos;ELEMENT&apos;,</span><br><span class="line">          &apos;vue-router&apos;: &apos;VueRouter&apos;,</span><br><span class="line">          &apos;vuex&apos;: &apos;Vuex&apos;,</span><br><span class="line">          &apos;axios&apos;: &apos;axios&apos;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="#top">▲ 回顶部</a></p>
<h3 id="☞-去掉-console-log"><a href="#☞-去掉-console-log" class="headerlink" title="☞ 去掉 console.log"></a><span id="log">☞ 去掉 console.log</span></h3><h5 id="方法一："><a href="#方法一：" class="headerlink" title="方法一："></a>方法一：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">const UglifyJsPlugin = require(&apos;uglifyjs-webpack-plugin&apos;);</span><br><span class="line">module.exports = &#123;</span><br><span class="line">    configureWebpack: config =&gt; &#123;</span><br><span class="line">        if (IS_PROD) &#123;</span><br><span class="line">            const plugins = [];</span><br><span class="line">            plugins.push(</span><br><span class="line">                new UglifyJsPlugin(&#123;</span><br><span class="line">                    uglifyOptions: &#123;</span><br><span class="line">                        compress: &#123;</span><br><span class="line">                            warnings: false,</span><br><span class="line">                            drop_console: true,</span><br><span class="line">                            drop_debugger: false,</span><br><span class="line">                            pure_funcs: [&apos;console.log&apos;]//移除console</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    sourceMap: false,</span><br><span class="line">                    parallel: true</span><br><span class="line">                &#125;)</span><br><span class="line">            );</span><br><span class="line">            config.plugins = [</span><br><span class="line">                ...config.plugins,</span><br><span class="line">                ...plugins</span><br><span class="line">            ];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="方法二：使用-babel-plugin-transform-remove-console-插件"><a href="#方法二：使用-babel-plugin-transform-remove-console-插件" class="headerlink" title="方法二：使用 babel-plugin-transform-remove-console 插件"></a>方法二：使用 babel-plugin-transform-remove-console 插件</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i --save-dev babel-plugin-transform-remove-console</span><br></pre></td></tr></table></figure>
<p>在 babel.config.js 中配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const plugins = [];</span><br><span class="line">if([&apos;production&apos;, &apos;prod&apos;].includes(process.env.NODE_ENV)) &#123;</span><br><span class="line">  plugins.push(&quot;transform-remove-console&quot;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">  presets: [[&quot;@vue/app&quot;,&#123;&quot;useBuiltIns&quot;: &quot;entry&quot;&#125;]],</span><br><span class="line">  plugins: plugins</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><a href="#top">▲ 回顶部</a></p>
<h3 id="☞-开启-gzip-压缩"><a href="#☞-开启-gzip-压缩" class="headerlink" title="☞ 开启 gzip 压缩"></a><span id="gzip">☞ 开启 gzip 压缩</span></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i --save-dev compression-webpack-plugin</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">const CompressionWebpackPlugin = require(&apos;compression-webpack-plugin&apos;);</span><br><span class="line">const productionGzipExtensions = /\.(js|css|json|txt|html|ico|svg)(\?.*)?$/i;</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">    configureWebpack: config =&gt; &#123;</span><br><span class="line">        if (IS_PROD) &#123;</span><br><span class="line">            const plugins = [];</span><br><span class="line">            plugins.push(</span><br><span class="line">                new CompressionWebpackPlugin(&#123;</span><br><span class="line">                    filename: &apos;[path].gz[query]&apos;,</span><br><span class="line">                    algorithm: &apos;gzip&apos;,</span><br><span class="line">                    test: productionGzipExtensions,</span><br><span class="line">                    threshold: 10240,</span><br><span class="line">                    minRatio: 0.8</span><br><span class="line">                &#125;)</span><br><span class="line">            );</span><br><span class="line">            config.plugins = [</span><br><span class="line">                ...config.plugins,</span><br><span class="line">                ...plugins</span><br><span class="line">            ];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;还可以开启比 gzip 体验更好的 Zopfli 压缩详见<a href="https://webpack.js.org/plugins/compression-webpack-plugin" target="_blank" rel="noopener">https://webpack.js.org/plugins/compression-webpack-plugin</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i --save-dev @gfx/zopfli brotli-webpack-plugin</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">const CompressionWebpackPlugin = require(&apos;compression-webpack-plugin&apos;);</span><br><span class="line">const zopfli = require(&quot;@gfx/zopfli&quot;);</span><br><span class="line">const BrotliPlugin = require(&quot;brotli-webpack-plugin&quot;);</span><br><span class="line">const productionGzipExtensions = /\.(js|css|json|txt|html|ico|svg)(\?.*)?$/i;</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">    configureWebpack: config =&gt; &#123;</span><br><span class="line">        if (IS_PROD) &#123;</span><br><span class="line">            const plugins = [];</span><br><span class="line">            plugins.push(</span><br><span class="line">                new CompressionWebpackPlugin(&#123;</span><br><span class="line">                    algorithm(input, compressionOptions, callback) &#123;</span><br><span class="line">                      return zopfli.gzip(input, compressionOptions, callback);</span><br><span class="line">                    &#125;,</span><br><span class="line">                    compressionOptions: &#123;</span><br><span class="line">                      numiterations: 15</span><br><span class="line">                    &#125;,</span><br><span class="line">                    minRatio: 0.99,</span><br><span class="line">                    test: productionGzipExtensions</span><br><span class="line">                &#125;)</span><br><span class="line">            );</span><br><span class="line">            plugins.push(</span><br><span class="line">                new BrotliPlugin(&#123;</span><br><span class="line">                    test: productionGzipExtensions,</span><br><span class="line">                    minRatio: 0.99</span><br><span class="line">                &#125;)</span><br><span class="line">            );</span><br><span class="line">            config.plugins = [</span><br><span class="line">                ...config.plugins,</span><br><span class="line">                ...plugins</span><br><span class="line">            ];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="#top">▲ 回顶部</a></p>
<h3 id="☞-为-sass-提供全局样式，以及全局变量"><a href="#☞-为-sass-提供全局样式，以及全局变量" class="headerlink" title="☞ 为 sass 提供全局样式，以及全局变量"></a><span id="globalscss">☞ 为 sass 提供全局样式，以及全局变量</span></h3><p>&emsp;&emsp;可以通过在 main.js 中 Vue.prototype.$src = process.env.VUE_APP_SRC;挂载环境变量中的配置信息，然后在js中使用$src 访问。</p>
<p>&emsp;&emsp;css 中可以使用注入 sass 变量访问环境变量中的配置信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">    css: &#123;</span><br><span class="line">        modules: false,</span><br><span class="line">        extract: IS_PROD,</span><br><span class="line">        sourceMap: false,</span><br><span class="line">        loaderOptions: &#123;</span><br><span class="line">          sass: &#123;</span><br><span class="line">            // 向全局sass样式传入共享的全局变量</span><br><span class="line">            data: `@import &quot;~assets/scss/variables.scss&quot;;$src: &quot;$&#123;process.env.VUE_APP_SRC&#125;&quot;;`</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 scss 中引用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.home &#123;</span><br><span class="line">    background: url($src + &apos;/images/500.png&apos;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="#top">▲ 回顶部</a></p>
<h3 id="☞-添加-IE-兼容"><a href="#☞-添加-IE-兼容" class="headerlink" title="☞ 添加 IE 兼容"></a><span id="ie">☞ 添加 IE 兼容</span></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i --save @babel/polyfill</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;在 main.js 中添加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import &apos;@babel/polyfill&apos;;</span><br></pre></td></tr></table></figure>
<p>配置 babel.config.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">const plugins = [];</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">  presets: [[&quot;@vue/app&quot;,&#123;&quot;useBuiltIns&quot;: &quot;entry&quot;&#125;]],</span><br><span class="line">  plugins: plugins</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><a href="#top">▲ 回顶部</a></p>
<h3 id="☞-文件上传-ali-oss"><a href="#☞-文件上传-ali-oss" class="headerlink" title="☞ 文件上传 ali oss"></a><span id="alioss">☞ 文件上传 ali oss</span></h3><p>&emsp;&emsp;开启文件上传 ali oss，需要将 baseUrl 改成 ali oss 资源 url 前缀,也就是修改 VUE_APP_SRC</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i --save-dev webpack-oss</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">const AliOssPlugin = require(&apos;webpack-oss&apos;);</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">    configureWebpack: config =&gt; &#123;</span><br><span class="line">        if (IS_PROD) &#123;</span><br><span class="line">            const plugins = [];</span><br><span class="line">            // 上传文件到oss</span><br><span class="line">            if (process.env.ACCESS_KEY_ID || process.env.ACCESS_KEY_SECRET || process.env.REGION || process.env.BUCKET || process.env.PREFIX) &#123;</span><br><span class="line">                plugins.push(</span><br><span class="line">                    new AliOssPlugin(&#123;</span><br><span class="line">                        accessKeyId: process.env.ACCESS_KEY_ID,</span><br><span class="line">                        accessKeySecret: process.env.ACCESS_KEY_SECRET,</span><br><span class="line">                        region: process.env.REGION,</span><br><span class="line">                        bucket: process.env.BUCKET,</span><br><span class="line">                        prefix: process.env.PREFIX,</span><br><span class="line">                        exclude: /.*\.html$/,</span><br><span class="line">                        deleteAll: false</span><br><span class="line">                    &#125;)</span><br><span class="line">                );</span><br><span class="line">            &#125;</span><br><span class="line">            config.plugins = [</span><br><span class="line">                ...config.plugins,</span><br><span class="line">                ...plugins</span><br><span class="line">            ];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="#top">▲ 回顶部</a></p>
<h3 id="☞-完整配置"><a href="#☞-完整配置" class="headerlink" title="☞ 完整配置"></a><span id="allconfig">☞ 完整配置</span></h3><ul>
<li>安装依赖</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i --save-dev compression-webpack-plugin babel-plugin-transform-remove-console  glob-all purgecss-webpack-plugin</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;其他依赖(@gfx/zopfli、brotli-webpack-plugin、webpack-oss)根据需求选择安装</p>
<ul>
<li>环境配置</li>
</ul>
<p>.env</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NODE_ENV = &apos;development&apos;</span><br><span class="line">VUE_APP_BASE_API = &apos;https://demo.cn/api&apos;</span><br></pre></td></tr></table></figure>
<p>.env.production</p>
<p>&emsp;&emsp;如果开启 ali oss,VUE_APP_SRC 配置为 ali oss 资源 url 前缀，如：’<a href="https://staven.oss-cn-hangzhou.aliyuncs.com/demo&#39;" target="_blank" rel="noopener">https://staven.oss-cn-hangzhou.aliyuncs.com/demo&#39;</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">NODE_ENV = &apos;production&apos;</span><br><span class="line"></span><br><span class="line">VUE_APP_BASE_API = &apos;https://demo.com/api&apos;</span><br><span class="line">VUE_APP_SRC = &apos;/&apos;</span><br><span class="line"></span><br><span class="line">ACCESS_KEY_ID = &apos;&apos;</span><br><span class="line">ACCESS_KEY_SECRET = &apos;&apos;</span><br><span class="line">REGION = &apos;oss-cn-hangzhou&apos;</span><br><span class="line">BUCKET = &apos;staven&apos;</span><br><span class="line">PREFIX = &apos;demo&apos;</span><br></pre></td></tr></table></figure>
<p>.env.analyz</p>
<p>&emsp;&emsp;如果开启 ali oss,VUE_APP_SRC 配置为 ali oss 资源 url 前缀，如：’<a href="https://staven.oss-cn-hangzhou.aliyuncs.com/demo&#39;" target="_blank" rel="noopener">https://staven.oss-cn-hangzhou.aliyuncs.com/demo&#39;</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">NODE_ENV = &apos;production&apos;</span><br><span class="line">IS_ANALYZ = &apos;analyz&apos;</span><br><span class="line"></span><br><span class="line">VUE_APP_BASE_API = &apos;https://demo.com/api&apos;</span><br><span class="line">VUE_APP_SRC = VUE_APP_SRC = &apos;/&apos;</span><br><span class="line"></span><br><span class="line">ACCESS_KEY_ID = &apos;&apos;</span><br><span class="line">ACCESS_KEY_SECRET = &apos;&apos;</span><br><span class="line">REGION = &apos;oss-cn-hangzhou&apos;</span><br><span class="line">BUCKET = &apos;staven&apos;</span><br><span class="line">PREFIX = &apos;demo&apos;</span><br></pre></td></tr></table></figure>
<ul>
<li>package.json</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;serve&quot;: &quot;vue-cli-service serve&quot;,</span><br><span class="line">    &quot;build&quot;: &quot;vue-cli-service build&quot;,</span><br><span class="line">    &quot;analyz&quot;: &quot;vue-cli-service build --mode analyz&quot;,</span><br><span class="line">    &quot;lint&quot;: &quot;vue-cli-service lint&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>babel.config.js</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const plugins = [];</span><br><span class="line">// if([&apos;production&apos;, &apos;prod&apos;].includes(process.env.NODE_ENV)) &#123;</span><br><span class="line">//   plugins.push(&quot;transform-remove-console&quot;)</span><br><span class="line">// &#125;</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">  presets: [[&quot;@vue/app&quot;,&#123;&quot;useBuiltIns&quot;: &quot;entry&quot;&#125;]],</span><br><span class="line">  plugins: plugins</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>vue.config.js</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br></pre></td><td class="code"><pre><span class="line">const BundleAnalyzerPlugin = require(&quot;webpack-bundle-analyzer&quot;)</span><br><span class="line">  .BundleAnalyzerPlugin;</span><br><span class="line">const UglifyJsPlugin = require(&quot;uglifyjs-webpack-plugin&quot;);</span><br><span class="line">const CompressionWebpackPlugin = require(&quot;compression-webpack-plugin&quot;);</span><br><span class="line">// const zopfli = require(&quot;@gfx/zopfli&quot;);</span><br><span class="line">// const BrotliPlugin = require(&quot;brotli-webpack-plugin&quot;);</span><br><span class="line">const AliOssPlugin = require(&quot;webpack-oss&quot;);</span><br><span class="line"></span><br><span class="line">const path = require(&quot;path&quot;);</span><br><span class="line">const PurgecssPlugin = require(&quot;purgecss-webpack-plugin&quot;);</span><br><span class="line">const glob = require(&quot;glob-all&quot;);</span><br><span class="line"></span><br><span class="line">const resolve = dir =&gt; path.join(__dirname, dir);</span><br><span class="line">const IS_PROD = [&quot;production&quot;, &quot;prod&quot;].includes(process.env.NODE_ENV);</span><br><span class="line">const productionGzipExtensions = /\.(js|css|json|txt|html|ico|svg)(\?.*)?$/i;</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">  baseUrl: IS_PROD ? process.env.VUE_APP_SRC || &quot;/&quot; : &quot;./&quot;, // 默认&apos;/&apos;，部署应用包时的基本 URL</span><br><span class="line">  outputDir: process.env.outputDir || &quot;dist&quot;, // &apos;dist&apos;, 生产环境构建文件的目录</span><br><span class="line">  assetsDir: &quot;&quot;, // 相对于outputDir的静态资源(js、css、img、fonts)目录</span><br><span class="line">  lintOnSave: false,</span><br><span class="line">  runtimeCompiler: true, // 是否使用包含运行时编译器的 Vue 构建版本</span><br><span class="line">  productionSourceMap: false, // 生产环境的 source map</span><br><span class="line"></span><br><span class="line">  configureWebpack: config =&gt; &#123;</span><br><span class="line">    // cdn引用时配置externals</span><br><span class="line">    // config.externals = &#123;</span><br><span class="line">    //     &apos;vue&apos;: &apos;Vue&apos;,</span><br><span class="line">    //     &apos;element-ui&apos;: &apos;ELEMENT&apos;,</span><br><span class="line">    //     &apos;vue-router&apos;: &apos;VueRouter&apos;,</span><br><span class="line">    //     &apos;vuex&apos;: &apos;Vuex&apos;,</span><br><span class="line">    //     &apos;axios&apos;: &apos;axios&apos;</span><br><span class="line">    // &#125;</span><br><span class="line"></span><br><span class="line">    if (IS_PROD) &#123;</span><br><span class="line">      const plugins = [];</span><br><span class="line"></span><br><span class="line">      plugins.push(</span><br><span class="line">        new PurgecssPlugin(&#123;</span><br><span class="line">          paths: glob.sync([</span><br><span class="line">            path.join(__dirname, &quot;./src/index.html&quot;),</span><br><span class="line">            path.join(__dirname, &quot;./**/*.vue&quot;),</span><br><span class="line">            path.join(__dirname, &quot;./src/**/*.js&quot;)</span><br><span class="line">          ])</span><br><span class="line">        &#125;)</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">      plugins.push(</span><br><span class="line">        new UglifyJsPlugin(&#123;</span><br><span class="line">          uglifyOptions: &#123;</span><br><span class="line">            compress: &#123;</span><br><span class="line">              warnings: false,</span><br><span class="line">              drop_console: true,</span><br><span class="line">              drop_debugger: false,</span><br><span class="line">              pure_funcs: [&quot;console.log&quot;] //移除console</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          sourceMap: false,</span><br><span class="line">          parallel: true</span><br><span class="line">        &#125;)</span><br><span class="line">      );</span><br><span class="line">      plugins.push(</span><br><span class="line">        new CompressionWebpackPlugin(&#123;</span><br><span class="line">          filename: &quot;[path].gz[query]&quot;,</span><br><span class="line">          algorithm: &quot;gzip&quot;,</span><br><span class="line">          test: productionGzipExtensions,</span><br><span class="line">          threshold: 10240,</span><br><span class="line">          minRatio: 0.8</span><br><span class="line">        &#125;)</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">      // 上传文件到oss</span><br><span class="line">      //if (process.env.ACCESS_KEY_ID || process.env.ACCESS_KEY_SECRET || process.env.REGION || process.env.BUCKET || process.env.PREFIX) &#123;</span><br><span class="line">      //    plugins.push(</span><br><span class="line">      //        new AliOssPlugin(&#123;</span><br><span class="line">      //            accessKeyId: process.env.ACCESS_KEY_ID,</span><br><span class="line">      //            accessKeySecret: process.env.ACCESS_KEY_SECRET,</span><br><span class="line">      //            region: process.env.REGION,</span><br><span class="line">      //            bucket: process.env.BUCKET,</span><br><span class="line">      //            prefix: process.env.PREFIX,</span><br><span class="line">      //            exclude: /.*\.html$/,</span><br><span class="line">      //            deleteAll: false</span><br><span class="line">      //        &#125;)</span><br><span class="line">      //    );</span><br><span class="line">      //&#125;</span><br><span class="line"></span><br><span class="line">      // Zopfli压缩，需要响应VC库 https://webpack.js.org/plugins/compression-webpack-plugin/</span><br><span class="line">      // plugins.push(</span><br><span class="line">      //     new CompressionWebpackPlugin(&#123;</span><br><span class="line">      //         algorithm(input, compressionOptions, callback) &#123;</span><br><span class="line">      //             return zopfli.gzip(input, compressionOptions, callback);</span><br><span class="line">      //         &#125;,</span><br><span class="line">      //         compressionOptions: &#123;</span><br><span class="line">      //             numiterations: 15</span><br><span class="line">      //         &#125;,</span><br><span class="line">      //         minRatio: 0.99,</span><br><span class="line">      //         test: productionGzipExtensions</span><br><span class="line">      //     &#125;)</span><br><span class="line">      // );</span><br><span class="line">      // plugins.push(</span><br><span class="line">      //     new BrotliPlugin(&#123;</span><br><span class="line">      //         test: productionGzipExtensions,</span><br><span class="line">      //         minRatio: 0.99</span><br><span class="line">      //     &#125;)</span><br><span class="line">      // );</span><br><span class="line">      config.plugins = [...config.plugins, ...plugins];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  chainWebpack: config =&gt; &#123;</span><br><span class="line">    // 修复HMR</span><br><span class="line">    config.resolve.symlinks(true);</span><br><span class="line"></span><br><span class="line">    // 修复Lazy loading routes Error： Cyclic dependency  [https://github.com/vuejs/vue-cli/issues/1669]</span><br><span class="line">    config.plugin(&quot;html&quot;).tap(args =&gt; &#123;</span><br><span class="line">      args[0].chunksSortMode = &quot;none&quot;;</span><br><span class="line">      return args;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    // 添加别名</span><br><span class="line">    config.resolve.alias</span><br><span class="line">      .set(&quot;@&quot;, resolve(&quot;src&quot;))</span><br><span class="line">      .set(&quot;assets&quot;, resolve(&quot;src/assets&quot;))</span><br><span class="line">      .set(&quot;components&quot;, resolve(&quot;src/components&quot;))</span><br><span class="line">      .set(&quot;layout&quot;, resolve(&quot;src/layout&quot;))</span><br><span class="line">      .set(&quot;base&quot;, resolve(&quot;src/base&quot;))</span><br><span class="line">      .set(&quot;static&quot;, resolve(&quot;src/static&quot;));</span><br><span class="line"></span><br><span class="line">    // 打包分析</span><br><span class="line">    if (process.env.IS_ANALYZ) &#123;</span><br><span class="line">      config.plugin(&quot;webpack-report&quot;).use(BundleAnalyzerPlugin, [</span><br><span class="line">        &#123;</span><br><span class="line">          analyzerMode: &quot;static&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      ]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 多页面配置，为js添加hash</span><br><span class="line">    // config.output.chunkFilename(`js/[name].[chunkhash:8].js`)</span><br><span class="line"></span><br><span class="line">    // 修改图片输出路径</span><br><span class="line">    // config.module</span><br><span class="line">    //   .rule(&apos;images&apos;)</span><br><span class="line">    //   .test(/\.(png|jpe?g|gif|ico)(\?.*)?$/)</span><br><span class="line">    //   .use(&apos;url-loader&apos;)</span><br><span class="line">    //   .loader(&apos;url-loader&apos;)</span><br><span class="line">    //   .options(&#123;</span><br><span class="line">    //       name: path.join(&apos;../assets/&apos;, &apos;img/[name].[ext]&apos;)</span><br><span class="line">    //   &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  css: &#123;</span><br><span class="line">    modules: false,</span><br><span class="line">    extract: IS_PROD,</span><br><span class="line">    // 为css后缀添加hash</span><br><span class="line">    // extract: &#123;</span><br><span class="line">    //  filename: &apos;css/[name].[hash:8].css&apos;,</span><br><span class="line">    //  chunkFilename: &apos;css/[name].[hash:8].css&apos;</span><br><span class="line">    //&#125;，</span><br><span class="line">    sourceMap: false,</span><br><span class="line">    loaderOptions: &#123;</span><br><span class="line">      sass: &#123;</span><br><span class="line">        // 向全局sass样式传入共享的全局变量</span><br><span class="line">        // data: `@import &quot;~assets/scss/variables.scss&quot;;$src: &quot;$&#123;process.env.VUE_APP_SRC&#125;&quot;;`</span><br><span class="line">        data: `$src: &quot;$&#123;process.env.VUE_APP_SRC&#125;&quot;;`</span><br><span class="line">      &#125;</span><br><span class="line">      // px转换为rem</span><br><span class="line">      // postcss: &#123;</span><br><span class="line">      //   plugins: [</span><br><span class="line">      //     require(&apos;postcss-pxtorem&apos;)(&#123;</span><br><span class="line">      //       rootValue : 1, // 换算的基数</span><br><span class="line">      //       selectorBlackList  : [&apos;weui&apos;, &apos;el&apos;], // 忽略转换正则匹配项</span><br><span class="line">      //       propList   : [&apos;*&apos;]</span><br><span class="line">      //     &#125;)</span><br><span class="line">      //   ]</span><br><span class="line">      // &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  pluginOptions: &#123;</span><br><span class="line">    // 安装vue-cli-plugin-style-resources-loader插件</span><br><span class="line">    // 添加全局样式global.scss</span><br><span class="line">    // &quot;style-resources-loader&quot;: &#123;</span><br><span class="line">    //   preProcessor: &quot;scss&quot;,</span><br><span class="line">    //   patterns: [</span><br><span class="line">    //     resolve(__dirname, &quot;./src/scss/scss/variables.scss&quot;)</span><br><span class="line">    //   ]</span><br><span class="line">    // &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  parallel: require(&quot;os&quot;).cpus().length &gt; 1,</span><br><span class="line">  pwa: &#123;&#125;,</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    // overlay: &#123;</span><br><span class="line">    //   warnings: true,</span><br><span class="line">    //   errors: true</span><br><span class="line">    // &#125;,</span><br><span class="line">    open: IS_PROD,</span><br><span class="line">    host: &quot;0.0.0.0&quot;,</span><br><span class="line">    port: 8000,</span><br><span class="line">    https: false,</span><br><span class="line">    hotOnly: false,</span><br><span class="line">    proxy: &#123;</span><br><span class="line">      &quot;/api&quot;: &#123;</span><br><span class="line">        target: process.env.VUE_APP_BASE_API || &quot;http://127.0.0.1:8080&quot;,</span><br><span class="line">        changeOrigin: true</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Vue/" rel="tag"># Vue</a>
          
            <a href="/tags/Vue-cli/" rel="tag"># Vue-cli</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/10/27/剖析node的Common-JS/" rel="next" title="剖析node的Common.JS">
                <i class="fa fa-chevron-left"></i> 剖析node的Common.JS
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/11/01/Koa2对MongoDB连接的单例模式的封装/" rel="prev" title="Koa2对MongoDB连接的单例模式的封装">
                Koa2对MongoDB连接的单例模式的封装 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/tx.jpg" alt="李斌">
            
              <p class="site-author-name" itemprop="name">李斌</p>
              <p class="site-description motion-element" itemprop="description">人生如逆旅     我亦是行人</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">201</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">121</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/libin1991" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://juejin.im/user/57e737f6c4c971005f6bcd8d" target="_blank" title="juejin">
                      
                        <i class="fa fa-fw fa-spinner"></i>juejin</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#要求："><span class="nav-number">1.</span> <span class="nav-text">要求：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#准备"><span class="nav-number">2.</span> <span class="nav-text">准备</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#拦截器"><span class="nav-number">3.</span> <span class="nav-text">拦截器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#vue-cli3-全面配置-持续更新"><span class="nav-number">4.</span> <span class="nav-text">vue-cli3 全面配置(持续更新)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#☞-配置多环境变量"><span class="nav-number">5.</span> <span class="nav-text">☞ 配置多环境变量</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#env-serve-默认的环境变量"><span class="nav-number">5.0.1.</span> <span class="nav-text">.env serve 默认的环境变量</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#env-production-build-默认的环境变量"><span class="nav-number">5.0.2.</span> <span class="nav-text">.env.production build 默认的环境变量</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#env-analyz-用于-webpack-bundle-analyzer-打包分析"><span class="nav-number">5.0.3.</span> <span class="nav-text">.env.analyz 用于 webpack-bundle-analyzer 打包分析</span></a></li></ol></li></ol><li class="nav-item nav-level-3"><a class="nav-link" href="#☞-配置基础-vue-config-js"><span class="nav-number">6.</span> <span class="nav-text">☞ 配置基础 vue.config.js</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#☞-配置-proxy-跨域"><span class="nav-number">7.</span> <span class="nav-text">☞ 配置 proxy 跨域</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#☞-修复-HMR-热更新-失效"><span class="nav-number">8.</span> <span class="nav-text">☞ 修复 HMR(热更新)失效</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#☞-修复-Lazy-loading-routes-Error：-Cyclic-dependency-https-github-com-vuejs-vue-cli-issues-1669"><span class="nav-number">9.</span> <span class="nav-text">☞ 修复 Lazy loading routes Error： Cyclic dependency https://github.com/vuejs/vue-cli/issues/1669</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#☞-添加别名"><span class="nav-number">10.</span> <span class="nav-text">☞ 添加别名</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#☞-去除多余无效的-css"><span class="nav-number">11.</span> <span class="nav-text">☞ 去除多余无效的 css</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#☞-添加打包分析"><span class="nav-number">12.</span> <span class="nav-text">☞ 添加打包分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#☞-配置-externals"><span class="nav-number">13.</span> <span class="nav-text">☞ 配置 externals</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#☞-去掉-console-log"><span class="nav-number">14.</span> <span class="nav-text">☞ 去掉 console.log</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#方法一："><span class="nav-number">14.0.1.</span> <span class="nav-text">方法一：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#方法二：使用-babel-plugin-transform-remove-console-插件"><span class="nav-number">14.0.2.</span> <span class="nav-text">方法二：使用 babel-plugin-transform-remove-console 插件</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#☞-开启-gzip-压缩"><span class="nav-number">15.</span> <span class="nav-text">☞ 开启 gzip 压缩</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#☞-为-sass-提供全局样式，以及全局变量"><span class="nav-number">16.</span> <span class="nav-text">☞ 为 sass 提供全局样式，以及全局变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#☞-添加-IE-兼容"><span class="nav-number">17.</span> <span class="nav-text">☞ 添加 IE 兼容</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#☞-文件上传-ali-oss"><span class="nav-number">18.</span> <span class="nav-text">☞ 文件上传 ali oss</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#☞-完整配置"><span class="nav-number">19.</span> <span class="nav-text">☞ 完整配置</span></a></li></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">李斌</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

  
  <!--
  	描述：点击红心
  -->
  <script type="text/javascript" src="/js/src/clicklove.js"></script>
  <!--
  	描述：复制代码
  -->
  <script type="text/javascript" src="/js/src/clipboard.min.js"></script>
  <script type="text/javascript" src="/js/src/clipboard-use.js"></script>
</body>
</html>


