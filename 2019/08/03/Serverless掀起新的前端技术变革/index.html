<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Serverless,">










<meta name="description" content="原文转自Serverless 掀起新的前端技术变革  关于 Serverless 的讨论越来越多。看似与前端关系不大的 Serverless，其实早已和前端有了颇深渊源，并且将掀起新的前端技术变革。 从前端开发模式的演进、基于 Serverless 的前端开发案例以及 Serverless 开发最佳实践等方面，与大家探讨 Serverless 中的前端开发模式。  前端开发模式的演进首先回顾一下">
<meta name="keywords" content="Serverless">
<meta property="og:type" content="article">
<meta property="og:title" content="Serverless掀起新的前端技术变革">
<meta property="og:url" content="http://yoursite.com/2019/08/03/Serverless掀起新的前端技术变革/index.html">
<meta property="og:site_name" content="Zero Days">
<meta property="og:description" content="原文转自Serverless 掀起新的前端技术变革  关于 Serverless 的讨论越来越多。看似与前端关系不大的 Serverless，其实早已和前端有了颇深渊源，并且将掀起新的前端技术变革。 从前端开发模式的演进、基于 Serverless 的前端开发案例以及 Serverless 开发最佳实践等方面，与大家探讨 Serverless 中的前端开发模式。  前端开发模式的演进首先回顾一下">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://camo.githubusercontent.com/e9559e2a015d2c65165d1a98f4f7558c77652a2e/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323031392f706e672f3134383532342f313535373933353034343336332d33666461376666362d653139342d346135392d393664612d6233373563333738343633322e706e6723616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d353832266f726967696e4865696768743d353832266f726967696e57696474683d313433322673697a653d30267374617475733d646f6e652677696474683d31343332">
<meta property="og:image" content="https://camo.githubusercontent.com/3282b163ab75b7ce06cb83aa37df031fa04f43ab/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323031392f706e672f3134383532342f313535373933353034343336392d66343662663637642d316130342d343737352d613535392d3038633838643662363337662e706e6723616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d373038266f726967696e4865696768743d373038266f726967696e57696474683d313631362673697a653d30267374617475733d646f6e652677696474683d31363136">
<meta property="og:image" content="https://camo.githubusercontent.com/d565bdacd42cd610c19c34b2e003a01dc8c78a82/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323031392f706e672f3134383532342f313535373933353034343338312d63343234353066612d633663622d346437332d623935302d6533396532336234666534392e706e6723616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d373032266f726967696e4865696768743d373032266f726967696e57696474683d313531362673697a653d30267374617475733d646f6e652677696474683d31353136">
<meta property="og:image" content="https://camo.githubusercontent.com/3bb89ef2b167be14ecb5903b7c70a793e7eb6a69/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323031392f706e672f3134383532342f313535373933353034343338382d62666231396333312d343033652d343531382d386239362d6666326439386234373738352e706e6723616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d313530266f726967696e4865696768743d313530266f726967696e57696474683d313430322673697a653d30267374617475733d646f6e652677696474683d31343032">
<meta property="og:image" content="https://camo.githubusercontent.com/d2220ae289b80aaf07c13bf37950019e07b63dc5/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323031392f706e672f3134383532342f313535373933353034343339312d39356131616137352d373938302d346536372d396233342d3865646234356536363235662e706e6723616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d313734266f726967696e4865696768743d313734266f726967696e57696474683d313133362673697a653d30267374617475733d646f6e652677696474683d31313336">
<meta property="og:image" content="https://camo.githubusercontent.com/8be5e883ad95e1e4f957c46513b162639f1d1a99/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323031392f706e672f3134383532342f313535373933353034343339332d63623962336538662d303431332d343661362d623230632d6339613638616431396462652e706e6723616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d373434266f726967696e4865696768743d373434266f726967696e57696474683d313438322673697a653d30267374617475733d646f6e652677696474683d31343832">
<meta property="og:image" content="https://camo.githubusercontent.com/43541e246daf5c43c9c22f401d3bf285e2cfd45e/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323031392f706e672f3134383532342f313535373933353034343339342d62366636346635332d663865662d343634342d386134342d3939613865623439386334332e706e6723616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d373736266f726967696e4865696768743d373736266f726967696e57696474683d313337322673697a653d30267374617475733d646f6e652677696474683d31333732">
<meta property="og:image" content="https://camo.githubusercontent.com/2d88cd36e902a07c590a0d25ddcae8c3bcf3a965/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323031392f706e672f3134383532342f313535373933353034343339382d64323735613737332d396634342d343138632d396635642d3536613364346666636561312e706e6723616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d363638266f726967696e4865696768743d363638266f726967696e57696474683d313730362673697a653d30267374617475733d646f6e652677696474683d31373036">
<meta property="og:image" content="https://camo.githubusercontent.com/32ddbbdb630cb084cc01d4cf2a14ebacfcc08293/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323031392f706e672f3134383532342f313535373933353034343431362d36626637633134642d366233632d343030312d396163622d6538353565323237333834622e706e6723616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d363330266f726967696e4865696768743d363330266f726967696e57696474683d313231342673697a653d30267374617475733d646f6e652677696474683d31323134">
<meta property="og:image" content="https://camo.githubusercontent.com/71f8ba42b62063758864059f94e260493263f159/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323031392f706e672f3134383532342f313535373933353034343432382d35306661366639382d646361652d343037382d623136642d3661386330656134356238612e706e6723616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d363430266f726967696e4865696768743d363430266f726967696e57696474683d313438302673697a653d30267374617475733d646f6e652677696474683d31343830">
<meta property="og:image" content="https://camo.githubusercontent.com/9a769191699fc87b5798e5677b20d255b7850c14/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323031392f706e672f3134383532342f313535373933353034343432372d66383836316266612d306162392d343231342d626634622d3232306239343938643261372e706e6723616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d363834266f726967696e4865696768743d363834266f726967696e57696474683d313531362673697a653d30267374617475733d646f6e652677696474683d31353136">
<meta property="og:image" content="https://camo.githubusercontent.com/bd139378e1e706c2bcbc9ff1d9e97d4aa906a469/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323031392f706e672f3134383532342f313535373933353034343433302d36653530636665322d333938612d343765392d626335342d3135373031356464396538302e706e6723616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d363138266f726967696e4865696768743d363138266f726967696e57696474683d313032362673697a653d30267374617475733d646f6e652677696474683d31303236">
<meta property="og:image" content="https://camo.githubusercontent.com/d392074c205700b246df151284473ae7e8dbc609/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323031392f706e672f3134383532342f313535373933353034343432372d39636633383466642d613461372d346638382d393739352d3731383532323134303266642e706e6723616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d333336266f726967696e4865696768743d333336266f726967696e57696474683d313333302673697a653d30267374617475733d646f6e652677696474683d31333330">
<meta property="og:image" content="https://camo.githubusercontent.com/267b84d7a5b19a8fb9154fd4dcae9273ce6eb11e/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323031392f706e672f3134383532342f313535373933353034343433372d31653939363165352d663165322d343436312d383936392d3561306539373461353564662e706e6723616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d31303536266f726967696e4865696768743d31303536266f726967696e57696474683d313539302673697a653d30267374617475733d646f6e652677696474683d31353930">
<meta property="og:image" content="https://camo.githubusercontent.com/7848af49349be366429e50bc078bd2ef669fc688/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323031392f706e672f3134383532342f313535373933353034343433372d31643432323766382d313433622d343466632d623266342d3634626166383562363338632e706e6723616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d373636266f726967696e4865696768743d373636266f726967696e57696474683d313633302673697a653d30267374617475733d646f6e652677696474683d31363330">
<meta property="og:image" content="https://camo.githubusercontent.com/a3e20cfbc3ca4281543f5d4c935f43cf2df70d9a/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323031392f706e672f3134383532342f313535373933353034343432372d61313931326333652d613734372d343533612d386634392d6131643236326361333566652e706e6723616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d383137266f726967696e4865696768743d383137266f726967696e57696474683d3838372673697a653d30267374617475733d646f6e652677696474683d383837">
<meta property="og:image" content="https://camo.githubusercontent.com/c00029eaccb7cc2c0b915d504785ae1126f0b0ad/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323031392f706e672f3134383532342f313535373933353034343433362d36383735336137312d616134612d346132652d623631372d3635343735613638346332632e706e6723616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d383137266f726967696e4865696768743d383137266f726967696e57696474683d313031362673697a653d30267374617475733d646f6e652677696474683d31303136">
<meta property="og:updated_time" content="2019-08-17T07:59:11.173Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Serverless掀起新的前端技术变革">
<meta name="twitter:description" content="原文转自Serverless 掀起新的前端技术变革  关于 Serverless 的讨论越来越多。看似与前端关系不大的 Serverless，其实早已和前端有了颇深渊源，并且将掀起新的前端技术变革。 从前端开发模式的演进、基于 Serverless 的前端开发案例以及 Serverless 开发最佳实践等方面，与大家探讨 Serverless 中的前端开发模式。  前端开发模式的演进首先回顾一下">
<meta name="twitter:image" content="https://camo.githubusercontent.com/e9559e2a015d2c65165d1a98f4f7558c77652a2e/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323031392f706e672f3134383532342f313535373933353034343336332d33666461376666362d653139342d346135392d393664612d6233373563333738343633322e706e6723616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d353832266f726967696e4865696768743d353832266f726967696e57696474683d313433322673697a653d30267374617475733d646f6e652677696474683d31343332">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2019/08/03/Serverless掀起新的前端技术变革/">





  <title>Serverless掀起新的前端技术变革 | Zero Days</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband">
    	<div class="eevee"><div class="body"><div class="head"><div class="ears"><div class="ear"><div class="lobe"></div></div><div class="ear"><div class="lobe"></div></div></div><div class="face"><div class="eyes"><div class="eye"><div class="eyelid"></div></div><div class="eye"><div class="eyelid"></div></div></div><div class="nose"></div><div class="mouth"></div></div></div><div class="chest"><div class="fur"><div class="patch"></div></div><div class="fur"><div class="patch"></div></div><div class="fur"><div class="patch"></div></div></div><div class="legs"><div class="leg"><div class="inner-leg"></div></div><div class="leg"><div class="inner-leg"></div></div><div class="leg"><div class="inner-leg"></div></div><div class="leg"><div class="inner-leg"></div></div></div><div class="tail"><div class="tail"><div class="tail"><div class="tail"><div class="tail"><div class="tail -end"></div></div></div></div></div></div></div></div>
    </div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
    	<div id="sky">
				<div id="background" class="container">
			<!-- svg file -->
			<svg id="svgout" height="100%" width="100%" viewbox="0 0 550 400">
				<defs>
					<g id="bottomShadow">
						<path fill="#000000" stroke="none" d="
		M 270.5 225.95
		L 127.35 316.65 266.8 400 409.6 309.25 270.5 225.95 Z"/>
					</g>
					<g id="Layer52_0_FILL">
						<path class="topGrass" fill="#B9D668" stroke="none" d="
	M 397.85 229.3
	L 397.85 225.6 269.85 152 135.75 228.6 135.75 233.65 262.1 306.55 397.85 229.3 Z"/>
					</g>
					<g id="Layer51_0_FILL">
						<path class="leftSideGrass" fill="#6E9E4F" stroke="none" d="
	M 135.1 229.95
	L 135.1 256.85 262.1 328.4 262.1 301.85 135.1 229.95 Z"/>
					</g>
					<g id="Layer50_0_FILL">
						<path class="rightGrassTop" fill="#8CB154" stroke="none" d="
	M 397.85 225.95
	L 395.8 225.95 261.75 301.55 261.75 328.4 397.85 251.15 397.85 225.95 Z"/>
					</g>
					<g id="Layer48_0_FILL">
						<path class="crustLeftTop" fill="#955541" stroke="none" d="
	M 135.45 282.4
	L 135.75 298.15 262.1 372.1 261.75 355.65 135.45 282.4 Z"/>
					</g>
					<g id="Layer47_0_FILL">
						<path class="middleLeftCrust" fill="#C77E61" stroke="none" d="
	M 135.1 270.3
	L 135.1 283.05 275.9 364.35 271.85 348.9 135.1 270.3 Z"/>
					</g>
					<g id="Layer46_0_FILL">
						<path class="crustLeftTop" fill="#955541" stroke="none" d="
	M 135.1 255.15
	L 135.1 270.3 262.1 343.55 262.1 328.05 135.1 255.15 Z"/>
					</g>
					<g id="Layer45_0_FILL">
						<path class="topRightCrust" fill="#A47237" stroke="none" d="
	M 397.5 294.5
	L 397.5 277 261.75 355.3 261.75 372.75 397.5 294.5 Z"/>
					</g>
					<g id="Layer44_0_FILL">
						<path class="middleRightCrust" fill="#C89451" stroke="none" d="
	M 397.5 269.95
	L 397.15 266.6 262.1 343.2 262.1 355.95 397.5 279.7 397.5 269.95 Z"/>
					</g>
					<g id="Layer43_0_FILL">
						<path class="topRightCrust" fill="#A47237" stroke="none" d="
	M 397.5 266.6
	L 397.5 250.45 261.75 328.4 261.75 343.85 397.5 266.6 Z"/>
					</g>
					<g id="Layer41_0_FILL">
						<path class="greyRoad" fill="#B2B2B1" stroke="none" d="
	M 295.05 283.05
	Q 299.05 280.35 308.45 275.3 317.85 269.95 323.6 266.9
	L 268.8 233.65 338.05 191.35 309.15 174.55 177.75 254.5
	Q 191.55 262.2 198.25 266.25 204.65 269.95 209.7 271.95
	L 241.6 250.45 295.05 283.05 Z"/>
					</g>
					<g id="Layer40_0_FILL">
						<path fill="#FFFFFF" stroke="none" d="
	M 199.95 256.85
	Q 194.55 261.2 191.9 262.2
	L 194.9 263.9 200.95 259.2 199.95 256.85
	M 225.8 243.75
	L 224.8 241.75 211.05 250.8 212.05 252.8 225.8 243.75
	M 308.15 275.65
	L 296.7 266.6 295.35 268.6 306.8 277.7 308.15 275.65
	M 275.9 253.5
	L 274.55 255.5 285.95 264.55 287.3 262.55 275.9 253.5
	M 251.7 227.3
	L 250.7 225.25 236.9 234.35 237.9 236.35 251.7 227.3
	M 257.05 240.7
	L 254.05 240.7 268.8 249.8 269.5 247.75 257.05 240.7
	M 277.2 207.8
	L 263.45 216.85 264.45 218.9 278.25 209.8 277.2 207.8
	M 305.1 192.65
	L 304.1 190.65 290.3 199.75 291.35 201.75 305.1 192.65 Z"/>
					</g>
					<g id="Layer38_0_FILL">
						<path class="frontFascia" fill="#ECB27B" stroke="none" d="
	M 359.25 187.95
	L 346.4 174.95 333.85 202.9 359.25 187.95 Z"/>
					</g>
					<g id="Layer37_0_FILL">
						<path class="frontWall" fill="#EFA258" stroke="none" d="
	M 334 201.05
	L 334.35 232 359.2 217.55 359.25 187.95 334 201.05 Z"/>
					</g>
					<g id="Layer36_0_FILL">
						<path class="leftWall" fill="#C57F42" stroke="none" d="
	M 334.35 232.3
	L 334.35 205.1 305.1 191.35 305.1 216.85 334.35 232.3 Z"/>
					</g>
					<g id="Layer35_0_FILL">
						<path class="rightRoof" fill="#EF4427" stroke="none" d="
	M 329.7 167.9
	L 331.05 167.9 344.55 176.7 347.85 176.7 363 192.25 363.15 189.55 350.65 176.7 350.55 176.7 334.25 167.5 334.25 159.1 329.7 159.1 329.7 164.9 322.65 160.95 322.3 162.15 329.7 167 329.7 167.9 Z"/>
					</g>
					<g id="Layer34_0_FILL">
						<path class="leftRoof" fill="#F2563B" stroke="none" d="
	M 334.05 207.05
	L 350.65 176.7 322.1 160.45 302.1 192.05 334.05 207.05 Z"/>
					</g>
					<g id="Layer30_0_FILL">
						<path id="windowFour" class="windows" stroke="none" fill="#975A42" d="
	M 341.35 203.3
	Q 340.9 203.45 340.5 203.8 340.1 204.2 339.85 204.75 339.7 205 339.7 205.3 339.6 205.75 339.7 206.1 339.7 206.15 339.7 206.2 339.8 206.5 340 206.8 340.55 207.4 341.45 207.4 342.35 207.4 343 206.8 343.4 206.5 343.65 206.1 343.85 205.75 343.95 205.3 344.05 204.4 343.55 203.8 343.3 203.45 343 203.3 342.65 203.15 342.2 203.15 341.8 203.15 341.35 203.3
	M 355.85 198.45
	Q 355.8 198.2 355.6 198 355.1 197.4 354.2 197.4 353.35 197.4 352.6 198 351.85 198.65 351.7 199.55 351.7 199.7 351.7 199.85 351.6 200.5 352 201.05 352.55 201.65 353.45 201.65 354.3 201.65 355.05 201.05 355.45 200.7 355.7 200.25 355.8 200.05 355.9 199.85 355.95 199.7 355.95 199.55 356.05 198.95 355.85 198.45 Z"/>
						<path class="door" fill="#B65041" stroke="none" d="
	M 351.95 211.2
	L 351.8 211.2 346.05 215.1 346.05 225.2 351.95 221.6 351.95 211.2
	M 351.2 211.2
	L 351.35 211.2 351.35 211.1 351.2 211.2 Z"/>
					</g>
					<g>
						<path id="Layer30_0_FILL" fill="#000000" fill-opacity="1" stroke="none" d="
	M 183.7 215.3
	L 183.7 215.6
	Q 187.25 231.75 212.25 234.35
	L 183.7 215.3 Z"/>
					</g>
					<g id="Layer29_0_FILL">
						<path fill="#000000" fill-opacity="0.4" stroke="none" d="
	M 305.1 216.85
	L 305.15 217.2
	Q 309.45 233.2 334.35 232.3
	L 305.1 216.85 Z"/>
					</g>
					<g id="Layer27_0_FILL">
						<path class="vegetation" fill="#78A950" stroke="none" d="
	M 177.45 231.65
	Q 175.75 235.35 181.8 239.35 185.5 235.7 185.15 231.3 182.8 230.65 181.45 234 179.45 231.3 177.45 231.65
	M 236.9 266.6
	Q 235.2 270.3 241.25 274.3 244.95 270.6 244.65 266.25 242.3 265.6 240.95 268.95 238.9 266.25 236.9 266.6
	M 254.7 277
	Q 253.05 280.7 259.1 284.75 262.75 281.05 262.45 276.65 260.1 276 258.75 279.35 256.7 276.65 254.7 277
	M 315.5 245.75
	Q 313.5 243.05 311.5 243.4 309.8 247.1 315.85 251.15 319.55 247.45 319.2 243.05 316.85 242.4 315.5 245.75
	M 295.35 232.65
	Q 293.7 236.35 299.75 240.4 303.45 236.7 303.1 232.3 300.75 231.65 299.4 235 297.4 232.3 295.35 232.65
	M 277.2 171.85
	Q 275.55 175.55 281.6 179.55 285.3 175.85 284.95 171.5 282.6 170.85 281.25 174.2 279.25 171.5 277.2 171.85 Z"/>
					</g>
					<g id="Layer26_0_FILL">
						<path class="treeWood" fill="#AE663D" stroke="none" d="
	M 175.1 177.55
	L 172.05 177.55 172.05 191.1 159.3 172.85
	Q 154.6 171.5 172.05 195.7
	L 172.05 212.5 175.1 212.5 175.1 177.55
	M 252.7 151.35
	L 249 151.35 249 176.9 252.7 176.9 252.7 151.35 Z"/>
					</g>
					<g id="Layer25_0_FILL">
						<path class="vegetation" fill="#77A951" stroke="none" d="
	M 192.55 179.55
	Q 200.95 173.5 200.95 165.1 200.95 156.4 192.55 150 184.15 144.3 172.05 144.3 160.3 144.3 151.9 150 143.15 156.4 143.15 165.1 143.15 173.5 151.9 179.55 160.3 185.95 172.05 185.95 184.15 185.95 192.55 179.55
	M 236.25 106.65
	Q 230.2 116.05 230.2 129.15 230.2 142.25 236.25 151.35 242.3 160.75 250.7 160.75 258.75 160.75 264.8 151.35 270.85 142.25 270.85 129.15 270.85 116.05 264.8 106.65 258.75 97.6 250.7 97.6 242.3 97.6 236.25 106.65 Z"/>
					</g>
					<g id="Layer24_0_FILL">
						<path class="vegetation" fill="#77A951" stroke="none" d="
	M 158.3 221.9
	Q 160.65 221.9 161.95 220.2 163 219.55 163.3 218.55 164.65 218.9 166.35 218.9 170.05 218.9 172.4 216.2 175.1 213.85 175.1 210.15 175.1 206.45 172.4 203.75 170.05 201.4 166.35 201.4 162.65 201.4 159.95 203.75 157.6 206.45 157.6 210.15 157.6 210.8 157.6 211.15 155.95 211.5 154.6 212.5 152.9 214.15 152.9 216.55 152.9 218.9 154.6 220.2 156.25 221.9 158.3 221.9
	M 338.35 240.05
	Q 341.05 237.7 341.05 234 341.05 230.3 338.35 227.6 336 225.25 332.3 225.25 328.65 225.25 325.95 227.6 323.6 230.3 323.6 234 323.6 237.7 325.95 240.05 328.65 242.75 332.3 242.75 336 242.75 338.35 240.05 Z"/>
					</g>
					<g id="Layer22_0_FILL">
						<path class="rightRoof" fill="#D05041" stroke="none" d="
	M 220 173.85
	L 236.8 186.7 264.35 171.15 244.5 159.55 220 173.85 Z"/>
					</g>
					<g id="Layer21_0_FILL">
						<path class="leftWall" fill="#C57F42" stroke="none" d="
	M 212.25 191.35
	L 183.35 172.3 183.7 215.3 212.25 234.35 212.25 191.35 Z"/>
					</g>
					<g id="Layer20_0_FILL">
						<path class="rightRoof" fill="#EF4427" stroke="none" d="
	M 192.1 149.85
	L 236.45 174.8 243.1 171.4
	Q 220.05 150.55 196.3 139.95
	L 192.1 149.85 Z"/>
					</g>
					<g id="Layer19_0_FILL">
						<path class="frontFascia" fill="#EBB17B" stroke="none" d="
	M 226.85 160.95
	L 212 190.6 229.75 192.6 239.75 172.85 226.85 160.95 Z"/>
					</g>
					<g id="Layer18_0_FILL">
						<path class="frontWall" fill="#EFA258" stroke="none" d="
	M 240.15 172.65
	L 211.9 191.6 212.25 233.65 264.35 201.7 264.35 170.8 240.8 184.45 240.15 172.65 Z"/>
					</g>
					<g id="Layer17_0_FILL">
						<path class="rightRoof" fill="#EF4427" stroke="none" d="
	M 210.9 142.2
	L 205.9 142.2 205.9 152.65 210.9 152.65 210.9 142.2 Z"/>
					</g>
					<g>
						<path id="Layer16_0_FILL" class="leftRoof" fill="#F2563B" stroke="none" d="
	M 210.25 195.5
	L 227.4 160.95 195.45 141.35 177.65 175.85 210.25 195.5 Z"/>
					</g>
					<g>
						<path id="sun" fill="#E3BD0E" stroke="none" d="
	M 257.05 15.95
	Q 251.7 15.95 248 19.65 244.3 23.35 244.3 28.7 244.3 34.1 248 37.8 251.7 41.5 257.05 41.5 262.45 41.5 266.15 37.8 269.85 34.1 269.85 28.7 269.85 23.35 266.15 19.65 262.45 15.95 257.05 15.95 Z"/>
					</g>
					<g id="Layer8_0_FILL">
						<path fill="#975A42" stroke="none" d="
	M 238.45 189.65
	Q 238.295703125 189.362109375 238.05 189.1 237.35 188.3 236.2 188.3 235.05 188.3 234.15 189.1 233.3 189.9 233.2 191.05 233.1 192.2 233.8 193 234.55 193.8 235.7 193.8 236.85 193.8 237.7 193 238.1970703125 192.558203125 238.45 192 238.6552734375 191.56484375 238.7 191.05 238.7671875 190.276953125 238.45 189.65
	M 220.55 197.55
	Q 220 197.55 219.5 197.75 218.95 197.95 218.5 198.35 217.933203125 198.8833984375 217.7 199.55 217.5833984375 199.916796875 217.55 200.3 217.4923828125 200.96171875 217.7 201.5 217.852734375 201.9103515625 218.15 202.25 218.95 203.05 220.1 203.05 221.25 203.05 222.05 202.25 222.95 201.45 223.05 200.3 223.15 199.15 222.4 198.35 222.05 197.95 221.65 197.75 221.15 197.55 220.55 197.55 Z"/>
					</g>
					<g id="Layer7_0_FILL">
						<path class="door" fill="#B65041" stroke="none" d="
	M 233.55 206.75
	L 225.9 211.95 226.25 225.5 233.95 220.35 233.55 206.75 Z"/>
					</g>
					<g>
						<path id="windowOne" class="windows" fill="#975A42" stroke="none" d="
	M 188.65 198.4
	L 188.8 204.1 198.65 210.45 198.55 204.75 188.65 198.4
	M 208.45 216.8
	L 208.35 211.1 198.55 204.75 198.65 210.45 208.45 216.8
	M 188.8 204.1
	L 188.95 209.8 198.8 216.15 198.65 210.45 188.8 204.1
	M 208.6 222.5
	L 208.45 216.8 198.65 210.45 198.8 216.15 208.6 222.5 Z"/>
					</g>
					<g>
						<path id="windowThree" class="windows" fill="#975A42" stroke="none" d="
	M 311.7 214.1
	L 318.55 217.55 318.45 211.9 311.6 208.45 311.7 214.1
	M 325.4 221
	L 325.25 215.35 318.45 211.9 318.55 217.55 325.4 221
	M 318.4 206.2
	L 311.5 202.75 311.6 208.45 318.45 211.9 318.4 206.2
	M 325.25 215.35
	L 325.2 209.7 318.4 206.2 318.45 211.9 325.25 215.35 Z"/>
					</g>
					<g id="Layer2_0_FILL">
						<path class="door" fill="#B65041" stroke="none" d="
	M 259.7 183.25
	L 244.6 191.9 244.6 213.8 259.7 204.55 259.7 183.25 Z"/>
					</g>
					<path id="windowTwo" fill="#975A42" class="windows" stroke-width="1" stroke-linejoin="round" stroke-linecap="round" d="
	M 223.05 200.3
	Q 222.95 201.45 222.05 202.25 221.25 203.05 220.1 203.05 218.95 203.05 218.15 202.25 217.852734375 201.9103515625 217.7 201.5 217.4923828125 200.96171875 217.55 200.3 217.5833984375 199.916796875 217.7 199.575 217.933203125 198.8833984375 218.5 198.35 218.95 197.95 219.5 197.75 220 197.55 220.55 197.55 221.15 197.55 221.65 197.75 222.05 197.95 222.4 198.35 223.15 199.15 223.05 200.3 Z
	M 238.7 191.05
	Q 238.6552734375 191.56484375 238.45 192 238.1970703125 192.558203125 237.7 193 236.85 193.8 235.7 193.8 234.55 193.8 233.8 193 233.1 192.2 233.2 191.05 233.3 189.9 234.15 189.1 235.05 188.3 236.2 188.3 237.35 188.3 238.05 189.1 238.295703125 189.362109375 238.45 189.65 238.7671875 190.276953125 238.7 191.05 Z"/>
					<path fill="#F2563B" stroke="none" d=" M 351.95 211.2 L 351.8 211.2 346.05 215.1 346.05 225.2 351.95 221.6 351.95 211.2 Z"/>
					<path id="Layer6_0_1_STROKES" class="windowRims" stroke="#AE663D" stroke-width="1" stroke-linejoin="round" stroke-linecap="round" fill="none" d="
	M 198.55 204.75
	L 208.35 211.1 208.45 216.8 208.6 222.5 198.8 216.15 188.95 209.8 188.8 204.1 188.65 198.4 198.55 204.75 198.65 210.45 208.45 216.8
	M 198.8 216.15
	L 198.65 210.45 188.8 204.1"/>
					<path id="Layer5_0_1_STROKES" class="windowRims" stroke="#AE663D" stroke-width="1" stroke-linejoin="round" stroke-linecap="round" fill="none" d="
	M 325.25 215.35
	L 325.4 221 318.55 217.55 311.7 214.1 311.6 208.45 311.5 202.75 318.4 206.2 325.2 209.7 325.25 215.35 318.45 211.9 318.55 217.55
	M 318.4 206.2
	L 318.45 211.9 311.6 208.45"/>
				</defs>
				<g id="shadow">
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use xlink:href="#bottomShadow"/>
					</g>
				</g>
				<g transform="matrix( 1, 0, 0, 1, 0,0) ">
					<use xlink:href="#sun"/>
				</g>
				<g id="earth">
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer52_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer51_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer50_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer48_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer47_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer46_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer45_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer44_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer43_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer41_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer40_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer38_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer37_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer36_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer35_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer34_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#windowFour"/>
						<use class="element" xlink:href="#Layer32_0_1_STROKES"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer30_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer27_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer26_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer25_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer24_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer22_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer21_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer20_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer19_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer18_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer17_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer16_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer8_0_FILL"/>
						<use class="element" xlink:href="#windowTwo"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer7_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#windowOne"/>
						<use class="element" xlink:href="#Layer6_0_1_STROKES"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#windowThree"/>
						<use class="element" xlink:href="#Layer5_0_1_STROKES"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer2_0_FILL"/>
					</g>
				</g>
			</svg>
			<! -- End of SVG file -->
			<! -- Moon/Sun Toggle -->
			<div id="toggleButton" class="day-toggle">
				<div class="sun-icon"></div>
				<label class="switch">
            <input id="toggleCheckbox" type="checkbox">
            <div class="slider"></div>
        </label>
				<div class="cloud-icon"></div>
			</div>
			<! -- Moon/Sun Toggle -->
			<! -- End of Container -->
		</div>
			</div>
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Zero Days</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">人生如逆旅    我亦是行人</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/03/Serverless掀起新的前端技术变革/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="李斌">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zero Days">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Serverless掀起新的前端技术变革</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-03T22:05:44+08:00">
                2019-08-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <blockquote>
<p><strong>原文转自<a href="https://github.com/nodejh/nodejh.github.io/issues/49" target="_blank" rel="noopener">Serverless 掀起新的前端技术变革</a></strong></p>
</blockquote>
<p>关于 Serverless 的讨论越来越多。看似与前端关系不大的 Serverless，其实早已和前端有了颇深渊源，并且将掀起新的前端技术变革。 从前端开发模式的演进、基于 Serverless 的前端开发案例以及 Serverless 开发最佳实践等方面，与大家探讨 Serverless 中的前端开发模式。 </p>
<h2 id="前端开发模式的演进"><a href="#前端开发模式的演进" class="headerlink" title="前端开发模式的演进"></a>前端开发模式的演进</h2><p>首先回顾一下前端开发模式的演进，我觉得主要有四个阶段。</p>
<ol>
<li>基于模板渲染的动态页面</li>
<li>基于 AJAX 的前后端分离</li>
<li>基于 Node.js 的前端工程化</li>
<li>基于 Node.js 的全栈开发</li>
</ol>
<h3 id="基于模板渲染的动态页面"><a href="#基于模板渲染的动态页面" class="headerlink" title="基于模板渲染的动态页面"></a>基于模板渲染的动态页面</h3><p>在早起的互联网时代，我们的网页很简单，就是一些静态或动态的页面，主要目的是用来做信息的展示和传播。这个时候开发一个网页也很容易，主要就是通过 JSP、PHP 等技术写一些动态模板，然后通过 Web Server 将模板解析成一个个 HTML 文件，浏览器只负责渲染这些 HTML 文件。这个阶段还没有前后端的分工，通常是后端工程师顺便写了前端页面。</p>
<h3 id="基于-AJAX-的前后端分离"><a href="#基于-AJAX-的前后端分离" class="headerlink" title="基于 AJAX 的前后端分离"></a>基于 AJAX 的前后端分离</h3><p>2005 年 AJAX 技术的正式提出，翻开了 Web 开发的新篇章。基于 AJAX，我们可以把 Web 分为前端和后端，前端负责界面和交互，后端负责业务逻辑的处理。前后端通过接口进行数据交互。我们也不再需要在各个后端语言里面写着难以维护的 HTML。网页的复杂度也由后端的 Web Server 转向了浏览器端的 JavaScript。也正因如此，开始有了前端工程师这个职位。</p>
<h3 id="基于-Node-js-的前端工程化"><a href="#基于-Node-js-的前端工程化" class="headerlink" title="基于 Node.js 的前端工程化"></a>基于 Node.js 的前端工程化</h3><p>2009年 Node.js 的出现，对于前端工程师来说，也是一个历史性的时刻。随着 Node.js 一同出现的还有 CommonJS 规范和 npm 包管理机制。随后也出现了 Grunt、Gulp、Webpack 等一系列基于 Node.js 的前端开发构建工具。</p>
<p>在 2013 年前后，前端三大框架 React.js/Angular/Vue.js 相继发布第一个版本。我们可以从以往基于一个个页面的开发，变为基于一个个组件进行开发。开发完成后使用 webpack 等工具进行打包构建，并通过基于 Node.js 实现的命令行工具将构建结果发布上线。前端开发开始变得规范化、标准化、工程化。</p>
<h3 id="基于-Node-js-的全栈开发"><a href="#基于-Node-js-的全栈开发" class="headerlink" title="基于 Node.js 的全栈开发"></a>基于 Node.js 的全栈开发</h3><p>Node.js 对前端的重要意义还有，以往只能运行在浏览器中的 JavaScript 也可以运行在服务器上，前端工程师可以用自己最熟悉的语言来写服务端的代码。于是前端工程师开始使用 Node.js 做全栈开发，开始由前端工程师向全栈工程师的方向转变。这是前端主动突破自己的边界。</p>
<p>另一方面，前端在发展，后端也在发展。也差不多在 Node.js 诞生那个时代，后端普遍开始由巨石应用模式由微服务架构转变。这也就导致以往的前后端分工出现了分歧。随着微服务架构的兴起，后端的接口渐渐变得原子性，微服务的接口也不再直接面向页面，前端的调用变得复杂了。于是 BFF（Backend For Frontend）架构应运而生，在微服务和前端中间，加了一个 BFF 层，由 BFF 对接口进行聚合、裁剪后，再输出给前端。而 BFF 这层不是后端本质工作，且距离前端最近和前端关系最大，所以前端工程师自然而然选择了 Node.js 来实现。这也是当前 Node.js 在服务端较为广泛的应用。</p>
<h3 id="下一代前端开发模式"><a href="#下一代前端开发模式" class="headerlink" title="下一代前端开发模式"></a>下一代前端开发模式</h3><p>可以看到，每一次前端开发模式的变化，都因某个变革性的技术而起。先是 AJAX，而后是 Node.js。那么下一个变革性的技术是什么？不言而喻，就是 Serverless。</p>
<h2 id="Serverless-服务中的前端解决方案"><a href="#Serverless-服务中的前端解决方案" class="headerlink" title="Serverless 服务中的前端解决方案"></a>Serverless 服务中的前端解决方案</h2><h3 id="什么是-Serverless"><a href="#什么是-Serverless" class="headerlink" title="什么是 Serverless"></a>什么是 Serverless</h3><p>Serverless架构，或者称为无服务器架构，是最近几年新冒出来的一种架构风格。这究竟是一种什么样的架构？无服务器，就是真的没有服务器了么？其实，对于Serverless来说，只是用户不用更多的去考虑服务器的相关内容了，无需再去考虑服务器的规格大小、存储类型、网络带宽、自动扩缩容问题了；同时，也无需再对服务器进行运维了，无需不断的打系统补丁、应用补丁、无需进行数据备份、软件配置等工作了。</p>
<p>但是没有服务器，如何来将程序、应用运行起来呢？这里要介绍的是Serverless下包含的两个概念：<font color="#dd0000"><strong> 函数即服务，Function as a Service FaaS，后端即服务，Backend as a Service BaaS </strong> </font> 。</p>
<h3 id="函数即服务-FaaS"><a href="#函数即服务-FaaS" class="headerlink" title="函数即服务 FaaS"></a>函数即服务 FaaS</h3><p>函数即服务 FaaS，作为一种新的计算能力提供方式，让用户抛弃了对服务器的配置和管理，仅需编写和上传核心业务代码，交由平台完成部署、调度、流量分发、弹性伸缩等能力。FaaS的出现，会从底层开始变革计算资源的形态，提供了一种新的方式来提供计算资源，同时也会给软件架构与应用服务部署带来新的设计思路，进一步降低云计算的使用门槛，推动全行业在服务架构上的创新步伐。</p>
<h3 id="后端即服务-BaaS"><a href="#后端即服务-BaaS" class="headerlink" title="后端即服务 BaaS"></a>后端即服务 BaaS</h3><p>后端即服务 BaaS，其实大家已经使用很久了，这里的后端，指的就是各种云产品和云服务，例如对象存储COS，消息队列CMQ，云数据库CDB、TDSQL，云缓存CRedis、CMemcached，甚至到各种以 API 形式提供的服务如万象优图 CI，视频处理 VC。这些产品或服务，用户直接开通即可使用，无需考虑部署、扩容、备份、优化、安全等各种运维工作，做到了开箱即用，无需自己去进行服务器或应用的维护和管理，因此同样也是Serverless的一部分。 </p>
<h3 id="Serverless-简介"><a href="#Serverless-简介" class="headerlink" title="Serverless 简介"></a>Serverless 简介</h3><p>根据 CNCF 的定义，Serverless 是指构建和运行不需要服务器管理的应用程序的概念。(<a href="https://github.com/cncf/wg-serverless/tree/master/whitepapers/serverless-overview" target="_blank" rel="noopener">serverless-overview</a>)</p>
<p>Serverless computing refers to the concept of building and running applications that do not require server management.<br>— CNCF</p>
<p>其实 Serverless 早已和前端产生了联系，只是我们可能没有感知。比如 CDN，我们把静态资源发布到 CDN 之后，就不需要关心 CDN 有多少个节点、节点如何分布，也不需要关心它如何做负载均衡、如何实现网络加速，所以 CDN 对前端来说是 Serverless。再比如对象存储，和 CDN 一样，我们只需要将文件上传到对象存储，就可以直接使用了，不需要关心它如何存取文件、如何进行权限控制，所以对象存储对前端工程师来说是 Serverless。甚至一些第三方的 API 服务，也是 Serverless，因为我们使用的时候，不需要去关心服务器。</p>
<p>当然，有了体感还不够，我们还是需要一个更精确的定义。从技术角度来说，Serverless 就是 FaaS 和 BaaS 的结合。</p>
<p><center> <font color="#dd0000"> <strong>Serverless = FaaS + BaaS。</strong> </font></center><br> </p>
<p><img src="https://camo.githubusercontent.com/e9559e2a015d2c65165d1a98f4f7558c77652a2e/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323031392f706e672f3134383532342f313535373933353034343336332d33666461376666362d653139342d346135392d393664612d6233373563333738343633322e706e6723616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d353832266f726967696e4865696768743d353832266f726967696e57696474683d313433322673697a653d30267374617475733d646f6e652677696474683d31343332" alt></p>
<p>简单来讲，FaaS（Function as a Service） 就是一些运行函数的平台，比如阿里云的函数计算、AWS 的 Lambda 等。</p>
<p>BaaS（Backend as a Service）则是一些后端云服务，比如云数据库、对象存储、消息队列等。利用 BaaS，可以极大简化我们的应用开发难度。</p>
<p>Serverless 则可以理解为运行在 FaaS 中的，使用了 BaaS 的函数。</p>
<p>Serverless 的主要特点有：</p>
<ul>
<li><p>事件驱动</p>
<ul>
<li>函数在 FaaS 平台中，需要通过一系列的事件来驱动函数执行。</li>
</ul>
</li>
<li><p>无状态</p>
<ul>
<li>因为每次函数执行，可能使用的都是不同的容器，无法进行内存或数据共享。如果要共享数据，则只能通过第三方服务，比如 Redis 等。</li>
</ul>
</li>
<li><p>无运维</p>
<ul>
<li>使用 Serverless 我们不需要关心服务器，不需要关心运维。这也是 Serverless 思想的核心。</li>
</ul>
</li>
<li><p>低成本</p>
<ul>
<li>使用 Serverless 成本很低，因为我们只需要为每次函数的运行付费。函数不运行，则不花钱，也不会浪费服务器资源</li>
</ul>
</li>
</ul>
<h3 id="Serverless-服务中的前端解决方案架构图"><a href="#Serverless-服务中的前端解决方案架构图" class="headerlink" title="Serverless 服务中的前端解决方案架构图"></a>Serverless 服务中的前端解决方案架构图</h3><p><img src="https://camo.githubusercontent.com/3282b163ab75b7ce06cb83aa37df031fa04f43ab/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323031392f706e672f3134383532342f313535373933353034343336392d66343662663637642d316130342d343737352d613535392d3038633838643662363337662e706e6723616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d373038266f726967696e4865696768743d373038266f726967696e57696474683d313631362673697a653d30267374617475733d646f6e652677696474683d31363136" alt></p>
<p>上图是当前主要的一些 Serverless 服务，以及对应的前端解决方案。</p>
<p>从下往上，分别是基础设施和开发工具。</p>
<p>基础设施主要是一些云计算厂商提供，包括云计算平台和各种 BaaS 服务，以及运行函数的 FaaS 平台。</p>
<p>前端主要是 Serverless 的使用者，所以对前端来说，最重要的开发工具这一层，我们需要依赖开发工具进行 Serverless 开发、调试和部署。</p>
<h4 id="框架（Framework）"><a href="#框架（Framework）" class="headerlink" title="框架（Framework）"></a>框架（Framework）</h4><p>如今还没有一个统一的 Serverless 标准，不同云计算平台提供的 Serverless 服务很可能是不一样的，这就导致我们的代码，无法平滑迁移。Serverless 框架一个主要功能是简化 Serverless 开发、部署流程，另一主要功能则是屏蔽不同 Serverless 服务中的差异，让我们的函数能够在不改动或者只改动很小一部分的情况下，在其他 Serverless 服务中也能运行。</p>
<p>常见的 Serverless 框架有 <a href="https://serverless.com/" target="_blank" rel="noopener">Serverless Framework</a>、<a href="https://zeit.co/docs" target="_blank" rel="noopener">ZEIT Now</a>、<a href="https://apex.run/" target="_blank" rel="noopener">Apex</a> 等。不过这些基本都是国外公司做的，国内还没有这样的平台。</p>
<h4 id="Web-IDE"><a href="#Web-IDE" class="headerlink" title="Web IDE"></a>Web IDE</h4><p>和 Serverless 紧密相关的 Web IDE 主要也是各个云计算平台的 Web IDE。利用 Web IDE，我们可以很方便地在云端开发、调试函数，并且可以直接部署到对应的 FaaS 平台。这样的好处是避免了在本地安装各种开发工具、配置各种环境。常见的 Web IDE 有 AWS 的 Cloud9、阿里云的函数计算 Web IDE、腾讯云的 Cloud Studio。从体验上来说，AWS Cloud9 最好。</p>
<h4 id="命令行工具"><a href="#命令行工具" class="headerlink" title="命令行工具"></a>命令行工具</h4><p>当然，目前最主要的开发方式还是在本地进行开发。所以在本地开发 Serverless 的命令行工具也必不可少。</p>
<p>命令行工具主要有两类，一类是云计算平台提供的，如 AWS 的 <code>aws</code>、 Azure 的 <code>az</code>、阿里云的 <code>fun</code>；还有一类是 Serverless 框架提供的，如 <code>serverless</code>、<code>now</code>。</p>
<p>大部分工具如 <code>serverless</code>、<code>fun</code> 等，都是用 Node.js 实现的。</p>
<p>下面是几个命令行工具的例子。</p>
<h5 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> serverless</span><br><span class="line"><span class="meta">$</span> serverless create --template aws-nodejs --path myService</span><br><span class="line"><span class="meta">#</span> fun</span><br><span class="line"><span class="meta">$</span> fun init -n qcondemo helloworld-nodejs8</span><br></pre></td></tr></table></figure>
<h5 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> serverless</span><br><span class="line"><span class="meta">$</span> serverless deploy</span><br><span class="line"><span class="meta">#</span> fun</span><br><span class="line"><span class="meta">$</span> fun deploy</span><br></pre></td></tr></table></figure>
<h5 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> serverless</span><br><span class="line"><span class="meta">$</span> serverless invoke [local] --function functionName</span><br><span class="line"><span class="meta">#</span> fun</span><br><span class="line"><span class="meta">$</span> fun local invoke functionName</span><br></pre></td></tr></table></figure>
<h4 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h4><p>在开发工具上面一层，则是 Serverless 的一些垂直应用场景。除了使用传统的服务端开发，目前使用 Serverless 技术的还有小程序开发，未来可能还会设计物联网领域（IoT）。</p>
<h3 id="不同-Serverless-服务的对比"><a href="#不同-Serverless-服务的对比" class="headerlink" title="不同 Serverless 服务的对比"></a>不同 Serverless 服务的对比</h3><p><img src="https://camo.githubusercontent.com/d565bdacd42cd610c19c34b2e003a01dc8c78a82/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323031392f706e672f3134383532342f313535373933353034343338312d63343234353066612d633663622d346437332d623935302d6533396532336234666534392e706e6723616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d373032266f726967696e4865696768743d373032266f726967696e57696474683d313531362673697a653d30267374617475733d646f6e652677696474683d31353136" alt></p>
<p>上图从支持语言、触发器、价格等多个方面对不同 Serverless 服务进行了对比，可以发现有差异，也有共性。</p>
<p>比如几乎所有 Serverless 服务都支持 Node.js/Python/Java 等语言。</p>
<p>从支持的触发器来看，几乎所有服务也都支持 HTTP、对象存储、定时任务、消息队列等触发器。当然，这些触发器也与平台自己的后端服务相关，比如阿里云的对象存储触发器，是基于阿里云的 OSS 产品的存取等事件触发的；而 AWS 的对象存储触发器，则是基于 AWS 的 S3 的事件触发的，两个平台并不通用。这也是当前 Serverless 面临的一个问题，就是标准不统一。</p>
<p>从计费的角度来看，各个平台的费用基本一致。在前面也提到，Serverless 的计费是按调用次数计费。对于各个 Serverless，每个月都有 100 万次的免费调用次数，之后差不多 ¥1.3/百万次；以及 400,000 GB-s 的免费执行时间，之后 ¥0.0001108/GB-s。所以在应用体量较小的时候，使用 Serverless 是非常划算的。</p>
<h2 id="基于-Serverless-的前端开发模式"><a href="#基于-Serverless-的前端开发模式" class="headerlink" title="基于 Serverless 的前端开发模式"></a>基于 Serverless 的前端开发模式</h2><p>在本章节，主要以几个案例来说明基于 Serverless 的前端开发模式，以及它和以往的前端开发有什么不一样。</p>
<p>在开始具体的案例之前，先看一下传统开发流程。</p>
<p><img src="https://camo.githubusercontent.com/3bb89ef2b167be14ecb5903b7c70a793e7eb6a69/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323031392f706e672f3134383532342f313535373933353034343338382d62666231396333312d343033652d343531382d386239362d6666326439386234373738352e706e6723616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d313530266f726967696e4865696768743d313530266f726967696e57696474683d313430322673697a653d30267374617475733d646f6e652677696474683d31343032" alt></p>
<p>在传统开发流程中，我们需要前端工程师写页面，后端工程师写接口。后端写完接口之后，把接口部署了，再进行前后端联调。联调完毕后再测试、上线。上线之后，还需要运维工程师对系统进行维护。整个过程涉及多个不同角色，链路较长，沟通协调也是一个问题。</p>
<p>而基于 Serverless，后端变得非常简单了，以往的后端应用被拆分为一个个函数，只需要写完函数并部署到 Serverless 服务即可，后续也不用关心任何服务器的运维操作。后端开发的门槛大幅度降低了。因此，只需要一个前端工程师就可以完成所有的开发工作。</p>
<p><img src="https://camo.githubusercontent.com/d2220ae289b80aaf07c13bf37950019e07b63dc5/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323031392f706e672f3134383532342f313535373933353034343339312d39356131616137352d373938302d346536372d396233342d3865646234356536363235662e706e6723616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d313734266f726967696e4865696768743d313734266f726967696e57696474683d313133362673697a653d30267374617475733d646f6e652677696474683d31313336" alt></p>
<p>当然，前端工程师基于 Serverless 去写后端，最好也需要具备一定的后端知识。涉及复杂的后端系统或者 Serverless 不适用的场景，还是需要后端开发，后端变得更靠后了。</p>
<h3 id="基于-Serverless-的-BFF"><a href="#基于-Serverless-的-BFF" class="headerlink" title="基于 Serverless 的 BFF"></a>基于 Serverless 的 BFF</h3><p>一方面，对不同的设备需要使用不同的 API，另一方面，由于微服务导致前端接口调用的复杂，所以前端工程师开始使用 BFF 的方式，对接口进行聚合裁剪，以得到适用于前端的接口。</p>
<p>下面是一个通用的 BFF 架构。</p>
<p><img src="https://camo.githubusercontent.com/8be5e883ad95e1e4f957c46513b162639f1d1a99/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323031392f706e672f3134383532342f313535373933353034343339332d63623962336538662d303431332d343661362d623230632d6339613638616431396462652e706e6723616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d373434266f726967696e4865696768743d373434266f726967696e57696474683d313438322673697a653d30267374617475733d646f6e652677696474683d31343832" alt><br><a href="https://www.thoughtworks.com/insights/blog/bff-soundcloud" target="_blank" rel="noopener">BFF @ SoundCloud</a></p>
<p>最底层的就是各种后端微服务，最上层就是各种前端应用。在微服务和应用之前，就是通常由前端工程师开发的 BFF。</p>
<p>这样的架构解决了接口协调的问题，但也带来了一些新的问题。</p>
<p>比如针对每个设备开发一个 BFF 应用，也会面临一些重复开发的问题。而且以往前端只需要开发页面，关注于浏览器端的渲染即可，现在却需要维护各种 BFF 应用。以往前端也不需要关心并发，现在并发压力却集中到了 BFF 上。总的来说运维成本非常高，通常前端并不擅长运维。</p>
<p>Serverless 则可以帮我们很好的解决这些问题。基于 Serverless，我们可以使用一个个函数来实各个接口的聚合裁剪。前端向 BFF 发起的请求，就相当于是 FaaS 的一个 HTTP 触发器，触发一个函数的执行，这个函数中来实现针对该请求的业务逻辑，比如调用多个微服务获取数据，然后再将处理结果返回给前端。这样运维的压力，就由以往的 BFF Server 转向了 FaaS 服务，前端再也不用关心服务器了。</p>
<p><img src="https://camo.githubusercontent.com/43541e246daf5c43c9c22f401d3bf285e2cfd45e/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323031392f706e672f3134383532342f313535373933353034343339342d62366636346635332d663865662d343634342d386134342d3939613865623439386334332e706e6723616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d373736266f726967696e4865696768743d373736266f726967696e57696474683d313337322673697a653d30267374617475733d646f6e652677696474683d31333732" alt></p>
<p>上图则是基于 Serverless 的 BFF 架构。为了更好的管理各种 API，我们还可以添加网关层，通过网关来管理所有 API（比如阿里云的网关），比如对 API 进行分组、分环境。基于 API 网关，前端就不直接通过 HTTP 触发器来执行函数，而是将请求发送至网关，再由网关去触发具体的函数来执行。</p>
<h3 id="基于-Serverless-的服务端渲染"><a href="#基于-Serverless-的服务端渲染" class="headerlink" title="基于 Serverless 的服务端渲染"></a>基于 Serverless 的服务端渲染</h3><p>基于当下最流行的三大前端框架（React.js/Anguler/Vue.js），现在的渲染方式大部分都是客户端渲染。页面初始化的时候，只加载一个简单 HTML 以及对应的 JS 文件，再由 JS 来渲染出一个个页面。这种方式最主要的问题就是白屏时间和 SEO。</p>
<p>为了解决这个问题，前端又开始尝试服务端渲染。本质思想其实和最早的模板渲染是一样的。都是前端发起一个请求，后端 Server 解析出一个 HTML 文档，然后再返回给浏览器。只不过以往是 JSP、PHP 等服务端语言的模板，现在是基于 React、Vue 等实现的同构应用，这也是如今的服务端渲染方案的优势。</p>
<p>但服务端渲染又为前端带来了一些额外的问题：运维成本，前端需要维护用于渲染的服务器。</p>
<p>Serverless 最大的优点就是可以帮我们减少运维，那 Serverless 能不能用于服务端渲染呢？当然也是可以的。</p>
<p>传统的服务端渲染，每个请求的 path 都对应着服务端的每个路由，由该路由实现对应 path 的 HTML 文档渲染。用于渲染的服务端程序，就是这些集成了这些路由的应用。</p>
<p>使用 Serverless 来做服务端渲染，就是将以往的每个路由，都拆分为一个个函数，再在 FaaS 上部署对应的函数。这样用户请求的 path，对应的就是每个单独的函数。通过这种方式，就将运维操作转移到了 FaaS 平台，前端做服务端渲染，就不用再关心服务端程序的运维部署了。</p>
<p><img src="https://camo.githubusercontent.com/2d88cd36e902a07c590a0d25ddcae8c3bcf3a965/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323031392f706e672f3134383532342f313535373933353034343339382d64323735613737332d396634342d343138632d396635642d3536613364346666636561312e706e6723616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d363638266f726967696e4865696768743d363638266f726967696e57696474683d313730362673697a653d30267374617475733d646f6e652677696474683d31373036" alt></p>
<p><a href="https://zeit.co" target="_blank" rel="noopener">ZEIT</a> 的 <a href="https://nextjs.org/docs/#serverless-deployment" target="_blank" rel="noopener">Next.js</a> 就对基于 Serverless 的服务端渲染做了很好的实现。下面就是一个简单的例子。</p>
<p>代码结构如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── next.config.js</span><br><span class="line">├── now.json</span><br><span class="line">├── package.json</span><br><span class="line">└── pages</span><br><span class="line">    ├── about.js</span><br><span class="line">    └── index.js</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// next.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  target: <span class="string">'serverless'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中 <code>pages/about.js</code> 和 <code>pages/index.js</code> 就是两个页面，在 <code>next.config.js</code> 配置了使用 Zeit 提供的 Serverless 服务。</p>
<p>然后使用 <code>now</code> 这个命令，就可以将代码以 Serverless 的方式部署。部署过程中，<code>pages/about.js</code> 和 <code>pages/index.js</code> 就分别转换为两个函数，负责渲染对应的页面。</p>
<p><img src="https://camo.githubusercontent.com/32ddbbdb630cb084cc01d4cf2a14ebacfcc08293/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323031392f706e672f3134383532342f313535373933353034343431362d36626637633134642d366233632d343030312d396163622d6538353565323237333834622e706e6723616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d363330266f726967696e4865696768743d363330266f726967696e57696474683d313231342673697a653d30267374617475733d646f6e652677696474683d31323134" alt></p>
<h3 id="基于-Serverless-的小程序开发"><a href="#基于-Serverless-的小程序开发" class="headerlink" title="基于 Serverless 的小程序开发"></a>基于 Serverless 的小程序开发</h3><p>目前国内使用 Serverless 较多的场景可能就是小程开发了。具体的实现就是小程序云开发，支付宝小程序和微信小程序都提供了云开发功能。</p>
<p>在传统的小程序开发中，我们需要前端工程师进行小程序端的开发；后端工程师进行服务端的开发。小程序的后端开发和其他的后端应用开发，本质是是一样的，需要关心应用的负载均衡、备份冗灾、监控报警等一些列部署运维操作。如果开发团队人很少，可能还需要前端工程师去实现服务端。</p>
<p>但基于云开发，就只需要让开发者关注于业务的实现，由一个前端工程师就能够完成整个应用的前后端开发。因为云开发将后端封装为了 BaaS 服务，并提供了对应的 SDK 给开发者，开发者可以像调用函数一样使用各种后端服务。应用的运维也转移到了提供云开发的服务商。</p>
<p><img src="https://camo.githubusercontent.com/71f8ba42b62063758864059f94e260493263f159/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323031392f706e672f3134383532342f313535373933353034343432382d35306661366639382d646361652d343037382d623136642d3661386330656134356238612e706e6723616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d363430266f726967696e4865696768743d363430266f726967696e57696474683d313438302673697a653d30267374617475733d646f6e652677696474683d31343830" alt></p>
<p>下面分别是使用<a href="https://docs.alipay.com/mini/developer/todo-basement" target="_blank" rel="noopener">支付宝云开发（Basement）</a>的一些例子，函数就是定义在 FaaS 服务中的函数。</p>
<p><strong>操作数据库</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// `basement` 是一个全局变量</span></span><br><span class="line"><span class="comment">// 操作数据库</span></span><br><span class="line">basement.db.collection(<span class="string">'users'</span>)</span><br><span class="line">	.insertOne(&#123;</span><br><span class="line">		name: <span class="string">'node'</span>,</span><br><span class="line">		age: <span class="number">18</span>,</span><br><span class="line">	&#125;)</span><br><span class="line">	.then(() =&#123;</span><br><span class="line">		resolve(&#123; <span class="attr">success</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">	&#125;)</span><br><span class="line">	.catch(err =&#123;</span><br><span class="line">		reject(&#123; <span class="attr">success</span>: <span class="literal">false</span> &#125;);</span><br><span class="line">	&#125;);</span><br></pre></td></tr></table></figure>
<p><strong>上传图片</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 上传图片</span></span><br><span class="line">basement.file</span><br><span class="line">	.uploadFile(options)</span><br><span class="line">	.then((image) =&#123;</span><br><span class="line">		<span class="keyword">this</span>.setData(&#123;</span><br><span class="line">			iconUrl: image.fileUrl,</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;)</span><br><span class="line">	.catch(<span class="built_in">console</span>.error);</span><br></pre></td></tr></table></figure>
<p><strong>调用函数</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 调用函数</span></span><br><span class="line">basement.function</span><br><span class="line">	.invoke(<span class="string">'getUserInfo'</span>)</span><br><span class="line">	.then((res) =&#123; </span><br><span class="line">		<span class="keyword">this</span>.setData(&#123; </span><br><span class="line">			user: res.result</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;)</span><br><span class="line">	.catch(<span class="built_in">console</span>.error&#125;</span><br></pre></td></tr></table></figure>
<h3 id="通用-Serverless-架构"><a href="#通用-Serverless-架构" class="headerlink" title="通用 Serverless 架构"></a>通用 Serverless 架构</h3><p>基于上述几个 Serverless 开发的例子，就可以总结出一个通用的 Serverless 架构。</p>
<p><img src="https://camo.githubusercontent.com/9a769191699fc87b5798e5677b20d255b7850c14/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323031392f706e672f3134383532342f313535373933353034343432372d66383836316266612d306162392d343231342d626634622d3232306239343938643261372e706e6723616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d363834266f726967696e4865696768743d363834266f726967696e57696474683d313531362673697a653d30267374617475733d646f6e652677696474683d31353136" alt></p>
<p>其中最底层就是实现复杂业务的后端微服务（Backend）。然后 FaaS 层通过一系列函数实现业务逻辑，并为前端直接提供服务。对于前端开发者来说，前端可以通过编写函数的方式来实现服务端的逻辑。对于后端开发者来说，后端变得更靠后了。如果业务比较较淡，FaaS 层能够实现，甚至也不需要微服务这一层了。</p>
<p>同时不管是在后端、FaaS 还是前端，我们都可以去调用云计算平台提供的 BaaS 服务，大大降低开发难度、减少开发成本。小程序云开发，就是直接在前端调用 BaaS 服务的例子。</p>
<h2 id="Serverless-开发最佳实践"><a href="#Serverless-开发最佳实践" class="headerlink" title="Serverless 开发最佳实践"></a>Serverless 开发最佳实践</h2><p>基于 Serverless 开发模式和传统开发模式最大的不同，就是传统开发中，我们是基于应用的开发。开发完成后，我们需要对应用进行单元测试和集成测试。而基于 Serverless，开发的是一个个函数，那么我们应该如何对 Serverless 函数进行测试？Serverless 函数的测试和普通的单元测试又有什么区别？</p>
<p>还有一个很重要的点是，基于 Serverless 开发的应用性能如何？应该怎么去提高 Serverless 应用的性能？</p>
<p>本章主要就介绍一下，基于 Serverless 的函数的测试和函数的性能两个方面的最佳实践。</p>
<h3 id="函数的测试"><a href="#函数的测试" class="headerlink" title="函数的测试"></a>函数的测试</h3><p>虽然使用 Serverless 我们可以简单地进行业务的开发，但它的特性也给我们的测试带来了一些挑战。主要有以下几个方面。</p>
<p>Serverless 函数是分布式的，我们不知道也无需知道函数是部署或运行在哪台机器上，所以我们需要对每个函数进行单元测试。Serverless 应用是由一组函数组成的，函数内部可能依赖了一些别的后端服务（BaaS），所以我们也需要对 Serverless 应用进行集成测试。</p>
<p>运行函数的 FaaS 和 BaaS 在本地也难以模拟。除此之外，不同平台提供的 FaaS 环境可能不一致，不平台提供的 BaaS 服务的 SDK 或接口也可能不一致，这不仅给我们的测试带来了一些问题，也增加了应用迁移成本。</p>
<p>函数的执行是由事件驱动的，驱动函数执行的事件，在本地也难以模拟。</p>
<p>那么如何解决这些问题呢？</p>
<p>根据 <a href="https://www.mountaingoatsoftware.com/blog/the-forgotten-layer-of-the-test-automation-pyramid" target="_blank" rel="noopener">Mike Cohn</a> 提出的<a href="https://martinfowler.com/bliki/TestPyramid.html" target="_blank" rel="noopener">测试金字塔</a>，单元测试的成本最低，效率最高；UI 测试（集成）测试的成本最高，效率最低，所以我们要尽可能多的进行单元测试，从而减少集成测试。这对 Serverless 的函数测试同样适用。</p>
<p><img src="https://camo.githubusercontent.com/bd139378e1e706c2bcbc9ff1d9e97d4aa906a469/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323031392f706e672f3134383532342f313535373933353034343433302d36653530636665322d333938612d343765392d626335342d3135373031356464396538302e706e6723616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d363138266f726967696e4865696768743d363138266f726967696e57696474683d313032362673697a653d30267374617475733d646f6e652677696474683d31303236" alt><br>图片来源: <a href="https://martinfowler.com/bliki/TestPyramid.html" target="_blank" rel="noopener">https://martinfowler.com/bliki/TestPyramid.html</a></p>
<p>为了能更简单对函数进行单元测试，我们需要做的就是<strong>将业务逻辑和函数依赖的 FaaS（如函数计算） 和 BaaS （如云数据库）分离</strong>。当 FaaS 和 BaaS 分离出去之后，我们就可以像编写传统的单元测试一样，对函数的业务逻辑进行测试。然后再编写集成测试，验证函数和其他服务的集成是否正常工作。</p>
<h4 id="一个糟糕的例子"><a href="#一个糟糕的例子" class="headerlink" title="一个糟糕的例子"></a>一个糟糕的例子</h4><p>下面是一个使用 Node.js 实现的函数的例子。该函数做的事情就是，首先将用户信息存储到数据库中，然后给用户发送邮件。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> db = <span class="built_in">require</span>(<span class="string">'db'</span>).connect();</span><br><span class="line"><span class="keyword">const</span> mailer = <span class="built_in">require</span>(<span class="string">'mailer'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports.saveUser = (event, context, callback) =&#123;</span><br><span class="line">  <span class="keyword">const</span> user = &#123;</span><br><span class="line">    email: event.email,</span><br><span class="line">    created_at: <span class="built_in">Date</span>.now()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  db.saveUser(user, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      callback(err);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      mailer.sendWelcomeEmail(event.email);</span><br><span class="line">      callback();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>这个例子主要存在两个问题：</p>
<ol>
<li>业务逻辑和 FaaS 耦合在一起。主要就是业务逻辑都在 <code>saveUser</code> 这个函数里，而 <code>saveUser</code> 参数的 <code>event</code> 和 <code>conent</code> 对象，是 FaaS 平台提供的。</li>
<li>业务逻辑和 BaaS 耦合在一起。具体来说，就是函数内使用了 <code>db</code> 和 <code>mailer</code> 这两个后端服务，测试函数必须依赖于 <code>db</code> 和 <code>mailer</code>。</li>
</ol>
<h4 id="编写可测试的函数"><a href="#编写可测试的函数" class="headerlink" title="编写可测试的函数"></a>编写可测试的函数</h4><p>基于<strong>将业务逻辑和函数依赖的 FaaS 和 BaaS 分离</strong>的原则，对上面的代码进行重构。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Users</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(db, mailer) &#123;</span><br><span class="line">    <span class="keyword">this</span>.db = db;</span><br><span class="line">    <span class="keyword">this</span>.mailer = mailer;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  save(email, callback) &#123;</span><br><span class="line">    <span class="keyword">const</span> user = &#123;</span><br><span class="line">      email: email,</span><br><span class="line">      created_at: <span class="built_in">Date</span>.now()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.db.saveUser(user, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        callback(err);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.mailer.sendWelcomeEmail(email);</span><br><span class="line">        callback();</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = Users;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> db = <span class="built_in">require</span>(<span class="string">'db'</span>).connect();</span><br><span class="line"><span class="keyword">const</span> mailer = <span class="built_in">require</span>(<span class="string">'mailer'</span>);</span><br><span class="line"><span class="keyword">const</span> Users = <span class="built_in">require</span>(<span class="string">'users'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> users = <span class="keyword">new</span> Users(db, mailer);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports.saveUser = (event, context, callback) =&#123;</span><br><span class="line">  users.save(event.email, callback);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>在重构后的代码中，我们将业务逻辑全都放在了 <code>Users</code> 这个类里面，<code>Users</code> 不依赖任何外部服务。测试的时候，我们也可以不传入真实的 <code>db</code> 或 <code>mailer</code>，而是传入模拟的服务。</p>
<p>下面是一个模拟 <code>mailer</code> 的例子。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 模拟 mailer</span></span><br><span class="line"><span class="keyword">const</span> mailer = &#123;</span><br><span class="line">  sendWelcomeEmail: (email) =&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">`Send email to <span class="subst">$&#123;email&#125;</span> success!`</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>这样只要对 <code>Users</code> 进行充分的单元测试，就能确保业务代码如期运行。</p>
<p>然后再传入真实的 <code>db</code> 和 <code>mailer</code>，进行简单的集成测试，就能知道整个函数是否能够正常工作。</p>
<p>重构后的代码还有一个好处是方便函数的迁移。当我们想要把函数从一个平台迁移到另一个平台的时候，只需要根据不同平台提供的参数，修改一下 <code>Users</code> 的调用方式就可以了，而不用再去修改业务逻辑。</p>
<h4 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h4><p>综上所述，对函数进行测试，就需要牢记金字塔原则，并遵循以下原则：</p>
<ol>
<li>将业务逻辑和函数依赖的 FaaS 和 BaaS 分离</li>
<li>对业务逻辑进行充分的单元测试</li>
<li>将函数进行集成测试验证代码是否正常工作</li>
</ol>
<h3 id="函数的性能"><a href="#函数的性能" class="headerlink" title="函数的性能"></a>函数的性能</h3><p>使用 Serverless 进行开发，还有一个大家都关心的问题就是函数的性能怎么样。</p>
<p>对于传统的应用，我们的程序启动起来之后，就常驻在内存中；而 Serverless 函数则不是这样。</p>
<p>当驱动函数执行的事件到来的时候，首先需要下载代码，然后启动一个容器，在容器里面再启动一个运行环境，最后才是执行代码。前几步统称为冷启动（Cold Start）。传统的应用没有冷启动的过程。</p>
<p>下面是函数生命周期的示意图：</p>
<p><img src="https://camo.githubusercontent.com/d392074c205700b246df151284473ae7e8dbc609/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323031392f706e672f3134383532342f313535373933353034343432372d39636633383466642d613461372d346638382d393739352d3731383532323134303266642e706e6723616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d333336266f726967696e4865696768743d333336266f726967696e57696474683d313333302673697a653d30267374617475733d646f6e652677696474683d31333330" alt><br>图片来源: <a href="https://www.youtube.com/watch?v=oQFORsso2go&amp;feature=youtu.be&amp;t=8m5s" target="_blank" rel="noopener">https://www.youtube.com/watch?v=oQFORsso2go&amp;feature=youtu.be&amp;t=8m5s</a></p>
<p>冷启动时间的长短，就是函数性能的关键因素。优化函数的性能，也就需要从函数生命周期的各个阶段去优化。</p>
<h4 id="不同编程语言对冷启动时间的影响"><a href="#不同编程语言对冷启动时间的影响" class="headerlink" title="不同编程语言对冷启动时间的影响"></a>不同编程语言对冷启动时间的影响</h4><p>在此之前，已经有很多人测试过不同编程语言对冷启动时间的影响，比如：</p>
<ul>
<li><a href="https://theburningmonk.com/2017/06/aws-lambda-compare-coldstart-time-with-different-languages-memory-and-code-sizes/" target="_blank" rel="noopener">Compare coldstart time with different languages, memory and code sizes</a>  -by Yan Cui</li>
<li><a href="https://blog.octo.com/en/cold-start-warm-start-with-aws-lambda/" target="_blank" rel="noopener">Cold start / Warm start with AWS Lambda</a> - by Erwan Alliaume</li>
<li><a href="https://mikhail.io/2018/08/serverless-cold-start-war/" target="_blank" rel="noopener">Serverless: Cold Start War</a> - by Mikhail Shilkov</li>
</ul>
<p><img src="https://camo.githubusercontent.com/267b84d7a5b19a8fb9154fd4dcae9273ce6eb11e/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323031392f706e672f3134383532342f313535373933353034343433372d31653939363165352d663165322d343436312d383936392d3561306539373461353564662e706e6723616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d31303536266f726967696e4865696768743d31303536266f726967696e57696474683d313539302673697a653d30267374617475733d646f6e652677696474683d31353930" alt><br>图片来源: <a href="https://blog.octo.com/en/cold-start-warm-start-with-aws-lambda/" target="_blank" rel="noopener">Cold start / Warm start with AWS Lambda</a></p>
<p>从这些测试中能够得到一些统一的结论：</p>
<ul>
<li>增加函数的内存可以减少冷启动时间</li>
<li>C#、Java 等编程语言的能启动时间大约是 Node.js、Python 的 100 倍</li>
</ul>
<p>基于上述结论，如果想要 Java 的冷启动时间达到 Node.js 那么小，可以为 Java 分配更大的内存。但更大的内存意味着更多的成本。</p>
<h4 id="函数冷启动的时机"><a href="#函数冷启动的时机" class="headerlink" title="函数冷启动的时机"></a>函数冷启动的时机</h4><p>刚开始接触 Serverless 的开发者可能有一个误区，就是每次函数执行，都需要冷启动。其实并不是这样。</p>
<p>当第一次请求（驱动函数执行的事件）来临，成功启动运行环境并执行函数之后，运行环境会保留一段时间，以便用于下一次函数执行。这样就能减少冷启动的次数，从而缩短函数运行时间。当请求达到一个运行环境的限制时，FaaS 平台会自动扩展下一个运行环境。</p>
<p><img src="https://camo.githubusercontent.com/7848af49349be366429e50bc078bd2ef669fc688/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323031392f706e672f3134383532342f313535373933353034343433372d31643432323766382d313433622d343466632d623266342d3634626166383562363338632e706e6723616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d373636266f726967696e4865696768743d373636266f726967696e57696474683d313633302673697a653d30267374617475733d646f6e652677696474683d31363330" alt></p>
<p>以 AWS Lambda 为例，在执行函数之后，Lambda 会保持执行上下文一段时间，预期用于另一次 Lambda 函数调用。其效果是，服务在 Lambda 函数完成后冻结执行上下文，如果再次调用 Lambda 函数时 AWS Lambda 选择重用上下文，则解冻上下文供重用。</p>
<p>下面以两个小测试来说明上述内容。</p>
<p>我使用阿里云的函数计算实现了一个 Serverless 函数，并通过 HTTP 事件来驱动。然后使用不同并发数向函数发起 100 个请求。</p>
<p>首先是一个并发的情况：</p>
<p><img src="https://camo.githubusercontent.com/a3e20cfbc3ca4281543f5d4c935f43cf2df70d9a/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323031392f706e672f3134383532342f313535373933353034343432372d61313931326333652d613734372d343533612d386634392d6131643236326361333566652e706e6723616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d383137266f726967696e4865696768743d383137266f726967696e57696474683d3838372673697a653d30267374617475733d646f6e652677696474683d383837" alt></p>
<p>可以看到第一个请求时间为 302ms，其他请求时间基本都在 50ms 左右。基本就能确定，第一个请求对应的函数是冷启动，剩余 99 个请求，都是热启动，直接重复利用了第一个请求的运行环境。</p>
<p>接下来是并发数为 10 的情况：</p>
<p><img src="https://camo.githubusercontent.com/c00029eaccb7cc2c0b915d504785ae1126f0b0ad/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323031392f706e672f3134383532342f313535373933353034343433362d36383735336137312d616134612d346132652d623631372d3635343735613638346332632e706e6723616c69676e3d6c65667426646973706c61793d696e6c696e65266865696768743d383137266f726967696e4865696768743d383137266f726967696e57696474683d313031362673697a653d30267374617475733d646f6e652677696474683d31303136" alt></p>
<p>可以发现，前 10 个请求，耗时基本在 200ms-300ms，其余请求耗时在 50ms 左右。于是可以得出结论，前 10 个并发请求都是冷启动，同时启动了 10 个运行环境；后面 90 个请求都是热启动。</p>
<p>这也就印证了之前的结论，函数不是每次都冷启动，而是会在一定时间内复用之前的运行环境。</p>
<h4 id="执行上下文重用"><a href="#执行上下文重用" class="headerlink" title="执行上下文重用"></a>执行上下文重用</h4><p>上面的结论对我们提高函数性能有什么帮助呢？当然是有的。既然运行环境能够保留，那就意味着我们能对运行环境中的执行上下文进行重复利用。</p>
<p>来看一个例子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">'mysql'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports.saveUser = (event, context, callback) =&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 初始化数据库连接</span></span><br><span class="line">	<span class="keyword">const</span> connection = mysql.createConnection(&#123; <span class="comment">/* ... */</span> &#125;);</span><br><span class="line">	connection.connect();</span><br><span class="line">  </span><br><span class="line">	connection.query(<span class="string">'...'</span>);</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>上面例子实现的功能就是在 <code>saveUser</code> 函数中初始化一个数据库连接。这样的问题就是，每次函数执行的时候，都会重新初始化数据库连接，而连接数据库又是一个比较耗时的操作。显然这样对函数的性能是没有好处的。</p>
<p>既然在短时间内，函数的执行上下文可以重复利用，那么我们就可以将数据库连接放在函数之外：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">'mysql'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化数据库连接</span></span><br><span class="line"><span class="keyword">const</span> connection = mysql.createConnection(&#123; <span class="comment">/* ... */</span> &#125;);</span><br><span class="line">connection.connect();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports.saveUser = (event, context, callback) =&#123;</span><br><span class="line"></span><br><span class="line">	connection.query(<span class="string">'...'</span>);</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>这样就只有第一次运行环境启动的时候，才会初始化数据库连接。后续请求来临、执行函数的时候，就可以直接利用执行上下文中的 <code>connection</code>，从而提后续高函数的性能。</p>
<p>大部分情况下，通过牺牲一个请求的性能，换取大部分请求的性能，是完全可以够接受的。</p>
<h4 id="给函数预热"><a href="#给函数预热" class="headerlink" title="给函数预热"></a>给函数预热</h4><p>既然函数的运行环境会保留一段时间，那么我们也可以通过主动调用函数的方式，隔一段时间就冷启动一个运行环境，这样就能使得其他正常的请求都是热启动，从而避免冷启动时间对函数性能的影响。</p>
<p>这是目前比较有效的方式，但也需要有一些注意的地方：</p>
<ol>
<li>不要过于频繁调用函数，至少频率要大于 5 分钟</li>
<li>直接调用函数，而不是通过网关等间接调用</li>
<li>创建专门处理这种预热调用的函数，而不是正常业务函数</li>
</ol>
<p>这种方案只是目前行之有效且比较黑科技的方案，可以使用，但如果你的业务允许“牺牲第一个请求的性能换取大部分性能”，那也完全不必使用该方案，</p>
<h4 id="小结-1"><a href="#小结-1" class="headerlink" title="小结"></a>小结</h4><p>总体而言，优化函数的性能就是优化冷启动时间。上述方案都是开发者方面的优化，当然还一方面主要是 FaaS 平台的性能优化。</p>
<p>总结一下上述方案，主要是以下几点：</p>
<ol>
<li>选用 Node.js / Python 等冷启动时间短的编程语言</li>
<li>为函数分配合适的运行内存</li>
<li>执行上下文重用</li>
<li>为函数预热</li>
</ol>
<p>从云计算的发展历程来看，Serverless 是云计算发展中的又一次技术的演进。云计算的目的是为了降低成本。云计算是服务器集群，但是是由专业厂商管理的集群，并在此基础上提供了一些列软硬件服务，使得企业和开发者能够以更低的成本实现自己的业务。但现在的云计算也还存在一些缺点，比如我买了一台服务器。而 Serverless 将进一步降低使用云计算的运维和资金成本，并提高开发效率。Serverless 的理念就是让开发者不用关心服务器，让开发者更专注于业务的开发。当然，现在的 Serverless 架构，如 AWS 的 Lambda、阿里云的函数计算，可能还不能达到这种理想的情况，Serverless 这种架构模式本身也还在不断发展和完善中。</p>
<p>从前端的角度来看，很早以前其实没有前端的职位，后来因为页面变得越发复杂，所以分出来前端工程师。而 Serverless 则能够让前端再度回到 Web 应用开发这一职能，能够拓展前端的边界。比如现在小程序，腾讯云和支付宝都提供了 Serverless 的小程序平台，前端开发者就能够搞定整个应用开发了。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>作为前端工程师，我们一直在探讨前端的边界是什么。现在的前端开发早已不是以往的前端开发，前端不仅可以做网页，还可以做小程序，做 APP，做桌面程序，甚至做服务端。而前端之所以在不断拓展自己的边界、不断探索更多的领域，则是希望自己能够产生更大的价值。最好是用我们熟悉的工具、熟悉的方式来创造价值。</p>
<p>而 Serverless 架构的诞生，则可以最大程度帮助前端工程师实现自己的理想。使用 Serverless，我们不需要再过多关注服务端的运维，不需要关心我们不熟悉的领域，我们只需要专注于业务的开发、专注于产品的实现。我们需要关心的事情变少了，但我们能做的事情更多了。</p>
<p>Serverless 也必将对前端的开发模式产生巨大的变革，前端工程师的职能也将再度回归到应用工程师的职能。</p>
<p>如果要用一句话来总结 Serverless，那就是 Less is More 【少即是多】。</p>
<h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><h3 id="Serverless-初探"><a href="#Serverless-初探" class="headerlink" title="Serverless 初探"></a><a href="https://cloud.tencent.com/developer/article/1005537" target="_blank" rel="noopener">Serverless 初探</a></h3>
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Serverless/" rel="tag"># Serverless</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/07/14/video视频src是blob-https-探究/" rel="next" title="video视频src是blob:https://探究">
                <i class="fa fa-chevron-left"></i> video视频src是blob:https://探究
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/08/12/WebAssembly上手把玩体验/" rel="prev" title="WebAssembly上手把玩体验">
                WebAssembly上手把玩体验 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/tx.jpg" alt="李斌">
            
              <p class="site-author-name" itemprop="name">李斌</p>
              <p class="site-description motion-element" itemprop="description">人生如逆旅     我亦是行人</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">196</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">121</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/libin1991" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://juejin.im/user/57e737f6c4c971005f6bcd8d" target="_blank" title="juejin">
                      
                        <i class="fa fa-fw fa-spinner"></i>juejin</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#前端开发模式的演进"><span class="nav-number">1.</span> <span class="nav-text">前端开发模式的演进</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#基于模板渲染的动态页面"><span class="nav-number">1.1.</span> <span class="nav-text">基于模板渲染的动态页面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#基于-AJAX-的前后端分离"><span class="nav-number">1.2.</span> <span class="nav-text">基于 AJAX 的前后端分离</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#基于-Node-js-的前端工程化"><span class="nav-number">1.3.</span> <span class="nav-text">基于 Node.js 的前端工程化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#基于-Node-js-的全栈开发"><span class="nav-number">1.4.</span> <span class="nav-text">基于 Node.js 的全栈开发</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#下一代前端开发模式"><span class="nav-number">1.5.</span> <span class="nav-text">下一代前端开发模式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Serverless-服务中的前端解决方案"><span class="nav-number">2.</span> <span class="nav-text">Serverless 服务中的前端解决方案</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#什么是-Serverless"><span class="nav-number">2.1.</span> <span class="nav-text">什么是 Serverless</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#函数即服务-FaaS"><span class="nav-number">2.2.</span> <span class="nav-text">函数即服务 FaaS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#后端即服务-BaaS"><span class="nav-number">2.3.</span> <span class="nav-text">后端即服务 BaaS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Serverless-简介"><span class="nav-number">2.4.</span> <span class="nav-text">Serverless 简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Serverless-服务中的前端解决方案架构图"><span class="nav-number">2.5.</span> <span class="nav-text">Serverless 服务中的前端解决方案架构图</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#框架（Framework）"><span class="nav-number">2.5.1.</span> <span class="nav-text">框架（Framework）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Web-IDE"><span class="nav-number">2.5.2.</span> <span class="nav-text">Web IDE</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#命令行工具"><span class="nav-number">2.5.3.</span> <span class="nav-text">命令行工具</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#创建"><span class="nav-number">2.5.3.1.</span> <span class="nav-text">创建</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#部署"><span class="nav-number">2.5.3.2.</span> <span class="nav-text">部署</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#调试"><span class="nav-number">2.5.3.3.</span> <span class="nav-text">调试</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#应用场景"><span class="nav-number">2.5.4.</span> <span class="nav-text">应用场景</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#不同-Serverless-服务的对比"><span class="nav-number">2.6.</span> <span class="nav-text">不同 Serverless 服务的对比</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#基于-Serverless-的前端开发模式"><span class="nav-number">3.</span> <span class="nav-text">基于 Serverless 的前端开发模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#基于-Serverless-的-BFF"><span class="nav-number">3.1.</span> <span class="nav-text">基于 Serverless 的 BFF</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#基于-Serverless-的服务端渲染"><span class="nav-number">3.2.</span> <span class="nav-text">基于 Serverless 的服务端渲染</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#基于-Serverless-的小程序开发"><span class="nav-number">3.3.</span> <span class="nav-text">基于 Serverless 的小程序开发</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#通用-Serverless-架构"><span class="nav-number">3.4.</span> <span class="nav-text">通用 Serverless 架构</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Serverless-开发最佳实践"><span class="nav-number">4.</span> <span class="nav-text">Serverless 开发最佳实践</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#函数的测试"><span class="nav-number">4.1.</span> <span class="nav-text">函数的测试</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#一个糟糕的例子"><span class="nav-number">4.1.1.</span> <span class="nav-text">一个糟糕的例子</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#编写可测试的函数"><span class="nav-number">4.1.2.</span> <span class="nav-text">编写可测试的函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#小结"><span class="nav-number">4.1.3.</span> <span class="nav-text">小结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#函数的性能"><span class="nav-number">4.2.</span> <span class="nav-text">函数的性能</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#不同编程语言对冷启动时间的影响"><span class="nav-number">4.2.1.</span> <span class="nav-text">不同编程语言对冷启动时间的影响</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#函数冷启动的时机"><span class="nav-number">4.2.2.</span> <span class="nav-text">函数冷启动的时机</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#执行上下文重用"><span class="nav-number">4.2.3.</span> <span class="nav-text">执行上下文重用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#给函数预热"><span class="nav-number">4.2.4.</span> <span class="nav-text">给函数预热</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#小结-1"><span class="nav-number">4.2.5.</span> <span class="nav-text">小结</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#总结"><span class="nav-number">5.</span> <span class="nav-text">总结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考文章"><span class="nav-number">6.</span> <span class="nav-text">参考文章</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Serverless-初探"><span class="nav-number">6.1.</span> <span class="nav-text">Serverless 初探</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">李斌</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

  
  <!--
  	描述：点击红心
  -->
  <script type="text/javascript" src="/js/src/clicklove.js"></script>
  <!--
  	描述：复制代码
  -->
  <script type="text/javascript" src="/js/src/clipboard.min.js"></script>
  <script type="text/javascript" src="/js/src/clipboard-use.js"></script>
</body>
</html>


