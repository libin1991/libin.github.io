<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="继 24 个实例入门并掌握「Webpack4」(二) 后续： 十七、PWA 配置demo17 源码地址 本节使用 demo15 的代码为基础 我们来模拟平时开发中，将打包完的代码防止到服务器上的操作，首先打包代码 npm run build 然后安装一个插件 npm i http-server -D 在 package.json 中配置一个 script 命令 {   &amp;quot;scripts&amp;">
<meta property="og:type" content="article">
<meta property="og:title" content="撸一个webpack-loader&amp;plugin">
<meta property="og:url" content="http://yoursite.com/2019/04/12/撸一个webpack-loader-plugin/index.html">
<meta property="og:site_name" content="舞动乾坤">
<meta property="og:description" content="继 24 个实例入门并掌握「Webpack4」(二) 后续： 十七、PWA 配置demo17 源码地址 本节使用 demo15 的代码为基础 我们来模拟平时开发中，将打包完的代码防止到服务器上的操作，首先打包代码 npm run build 然后安装一个插件 npm i http-server -D 在 package.json 中配置一个 script 命令 {   &amp;quot;scripts&amp;">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2019/4/12/16a1001f7a60c524?imageView2/0/w/1280/h/960/format/webp/ignore-error/1">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2019/4/12/16a1001f2bc00afa?imageView2/0/w/1280/h/960/format/webp/ignore-error/1">
<meta property="og:image" content="data:image/svg+xml;utf8,<?xml version=" 1.0"?=""><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="463" height="337"/>">
<meta property="og:image" content="data:image/svg+xml;utf8,<?xml version=" 1.0"?=""><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="894" height="222"/>">
<meta property="og:image" content="data:image/svg+xml;utf8,<?xml version=" 1.0"?=""><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="846" height="400"/>">
<meta property="og:image" content="data:image/svg+xml;utf8,<?xml version=" 1.0"?=""><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="1280" height="567"/>">
<meta property="og:image" content="data:image/svg+xml;utf8,<?xml version=" 1.0"?=""><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="1041" height="296"/>">
<meta property="og:image" content="data:image/svg+xml;utf8,<?xml version=" 1.0"?=""><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="785" height="406"/>">
<meta property="og:image" content="data:image/svg+xml;utf8,<?xml version=" 1.0"?=""><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="706" height="418"/>">
<meta property="og:image" content="data:image/svg+xml;utf8,<?xml version=" 1.0"?=""><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="430" height="90"/>">
<meta property="og:image" content="data:image/svg+xml;utf8,<?xml version=" 1.0"?=""><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="764" height="134"/>">
<meta property="og:image" content="data:image/svg+xml;utf8,<?xml version=" 1.0"?=""><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="351" height="178"/>">
<meta property="og:image" content="data:image/svg+xml;utf8,<?xml version=" 1.0"?=""><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="648" height="124"/>">
<meta property="og:image" content="data:image/svg+xml;utf8,<?xml version=" 1.0"?=""><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="357" height="69"/>">
<meta property="og:image" content="data:image/svg+xml;utf8,<?xml version=" 1.0"?=""><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="561" height="120"/>">
<meta property="og:image" content="data:image/svg+xml;utf8,<?xml version=" 1.0"?=""><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="561" height="347"/>">
<meta property="og:image" content="data:image/svg+xml;utf8,<?xml version=" 1.0"?=""><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="545" height="273"/>">
<meta property="og:image" content="data:image/svg+xml;utf8,<?xml version=" 1.0"?=""><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="716" height="314"/>">
<meta property="og:image" content="data:image/svg+xml;utf8,<?xml version=" 1.0"?=""><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="989" height="590"/>">
<meta property="og:image" content="data:image/svg+xml;utf8,<?xml version=" 1.0"?=""><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="991" height="305"/>">
<meta property="og:image" content="data:image/svg+xml;utf8,<?xml version=" 1.0"?=""><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="837" height="329"/>">
<meta property="og:image" content="data:image/svg+xml;utf8,<?xml version=" 1.0"?=""><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="1192" height="593"/>">
<meta property="og:image" content="data:image/svg+xml;utf8,<?xml version=" 1.0"?=""><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="691" height="862"/>">
<meta property="og:image" content="data:image/svg+xml;utf8,<?xml version=" 1.0"?=""><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="354" height="366"/>">
<meta property="og:image" content="data:image/svg+xml;utf8,<?xml version=" 1.0"?=""><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="336" height="304"/>">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2019/4/12/16a100244b7ee724?imageView2/0/w/1280/h/960/format/webp/ignore-error/1">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2019/4/12/16a100254212cdee?imageView2/0/w/1280/h/960/format/webp/ignore-error/1">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2019/4/12/16a100269c333e54?imageView2/0/w/1280/h/960/format/webp/ignore-error/1">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2019/4/12/16a10025cd97aaf3?imageView2/0/w/1280/h/960/format/webp/ignore-error/1">
<meta property="og:image" content="data:image/svg+xml;utf8,<?xml version=" 1.0"?=""><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="550" height="247"/>">
<meta property="og:image" content="data:image/svg+xml;utf8,<?xml version=" 1.0"?=""><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="593" height="258"/>">
<meta property="og:image" content="data:image/svg+xml;utf8,<?xml version=" 1.0"?=""><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="1029" height="719"/>">
<meta property="og:image" content="data:image/svg+xml;utf8,<?xml version=" 1.0"?=""><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="563" height="245"/>">
<meta property="og:image" content="data:image/svg+xml;utf8,<?xml version=" 1.0"?=""><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="621" height="365"/>">
<meta property="og:image" content="data:image/svg+xml;utf8,<?xml version=" 1.0"?=""><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="679" height="400"/>">
<meta property="og:image" content="data:image/svg+xml;utf8,<?xml version=" 1.0"?=""><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="901" height="349"/>">
<meta property="og:image" content="data:image/svg+xml;utf8,<?xml version=" 1.0"?=""><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="294" height="74"/>">
<meta property="og:image" content="data:image/svg+xml;utf8,<?xml version=" 1.0"?=""><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="834" height="312"/>">
<meta property="og:image" content="data:image/svg+xml;utf8,<?xml version=" 1.0"?=""><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="818" height="238"/>">
<meta property="og:image" content="data:image/svg+xml;utf8,<?xml version=" 1.0"?=""><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="565" height="482"/>">
<meta property="og:image" content="data:image/svg+xml;utf8,<?xml version=" 1.0"?=""><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="517" height="912"/>">
<meta property="og:image" content="data:image/svg+xml;utf8,<?xml version=" 1.0"?=""><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="554" height="957"/>">
<meta property="og:image" content="data:image/svg+xml;utf8,<?xml version=" 1.0"?=""><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="675" height="267"/>">
<meta property="og:image" content="data:image/svg+xml;utf8,<?xml version=" 1.0"?=""><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="508" height="268"/>">
<meta property="og:image" content="data:image/svg+xml;utf8,<?xml version=" 1.0"?=""><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="916" height="197"/>">
<meta property="og:image" content="data:image/svg+xml;utf8,<?xml version=" 1.0"?=""><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="918" height="403"/>">
<meta property="og:image" content="data:image/svg+xml;utf8,<?xml version=" 1.0"?=""><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="565" height="631"/>">
<meta property="og:updated_time" content="2019-04-12T15:51:46.801Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="撸一个webpack-loader&amp;plugin">
<meta name="twitter:description" content="继 24 个实例入门并掌握「Webpack4」(二) 后续： 十七、PWA 配置demo17 源码地址 本节使用 demo15 的代码为基础 我们来模拟平时开发中，将打包完的代码防止到服务器上的操作，首先打包代码 npm run build 然后安装一个插件 npm i http-server -D 在 package.json 中配置一个 script 命令 {   &amp;quot;scripts&amp;">
<meta name="twitter:image" content="https://user-gold-cdn.xitu.io/2019/4/12/16a1001f7a60c524?imageView2/0/w/1280/h/960/format/webp/ignore-error/1">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2019/04/12/撸一个webpack-loader-plugin/">





  <title>撸一个webpack-loader&plugin | 舞动乾坤</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband">
    	<div class="eevee"><div class="body"><div class="head"><div class="ears"><div class="ear"><div class="lobe"></div></div><div class="ear"><div class="lobe"></div></div></div><div class="face"><div class="eyes"><div class="eye"><div class="eyelid"></div></div><div class="eye"><div class="eyelid"></div></div></div><div class="nose"></div><div class="mouth"></div></div></div><div class="chest"><div class="fur"><div class="patch"></div></div><div class="fur"><div class="patch"></div></div><div class="fur"><div class="patch"></div></div></div><div class="legs"><div class="leg"><div class="inner-leg"></div></div><div class="leg"><div class="inner-leg"></div></div><div class="leg"><div class="inner-leg"></div></div><div class="leg"><div class="inner-leg"></div></div></div><div class="tail"><div class="tail"><div class="tail"><div class="tail"><div class="tail"><div class="tail -end"></div></div></div></div></div></div></div></div>
    </div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
    	<div id="sky">
				<div id="background" class="container">
			<!-- svg file -->
			<svg id="svgout" height="100%" width="100%" viewbox="0 0 550 400">
				<defs>
					<g id="bottomShadow">
						<path fill="#000000" stroke="none" d="
		M 270.5 225.95
		L 127.35 316.65 266.8 400 409.6 309.25 270.5 225.95 Z"/>
					</g>
					<g id="Layer52_0_FILL">
						<path class="topGrass" fill="#B9D668" stroke="none" d="
	M 397.85 229.3
	L 397.85 225.6 269.85 152 135.75 228.6 135.75 233.65 262.1 306.55 397.85 229.3 Z"/>
					</g>
					<g id="Layer51_0_FILL">
						<path class="leftSideGrass" fill="#6E9E4F" stroke="none" d="
	M 135.1 229.95
	L 135.1 256.85 262.1 328.4 262.1 301.85 135.1 229.95 Z"/>
					</g>
					<g id="Layer50_0_FILL">
						<path class="rightGrassTop" fill="#8CB154" stroke="none" d="
	M 397.85 225.95
	L 395.8 225.95 261.75 301.55 261.75 328.4 397.85 251.15 397.85 225.95 Z"/>
					</g>
					<g id="Layer48_0_FILL">
						<path class="crustLeftTop" fill="#955541" stroke="none" d="
	M 135.45 282.4
	L 135.75 298.15 262.1 372.1 261.75 355.65 135.45 282.4 Z"/>
					</g>
					<g id="Layer47_0_FILL">
						<path class="middleLeftCrust" fill="#C77E61" stroke="none" d="
	M 135.1 270.3
	L 135.1 283.05 275.9 364.35 271.85 348.9 135.1 270.3 Z"/>
					</g>
					<g id="Layer46_0_FILL">
						<path class="crustLeftTop" fill="#955541" stroke="none" d="
	M 135.1 255.15
	L 135.1 270.3 262.1 343.55 262.1 328.05 135.1 255.15 Z"/>
					</g>
					<g id="Layer45_0_FILL">
						<path class="topRightCrust" fill="#A47237" stroke="none" d="
	M 397.5 294.5
	L 397.5 277 261.75 355.3 261.75 372.75 397.5 294.5 Z"/>
					</g>
					<g id="Layer44_0_FILL">
						<path class="middleRightCrust" fill="#C89451" stroke="none" d="
	M 397.5 269.95
	L 397.15 266.6 262.1 343.2 262.1 355.95 397.5 279.7 397.5 269.95 Z"/>
					</g>
					<g id="Layer43_0_FILL">
						<path class="topRightCrust" fill="#A47237" stroke="none" d="
	M 397.5 266.6
	L 397.5 250.45 261.75 328.4 261.75 343.85 397.5 266.6 Z"/>
					</g>
					<g id="Layer41_0_FILL">
						<path class="greyRoad" fill="#B2B2B1" stroke="none" d="
	M 295.05 283.05
	Q 299.05 280.35 308.45 275.3 317.85 269.95 323.6 266.9
	L 268.8 233.65 338.05 191.35 309.15 174.55 177.75 254.5
	Q 191.55 262.2 198.25 266.25 204.65 269.95 209.7 271.95
	L 241.6 250.45 295.05 283.05 Z"/>
					</g>
					<g id="Layer40_0_FILL">
						<path fill="#FFFFFF" stroke="none" d="
	M 199.95 256.85
	Q 194.55 261.2 191.9 262.2
	L 194.9 263.9 200.95 259.2 199.95 256.85
	M 225.8 243.75
	L 224.8 241.75 211.05 250.8 212.05 252.8 225.8 243.75
	M 308.15 275.65
	L 296.7 266.6 295.35 268.6 306.8 277.7 308.15 275.65
	M 275.9 253.5
	L 274.55 255.5 285.95 264.55 287.3 262.55 275.9 253.5
	M 251.7 227.3
	L 250.7 225.25 236.9 234.35 237.9 236.35 251.7 227.3
	M 257.05 240.7
	L 254.05 240.7 268.8 249.8 269.5 247.75 257.05 240.7
	M 277.2 207.8
	L 263.45 216.85 264.45 218.9 278.25 209.8 277.2 207.8
	M 305.1 192.65
	L 304.1 190.65 290.3 199.75 291.35 201.75 305.1 192.65 Z"/>
					</g>
					<g id="Layer38_0_FILL">
						<path class="frontFascia" fill="#ECB27B" stroke="none" d="
	M 359.25 187.95
	L 346.4 174.95 333.85 202.9 359.25 187.95 Z"/>
					</g>
					<g id="Layer37_0_FILL">
						<path class="frontWall" fill="#EFA258" stroke="none" d="
	M 334 201.05
	L 334.35 232 359.2 217.55 359.25 187.95 334 201.05 Z"/>
					</g>
					<g id="Layer36_0_FILL">
						<path class="leftWall" fill="#C57F42" stroke="none" d="
	M 334.35 232.3
	L 334.35 205.1 305.1 191.35 305.1 216.85 334.35 232.3 Z"/>
					</g>
					<g id="Layer35_0_FILL">
						<path class="rightRoof" fill="#EF4427" stroke="none" d="
	M 329.7 167.9
	L 331.05 167.9 344.55 176.7 347.85 176.7 363 192.25 363.15 189.55 350.65 176.7 350.55 176.7 334.25 167.5 334.25 159.1 329.7 159.1 329.7 164.9 322.65 160.95 322.3 162.15 329.7 167 329.7 167.9 Z"/>
					</g>
					<g id="Layer34_0_FILL">
						<path class="leftRoof" fill="#F2563B" stroke="none" d="
	M 334.05 207.05
	L 350.65 176.7 322.1 160.45 302.1 192.05 334.05 207.05 Z"/>
					</g>
					<g id="Layer30_0_FILL">
						<path id="windowFour" class="windows" stroke="none" fill="#975A42" d="
	M 341.35 203.3
	Q 340.9 203.45 340.5 203.8 340.1 204.2 339.85 204.75 339.7 205 339.7 205.3 339.6 205.75 339.7 206.1 339.7 206.15 339.7 206.2 339.8 206.5 340 206.8 340.55 207.4 341.45 207.4 342.35 207.4 343 206.8 343.4 206.5 343.65 206.1 343.85 205.75 343.95 205.3 344.05 204.4 343.55 203.8 343.3 203.45 343 203.3 342.65 203.15 342.2 203.15 341.8 203.15 341.35 203.3
	M 355.85 198.45
	Q 355.8 198.2 355.6 198 355.1 197.4 354.2 197.4 353.35 197.4 352.6 198 351.85 198.65 351.7 199.55 351.7 199.7 351.7 199.85 351.6 200.5 352 201.05 352.55 201.65 353.45 201.65 354.3 201.65 355.05 201.05 355.45 200.7 355.7 200.25 355.8 200.05 355.9 199.85 355.95 199.7 355.95 199.55 356.05 198.95 355.85 198.45 Z"/>
						<path class="door" fill="#B65041" stroke="none" d="
	M 351.95 211.2
	L 351.8 211.2 346.05 215.1 346.05 225.2 351.95 221.6 351.95 211.2
	M 351.2 211.2
	L 351.35 211.2 351.35 211.1 351.2 211.2 Z"/>
					</g>
					<g>
						<path id="Layer30_0_FILL" fill="#000000" fill-opacity="1" stroke="none" d="
	M 183.7 215.3
	L 183.7 215.6
	Q 187.25 231.75 212.25 234.35
	L 183.7 215.3 Z"/>
					</g>
					<g id="Layer29_0_FILL">
						<path fill="#000000" fill-opacity="0.4" stroke="none" d="
	M 305.1 216.85
	L 305.15 217.2
	Q 309.45 233.2 334.35 232.3
	L 305.1 216.85 Z"/>
					</g>
					<g id="Layer27_0_FILL">
						<path class="vegetation" fill="#78A950" stroke="none" d="
	M 177.45 231.65
	Q 175.75 235.35 181.8 239.35 185.5 235.7 185.15 231.3 182.8 230.65 181.45 234 179.45 231.3 177.45 231.65
	M 236.9 266.6
	Q 235.2 270.3 241.25 274.3 244.95 270.6 244.65 266.25 242.3 265.6 240.95 268.95 238.9 266.25 236.9 266.6
	M 254.7 277
	Q 253.05 280.7 259.1 284.75 262.75 281.05 262.45 276.65 260.1 276 258.75 279.35 256.7 276.65 254.7 277
	M 315.5 245.75
	Q 313.5 243.05 311.5 243.4 309.8 247.1 315.85 251.15 319.55 247.45 319.2 243.05 316.85 242.4 315.5 245.75
	M 295.35 232.65
	Q 293.7 236.35 299.75 240.4 303.45 236.7 303.1 232.3 300.75 231.65 299.4 235 297.4 232.3 295.35 232.65
	M 277.2 171.85
	Q 275.55 175.55 281.6 179.55 285.3 175.85 284.95 171.5 282.6 170.85 281.25 174.2 279.25 171.5 277.2 171.85 Z"/>
					</g>
					<g id="Layer26_0_FILL">
						<path class="treeWood" fill="#AE663D" stroke="none" d="
	M 175.1 177.55
	L 172.05 177.55 172.05 191.1 159.3 172.85
	Q 154.6 171.5 172.05 195.7
	L 172.05 212.5 175.1 212.5 175.1 177.55
	M 252.7 151.35
	L 249 151.35 249 176.9 252.7 176.9 252.7 151.35 Z"/>
					</g>
					<g id="Layer25_0_FILL">
						<path class="vegetation" fill="#77A951" stroke="none" d="
	M 192.55 179.55
	Q 200.95 173.5 200.95 165.1 200.95 156.4 192.55 150 184.15 144.3 172.05 144.3 160.3 144.3 151.9 150 143.15 156.4 143.15 165.1 143.15 173.5 151.9 179.55 160.3 185.95 172.05 185.95 184.15 185.95 192.55 179.55
	M 236.25 106.65
	Q 230.2 116.05 230.2 129.15 230.2 142.25 236.25 151.35 242.3 160.75 250.7 160.75 258.75 160.75 264.8 151.35 270.85 142.25 270.85 129.15 270.85 116.05 264.8 106.65 258.75 97.6 250.7 97.6 242.3 97.6 236.25 106.65 Z"/>
					</g>
					<g id="Layer24_0_FILL">
						<path class="vegetation" fill="#77A951" stroke="none" d="
	M 158.3 221.9
	Q 160.65 221.9 161.95 220.2 163 219.55 163.3 218.55 164.65 218.9 166.35 218.9 170.05 218.9 172.4 216.2 175.1 213.85 175.1 210.15 175.1 206.45 172.4 203.75 170.05 201.4 166.35 201.4 162.65 201.4 159.95 203.75 157.6 206.45 157.6 210.15 157.6 210.8 157.6 211.15 155.95 211.5 154.6 212.5 152.9 214.15 152.9 216.55 152.9 218.9 154.6 220.2 156.25 221.9 158.3 221.9
	M 338.35 240.05
	Q 341.05 237.7 341.05 234 341.05 230.3 338.35 227.6 336 225.25 332.3 225.25 328.65 225.25 325.95 227.6 323.6 230.3 323.6 234 323.6 237.7 325.95 240.05 328.65 242.75 332.3 242.75 336 242.75 338.35 240.05 Z"/>
					</g>
					<g id="Layer22_0_FILL">
						<path class="rightRoof" fill="#D05041" stroke="none" d="
	M 220 173.85
	L 236.8 186.7 264.35 171.15 244.5 159.55 220 173.85 Z"/>
					</g>
					<g id="Layer21_0_FILL">
						<path class="leftWall" fill="#C57F42" stroke="none" d="
	M 212.25 191.35
	L 183.35 172.3 183.7 215.3 212.25 234.35 212.25 191.35 Z"/>
					</g>
					<g id="Layer20_0_FILL">
						<path class="rightRoof" fill="#EF4427" stroke="none" d="
	M 192.1 149.85
	L 236.45 174.8 243.1 171.4
	Q 220.05 150.55 196.3 139.95
	L 192.1 149.85 Z"/>
					</g>
					<g id="Layer19_0_FILL">
						<path class="frontFascia" fill="#EBB17B" stroke="none" d="
	M 226.85 160.95
	L 212 190.6 229.75 192.6 239.75 172.85 226.85 160.95 Z"/>
					</g>
					<g id="Layer18_0_FILL">
						<path class="frontWall" fill="#EFA258" stroke="none" d="
	M 240.15 172.65
	L 211.9 191.6 212.25 233.65 264.35 201.7 264.35 170.8 240.8 184.45 240.15 172.65 Z"/>
					</g>
					<g id="Layer17_0_FILL">
						<path class="rightRoof" fill="#EF4427" stroke="none" d="
	M 210.9 142.2
	L 205.9 142.2 205.9 152.65 210.9 152.65 210.9 142.2 Z"/>
					</g>
					<g>
						<path id="Layer16_0_FILL" class="leftRoof" fill="#F2563B" stroke="none" d="
	M 210.25 195.5
	L 227.4 160.95 195.45 141.35 177.65 175.85 210.25 195.5 Z"/>
					</g>
					<g>
						<path id="sun" fill="#E3BD0E" stroke="none" d="
	M 257.05 15.95
	Q 251.7 15.95 248 19.65 244.3 23.35 244.3 28.7 244.3 34.1 248 37.8 251.7 41.5 257.05 41.5 262.45 41.5 266.15 37.8 269.85 34.1 269.85 28.7 269.85 23.35 266.15 19.65 262.45 15.95 257.05 15.95 Z"/>
					</g>
					<g id="Layer8_0_FILL">
						<path fill="#975A42" stroke="none" d="
	M 238.45 189.65
	Q 238.295703125 189.362109375 238.05 189.1 237.35 188.3 236.2 188.3 235.05 188.3 234.15 189.1 233.3 189.9 233.2 191.05 233.1 192.2 233.8 193 234.55 193.8 235.7 193.8 236.85 193.8 237.7 193 238.1970703125 192.558203125 238.45 192 238.6552734375 191.56484375 238.7 191.05 238.7671875 190.276953125 238.45 189.65
	M 220.55 197.55
	Q 220 197.55 219.5 197.75 218.95 197.95 218.5 198.35 217.933203125 198.8833984375 217.7 199.55 217.5833984375 199.916796875 217.55 200.3 217.4923828125 200.96171875 217.7 201.5 217.852734375 201.9103515625 218.15 202.25 218.95 203.05 220.1 203.05 221.25 203.05 222.05 202.25 222.95 201.45 223.05 200.3 223.15 199.15 222.4 198.35 222.05 197.95 221.65 197.75 221.15 197.55 220.55 197.55 Z"/>
					</g>
					<g id="Layer7_0_FILL">
						<path class="door" fill="#B65041" stroke="none" d="
	M 233.55 206.75
	L 225.9 211.95 226.25 225.5 233.95 220.35 233.55 206.75 Z"/>
					</g>
					<g>
						<path id="windowOne" class="windows" fill="#975A42" stroke="none" d="
	M 188.65 198.4
	L 188.8 204.1 198.65 210.45 198.55 204.75 188.65 198.4
	M 208.45 216.8
	L 208.35 211.1 198.55 204.75 198.65 210.45 208.45 216.8
	M 188.8 204.1
	L 188.95 209.8 198.8 216.15 198.65 210.45 188.8 204.1
	M 208.6 222.5
	L 208.45 216.8 198.65 210.45 198.8 216.15 208.6 222.5 Z"/>
					</g>
					<g>
						<path id="windowThree" class="windows" fill="#975A42" stroke="none" d="
	M 311.7 214.1
	L 318.55 217.55 318.45 211.9 311.6 208.45 311.7 214.1
	M 325.4 221
	L 325.25 215.35 318.45 211.9 318.55 217.55 325.4 221
	M 318.4 206.2
	L 311.5 202.75 311.6 208.45 318.45 211.9 318.4 206.2
	M 325.25 215.35
	L 325.2 209.7 318.4 206.2 318.45 211.9 325.25 215.35 Z"/>
					</g>
					<g id="Layer2_0_FILL">
						<path class="door" fill="#B65041" stroke="none" d="
	M 259.7 183.25
	L 244.6 191.9 244.6 213.8 259.7 204.55 259.7 183.25 Z"/>
					</g>
					<path id="windowTwo" fill="#975A42" class="windows" stroke-width="1" stroke-linejoin="round" stroke-linecap="round" d="
	M 223.05 200.3
	Q 222.95 201.45 222.05 202.25 221.25 203.05 220.1 203.05 218.95 203.05 218.15 202.25 217.852734375 201.9103515625 217.7 201.5 217.4923828125 200.96171875 217.55 200.3 217.5833984375 199.916796875 217.7 199.575 217.933203125 198.8833984375 218.5 198.35 218.95 197.95 219.5 197.75 220 197.55 220.55 197.55 221.15 197.55 221.65 197.75 222.05 197.95 222.4 198.35 223.15 199.15 223.05 200.3 Z
	M 238.7 191.05
	Q 238.6552734375 191.56484375 238.45 192 238.1970703125 192.558203125 237.7 193 236.85 193.8 235.7 193.8 234.55 193.8 233.8 193 233.1 192.2 233.2 191.05 233.3 189.9 234.15 189.1 235.05 188.3 236.2 188.3 237.35 188.3 238.05 189.1 238.295703125 189.362109375 238.45 189.65 238.7671875 190.276953125 238.7 191.05 Z"/>
					<path fill="#F2563B" stroke="none" d=" M 351.95 211.2 L 351.8 211.2 346.05 215.1 346.05 225.2 351.95 221.6 351.95 211.2 Z"/>
					<path id="Layer6_0_1_STROKES" class="windowRims" stroke="#AE663D" stroke-width="1" stroke-linejoin="round" stroke-linecap="round" fill="none" d="
	M 198.55 204.75
	L 208.35 211.1 208.45 216.8 208.6 222.5 198.8 216.15 188.95 209.8 188.8 204.1 188.65 198.4 198.55 204.75 198.65 210.45 208.45 216.8
	M 198.8 216.15
	L 198.65 210.45 188.8 204.1"/>
					<path id="Layer5_0_1_STROKES" class="windowRims" stroke="#AE663D" stroke-width="1" stroke-linejoin="round" stroke-linecap="round" fill="none" d="
	M 325.25 215.35
	L 325.4 221 318.55 217.55 311.7 214.1 311.6 208.45 311.5 202.75 318.4 206.2 325.2 209.7 325.25 215.35 318.45 211.9 318.55 217.55
	M 318.4 206.2
	L 318.45 211.9 311.6 208.45"/>
				</defs>
				<g id="shadow">
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use xlink:href="#bottomShadow"/>
					</g>
				</g>
				<g transform="matrix( 1, 0, 0, 1, 0,0) ">
					<use xlink:href="#sun"/>
				</g>
				<g id="earth">
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer52_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer51_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer50_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer48_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer47_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer46_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer45_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer44_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer43_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer41_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer40_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer38_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer37_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer36_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer35_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer34_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#windowFour"/>
						<use class="element" xlink:href="#Layer32_0_1_STROKES"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer30_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer27_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer26_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer25_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer24_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer22_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer21_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer20_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer19_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer18_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer17_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer16_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer8_0_FILL"/>
						<use class="element" xlink:href="#windowTwo"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer7_0_FILL"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#windowOne"/>
						<use class="element" xlink:href="#Layer6_0_1_STROKES"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#windowThree"/>
						<use class="element" xlink:href="#Layer5_0_1_STROKES"/>
					</g>
					<g transform="matrix( 1, 0, 0, 1, 0,0) ">
						<use class="element" xlink:href="#Layer2_0_FILL"/>
					</g>
				</g>
			</svg>
			<! -- End of SVG file -->
			<! -- Moon/Sun Toggle -->
			<div id="toggleButton" class="day-toggle">
				<div class="sun-icon"></div>
				<label class="switch">
            <input id="toggleCheckbox" type="checkbox">
            <div class="slider"></div>
        </label>
				<div class="cloud-icon"></div>
			</div>
			<! -- Moon/Sun Toggle -->
			<! -- End of Container -->
		</div>
			</div>
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">舞动乾坤</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">星光不问赶路人 岁月不负有心人</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/12/撸一个webpack-loader-plugin/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="李斌">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/tx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="舞动乾坤">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">撸一个webpack-loader&plugin</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-12T23:48:29+08:00">
                2019-04-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>继 <a href="https://juejin.im/post/5cb01ab0e51d456e3428c0ca" target="_blank" rel="noopener">24 个实例入门并掌握「Webpack4」(二)</a> 后续：</p>
<h1 id="十七、PWA-配置"><a href="#十七、PWA-配置" class="headerlink" title="十七、PWA 配置"></a>十七、PWA 配置</h1><p><a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2FITxiaohao%2Fwebpack4-learn%2Ftree%2Fmaster%2Fdemo17" target="_blank" rel="noopener">demo17 源码地址</a></p>
<p>本节使用 <a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2FITxiaohao%2Fwebpack4-learn%2Ftree%2Fmaster%2Fdemo15" target="_blank" rel="noopener">demo15</a> 的代码为基础</p>
<p>我们来模拟平时开发中，将打包完的代码防止到服务器上的操作，首先打包代码 <code>npm run build</code></p>
<p>然后安装一个插件 <code>npm i http-server -D</code></p>
<p>在 package.json 中配置一个 script 命令</p>
<pre><code>{
  &quot;scripts&quot;: {
    &quot;start&quot;: &quot;http-server dist&quot;,
    &quot;dev&quot;: &quot;webpack-dev-server --open --config ./build/webpack.dev.conf.js&quot;,
    &quot;build&quot;: &quot;webpack --config ./build/webpack.prod.conf.js&quot;
  }
}
复制代码
</code></pre><p>运行 <code>npm run start</code><br><img src="https://user-gold-cdn.xitu.io/2019/4/12/16a1001f7a60c524?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""><br>现在就起了一个服务，端口是 8080，现在访问 <strong><a href="https://link.juejin.im?target=http%3A%2F%2F127.0.0.1%3A8080" target="_blank" rel="noopener">http://127.0.0.1:8080</a></strong> 就能看到效果了</p>
<blockquote>
<p>如果你有在跑别的项目，端口也是 8080，端口就冲突，记得先关闭其他项目的 8080 端口，再 <code>npm run start</code></p>
</blockquote>
<p>我们按 ctrl + c 关闭 http-server 来模拟<strong>服务器挂了</strong>的场景，再访问 <strong><a href="https://link.juejin.im?target=http%3A%2F%2F127.0.0.1%3A8080" target="_blank" rel="noopener">http://127.0.0.1:8080</a></strong> 就会是这样<br><img src="https://user-gold-cdn.xitu.io/2019/4/12/16a1001f2bc00afa?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""><br>页面访问不到了，因为我们服务器挂了，PWA 是什么技术呢，它可以在你第一次访问成功的时候，做一个缓存，当服务器挂了之后，你依然能够访问这个网页</p>
<p>首先安装一个插件：<strong>workbox-webpack-plugin</strong></p>
<pre><code>npm i workbox-webpack-plugin -D
复制代码
</code></pre><p>只有要上线的代码，才需要做 PWA 的处理，打开 <strong>webpack.prod.conf.js</strong></p>
<pre><code>const WorkboxPlugin = require(&apos;workbox-webpack-plugin&apos;) // 引入 PWA 插件const prodConfig = {
  plugins: [
    // 配置 PWAnew WorkboxPlugin.GenerateSW({
      clientsClaim: true,
      skipWaiting: true
    })
  ]
}
复制代码
</code></pre><p>重新打包，在 dist 目录下会多出 <code>service-worker.js</code> 和 <code>precache-manifest.js</code> 两个文件，通过这两个文件就能使我们的网页支持 PWA 技术，<strong>service-worker.js</strong> 可以理解为另类的缓存<br><img src="data:image/svg+xml;utf8,&lt;?xml version=&quot;1.0&quot;?&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot; width=&quot;463&quot; height=&quot;337&quot;&gt;&lt;/svg&gt;" alt=""><br>还需要去业务代码中使用 <strong>service-worker</strong></p>
<p>在 app.js 中加上以下代码</p>
<pre><code>// 判断该浏览器支不支持 serviceWorkerif (&apos;serviceWorker&apos;in navigator) {
  window.addEventListener(&apos;load&apos;, () =&gt; {
    navigator.serviceWorker
      .register(&apos;/service-worker.js&apos;)
      .then(registration =&gt; {
        console.log(&apos;service-worker registed&apos;)
      })
      .catch(error =&gt; {
        console.log(&apos;service-worker registed error&apos;)
      })
  })
}
复制代码
</code></pre><p>重新打包，然后运行 <code>npm run start</code> 来模拟服务器上的操作，最好用无痕模式打开 <strong><a href="https://link.juejin.im?target=http%3A%2F%2F127.0.0.1%3A8080" target="_blank" rel="noopener">http://127.0.0.1:8080</a></strong> ，打开控制台<br><img src="data:image/svg+xml;utf8,&lt;?xml version=&quot;1.0&quot;?&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot; width=&quot;894&quot; height=&quot;222&quot;&gt;&lt;/svg&gt;" alt=""><br>现在文件已经被缓存住了，再按 ctrl + c 关闭服务，再次刷新页面也还是能显示的</p>
<h1 id="十八、TypeScript-配置"><a href="#十八、TypeScript-配置" class="headerlink" title="十八、TypeScript 配置"></a>十八、TypeScript 配置</h1><p><a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2FITxiaohao%2Fwebpack4-learn%2Ftree%2Fmaster%2Fdemo18" target="_blank" rel="noopener">demo18 源码地址</a></p>
<p><a href="https://link.juejin.im?target=https%3A%2F%2Fwww.tslang.cn%2F" target="_blank" rel="noopener">TypeScript</a> 是 JavaScript 类型的超集，它可以编译成纯 JavaScript</p>
<p>新建文件夹，<code>npm init -y</code>，<code>npm i webpack webpack-cli -D</code>，新建 src 目录，创建 <strong>index.ts</strong> 文件，这段代码在浏览器上是运行不了的，需要我们打包编译，转成 js</p>
<pre><code>class Greeter {
  greeting: stringconstructor(message: string) {
    this.greeting = message
  }
  greet() {
    return&apos;Hello, &apos; + this.greeting
  }
}

let greeter = new Greeter(&apos;world&apos;)

alert(greeter.greet())
复制代码

npm i ts-loader typescript -D
复制代码
</code></pre><p>新建 webpack.config.js 并配置</p>
<pre><code>const path = require(&apos;path&apos;)

module.exports = {
  mode: &apos;production&apos;,
  entry: &apos;./src/index.ts&apos;,
  module: {
    rules: [
      {
        test: /\.ts?$/,
        use: &apos;ts-loader&apos;,
        exclude: /node_modules/
      }
    ]
  },
  output: {
    filename: &apos;bundle.js&apos;,
    path: path.resolve(__dirname, &apos;dist&apos;)
  }
}
复制代码
</code></pre><p>在 package.json 中配置 script</p>
<pre><code>{
  &quot;scripts&quot;: {
    &quot;build&quot;: &quot;webpack&quot;
  }
}
复制代码
</code></pre><p>运行 <code>npm ruh build</code>，报错了，缺少 <strong>tsconfig.json</strong> 文件<br><img src="data:image/svg+xml;utf8,&lt;?xml version=&quot;1.0&quot;?&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot; width=&quot;846&quot; height=&quot;400&quot;&gt;&lt;/svg&gt;" alt=""></p>
<blockquote>
<p>当打包 typescript 文件的时候，需要在项目的根目录下创建一个 tsconfig.json 文件</p>
</blockquote>
<p>以下为简单配置，更多详情看<a href="https://link.juejin.im?target=https%3A%2F%2Fwww.typescriptlang.org%2Fdocs%2Fhandbook%2Ftsconfig-json.html" target="_blank" rel="noopener">官网</a></p>
<pre><code>{
  &quot;compileerOptions&quot;: {
    &quot;outDir&quot;: &quot;./dist&quot;, // 写不写都行
    &quot;module&quot;: &quot;es6&quot;, // 用 es6 模块引入 import
    &quot;target&quot;: &quot;es5&quot;, // 打包成 es5
    &quot;allowJs&quot;: true // 允许在 ts 中也能引入 js 的文件
  }
}
复制代码
</code></pre><p>再次打包，打开 bundle.js 文件，<strong>将代码全部拷贝到浏览器控制台上</strong>，使用这段代码，可以看到弹窗出现 Hello,world，说明 ts 编译打包成功<br><img src="data:image/svg+xml;utf8,&lt;?xml version=&quot;1.0&quot;?&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot; width=&quot;1280&quot; height=&quot;567&quot;&gt;&lt;/svg&gt;" alt=""></p>
<h2 id="引入第三方库"><a href="#引入第三方库" class="headerlink" title="引入第三方库"></a>引入第三方库</h2><pre><code>npm i lodash
复制代码

import _ from &apos;lodash&apos;

class Greeter {
  greeting: string
  constructor(message: string) {
    this.greeting = message
  }
  greet() {
    return _.join()
  }
}

let greeter = new Greeter(&apos;world&apos;)

alert(greeter.greet())
复制代码
</code></pre><p>lodash 的 join 方法需要我们传递参数，但是现在我们什么都没传，也没有报错，我们使用 typescript 就是为了类型检查，在引入第三方库的时候也能如此，可是现在缺并没有报错或者提示</p>
<p>我们还要安装一个 lodash 的 typescript 插件，这样就能识别 lodash 方法中的参数，一旦使用的不对就会报错出来</p>
<pre><code>npm i @types/lodash -D
复制代码
</code></pre><p>安装完以后可以发现下划线 _ 报错了<br><img src="data:image/svg+xml;utf8,&lt;?xml version=&quot;1.0&quot;?&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot; width=&quot;1041&quot; height=&quot;296&quot;&gt;&lt;/svg&gt;" alt=""><br>需要改成 <code>import * as _ from &#39;lodash&#39;</code>，将 join 方法传递的参数删除，还可以发现 join 方法的报错，这就体现了 typescript 的优势，同理，引入 jQuery 也要引入一个 jQuery 对应的类型插件<br><img src="data:image/svg+xml;utf8,&lt;?xml version=&quot;1.0&quot;?&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot; width=&quot;785&quot; height=&quot;406&quot;&gt;&lt;/svg&gt;" alt=""><br><strong>如何知道使用的库需要安装对应的类型插件呢?</strong></p>
<p>打开<a href="https://link.juejin.im?target=https%3A%2F%2Fmicrosoft.github.io%2FTypeSearch%2F" target="_blank" rel="noopener">TypeSearch</a>，在这里对应的去搜索你想用的库有没有类型插件，如果有只需要 <code>npm i @types/jquery -D</code> 即可<br><img src="data:image/svg+xml;utf8,&lt;?xml version=&quot;1.0&quot;?&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot; width=&quot;706&quot; height=&quot;418&quot;&gt;&lt;/svg&gt;" alt=""></p>
<h1 id="十九、Eslint-配置"><a href="#十九、Eslint-配置" class="headerlink" title="十九、Eslint 配置"></a>十九、Eslint 配置</h1><p><a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2FITxiaohao%2Fwebpack4-learn%2Ftree%2Fmaster%2Fdemo19" target="_blank" rel="noopener">demo19 源码地址</a></p>
<p>创建一个空文件夹，<code>npm init -y</code>，<code>npm webpack webpack-cli -D</code> 起手式，之后安装 eslint 依赖</p>
<pre><code>npm i eslint -D
复制代码
</code></pre><p>使用 npx 运行此项目中的 eslint 来初始化配置，<code>npx eslint --init</code><br><img src="data:image/svg+xml;utf8,&lt;?xml version=&quot;1.0&quot;?&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot; width=&quot;430&quot; height=&quot;90&quot;&gt;&lt;/svg&gt;" alt=""><img src="data:image/svg+xml;utf8,&lt;?xml version=&quot;1.0&quot;?&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot; width=&quot;764&quot; height=&quot;134&quot;&gt;&lt;/svg&gt;" alt=""><br>这里会有选择是 React/Vue/JavaScript，我们统一都先选择 JavaScript。选完后会在项目的根目录下新建一个 <code>.eslintrc.js</code> 配置文件</p>
<pre><code>module.exports = {
  env: {
    browser: true,
    es6: true
  },
  extends: &apos;eslint:recommended&apos;,
  globals: {
    Atomics: &apos;readonly&apos;,
    SharedArrayBuffer: &apos;readonly&apos;
  },
  parserOptions: {
    ecmaVersion: 2018,
    sourceType: &apos;module&apos;
  },
  rules: {}
}
复制代码
</code></pre><p>里面就是 eslint 的一些规范，也可以定义一些规则，具体看 <a href="https://link.juejin.im?target=https%3A%2F%2Fcn.eslint.org%2Fdocs%2Fuser-guide%2Fconfiguring" target="_blank" rel="noopener">eslint 配置规则</a><br><img src="data:image/svg+xml;utf8,&lt;?xml version=&quot;1.0&quot;?&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot; width=&quot;351&quot; height=&quot;178&quot;&gt;&lt;/svg&gt;" alt=""><br>在 index.js 中随便写点代码来测试一下 eslint<br><img src="data:image/svg+xml;utf8,&lt;?xml version=&quot;1.0&quot;?&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot; width=&quot;648&quot; height=&quot;124&quot;&gt;&lt;/svg&gt;" alt=""><br>eslint 报错提示，变量定义后却没有使用，如果在编辑器里没出现报错提示，需要在 vscode 里先安装一个 eslint 扩展，它会根据你当前目录的下的 <code>.eslintrc.js</code> 文件来做作为校验的规则<br><img src="data:image/svg+xml;utf8,&lt;?xml version=&quot;1.0&quot;?&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot; width=&quot;357&quot; height=&quot;69&quot;&gt;&lt;/svg&gt;" alt=""><br>也可以通过命令行的形式，让 eslint 校验整个 src 目录下的文件<br><img src="data:image/svg+xml;utf8,&lt;?xml version=&quot;1.0&quot;?&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot; width=&quot;561&quot; height=&quot;120&quot;&gt;&lt;/svg&gt;" alt=""><br>如果你觉得某个规则很麻烦，想屏蔽掉某个规则的时候，可以这样，根据 eslint 的报错提示，比如上面的 <code>no-unused-vars</code>，将这条规则复制一下，在 <code>.eslintrc.js</code> 中的 rules 里配置一下，<code>&quot;no-unused-vars&quot;: 0</code>，0 表示禁用，保存后，就不会报错了，但是这种方式是适用于<strong>全局的配置</strong>，如果你只想在某一行代码上屏蔽掉 eslint 校验，可以这样做</p>
<pre><code>/* eslint-disable no-unused-vars */let a = &apos;1&apos;复制代码
</code></pre><p>这个 eslint 的 vscode 扩展和 webpack 是没有什么关联的，我们现在要讲的是如何在 webpack 里使用 eslint，首先安装一个插件</p>
<pre><code>npm i eslint-loader -D
复制代码
</code></pre><p>在 webpack.config.js 中进行配置</p>
<pre><code>/* eslint-disable no-undef */
// eslint-disable-next-line no-undef
const path = require(&apos;path&apos;)

module.exports = {
  mode: &apos;production&apos;,
  entry: {
    app: &apos;./src/index.js&apos; // 需要打包的文件入口
  },
  module: {
    rules: [
      {
        test: /\.js$/, // 使用正则来匹配 js 文件
        exclude: /nodes_modules/, // 排除依赖包文件夹
        use: {
          loader: &apos;eslint-loader&apos; // 使用 eslint-loader
        }
      }
    ]
  },
  output: {
    // eslint-disable-next-line no-undef
    publicPath: __dirname + &apos;/dist/&apos;, // js 引用的路径或者 CDN 地址
    // eslint-disable-next-line no-undef
    path: path.resolve(__dirname, &apos;dist&apos;), // 打包文件的输出目录
    filename: &apos;bundle.js&apos; // 打包后生产的 js 文件
  }
}
复制代码
</code></pre><p>由于 webpack 配置文件也会被 eslint 校验，这里我先写上注释，关闭校验</p>
<p>如果你有使用 babel-loader 来转译，则 loader 应该这么写</p>
<p><code>loader: [&#39;babel-loader&#39;, &#39;eslint-loader&#39;]</code></p>
<p>rules 的执行顺序是从右往左，从下往上的，先经过 eslint 校验判断代码是否符合规范，然后再通过 babel 来做转移</p>
<p>配置完 webpack.config.js，我们将 index.js 还原回之前报错的状态，不要使用注释关闭校验，然后运行打包命令，记得去 package.json 配置 script<br><img src="data:image/svg+xml;utf8,&lt;?xml version=&quot;1.0&quot;?&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot; width=&quot;561&quot; height=&quot;347&quot;&gt;&lt;/svg&gt;" alt=""><br>会在打包的时候，提示代码不合格，不仅仅是生产环境，开发环境也可以配置，可以将 eslint-loader 配置到 webpack 的公共模块中，这样更有利于我们检查代码规范</p>
<p>如：设置 fix 为 true，它会帮你自动修复一些错误，不能自动修复的，还是需要你自己手动修复</p>
<pre><code>{
 loader: &apos;eslint-loader&apos;, // 使用 eslint-loader
  options: {
    fix: true
  }
}
复制代码
</code></pre><p>关于 eslint-loader，webpack 的官网也给出了<a href="https://link.juejin.im?target=https%3A%2F%2Fwebpack.js.org%2Floaders%2Feslint-loader" target="_blank" rel="noopener">配置</a>，感兴趣的朋友自己去看一看</p>
<h1 id="二十、使用-DLLPlugin-加快打包速度"><a href="#二十、使用-DLLPlugin-加快打包速度" class="headerlink" title="二十、使用 DLLPlugin 加快打包速度"></a>二十、使用 DLLPlugin 加快打包速度</h1><p><a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2FITxiaohao%2Fwebpack4-learn%2Ftree%2Fmaster%2Fdemo20" target="_blank" rel="noopener">demo20 源码地址</a></p>
<p>本节使用 <a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2FITxiaohao%2Fwebpack4-learn%2Ftree%2Fmaster%2Fdemo15" target="_blank" rel="noopener">demo15</a> 的代码为基础</p>
<p>我们先安装一个 lodash 插件 <code>npm i lodash</code>，并在 app.js 文件中写入</p>
<pre><code>import _ from&apos;lodash&apos;console.log(_.join([&apos;hello&apos;, &apos;world&apos;], &apos;-&apos;))
复制代码
</code></pre><p>在 build 文件夹下新建 webpack.dll.js 文件</p>
<pre><code>const path = require(&apos;path&apos;)

module.exports = {
  mode: &apos;production&apos;,
  entry: {
    vendors: [&apos;lodash&apos;, &apos;jquery&apos;]
  },
  output: {
    filename: &apos;[name].dll.js&apos;,
    path: path.resolve(__dirname, &apos;../dll&apos;),
    library: &apos;[name]&apos;
  }
}
复制代码
</code></pre><p>这里使用 <strong>library</strong>，忘记的朋友可以回顾一下第十六节，自定义函数库里的内容，定义了 library 就相当于挂载了这个全局变量，只要在控制台输入全局变量的名称就可以显示里面的内容，比如这里我们是 <code>library: &#39;[name]&#39;</code> 对应的 name 就是我们在 entry 里定义的 <strong>vendors</strong></p>
<p>在 package.json 中的 script 再新增一个命令</p>
<pre><code>{
  &quot;scripts&quot;: {
    &quot;dev&quot;: &quot;webpack-dev-server --open --config ./build/webpack.dev.conf.js&quot;,
    &quot;build&quot;: &quot;webpack --config ./build/webpack.prod.conf.js&quot;,
    &quot;build:dll&quot;: &quot;webpack --config ./build/webpack.dll.js&quot;
  }
}
复制代码
</code></pre><p>运行 <code>npm run build:dll</code>，会生成 dll 文件夹，并且文件为 <code>vendors.dll.js</code><br><img src="data:image/svg+xml;utf8,&lt;?xml version=&quot;1.0&quot;?&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot; width=&quot;545&quot; height=&quot;273&quot;&gt;&lt;/svg&gt;" alt=""><br>打开文件可以发现 lodash 已经被打包到了 dll 文件中<br><img src="data:image/svg+xml;utf8,&lt;?xml version=&quot;1.0&quot;?&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot; width=&quot;716&quot; height=&quot;314&quot;&gt;&lt;/svg&gt;" alt=""><br>那我们要如何使用这个 vendors.dll.js 文件呢</p>
<p>需要再安装一个依赖 <code>npm i add-asset-html-webpack-plugin</code>，它会将我们打包后的 dll.js 文件注入到我们生成的 index.html 中</p>
<p>在 webpack.base.conf.js 文件中引入</p>
<pre><code>const AddAssetHtmlWebpackPlugin = require(&apos;add-asset-html-webpack-plugin&apos;)

module.exports = {
  plugins: [
    new AddAssetHtmlWebpackPlugin({
      filepath: path.resolve(__dirname, &apos;../dll/vendors.dll.js&apos;) // 对应的 dll 文件路径
    })
  ]
}
复制代码
</code></pre><p>使用 <code>npm run dev</code> 来打开网页<br><img src="data:image/svg+xml;utf8,&lt;?xml version=&quot;1.0&quot;?&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot; width=&quot;989&quot; height=&quot;590&quot;&gt;&lt;/svg&gt;" alt=""><br>现在我们已经把第三方模块单独打包成了 dll 文件，并使用</p>
<p>但是现在使用第三方模块的时候，要用 <strong>dll</strong> 文件，而不是使用 <strong>/node_modules/</strong> 中的库，继续来修改 <strong>webpack.dll.js</strong> 配置</p>
<pre><code>const path = require(&apos;path&apos;)
const webpack = require(&apos;webpack&apos;)

module.exports = {
  mode: &apos;production&apos;,
  entry: {
    vendors: [&apos;lodash&apos;, &apos;jquery&apos;]
  },
  output: {
    filename: &apos;[name].dll.js&apos;,
    path: path.resolve(__dirname, &apos;../dll&apos;),
    library: &apos;[name]&apos;
  },
  plugins: [
    new webpack.DllPlugin({
      name: &apos;[name]&apos;,
      // 用这个插件来分析打包后的这个库，把库里的第三方映射关系放在了这个 json 的文件下，这个文件在 dll 目录下
      path: path.resolve(__dirname, &apos;../dll/[name].manifest.json&apos;)
    })
  ]
}
复制代码
</code></pre><p>保存后重新打包 dll，<code>npm run build:dll</code><br><img src="data:image/svg+xml;utf8,&lt;?xml version=&quot;1.0&quot;?&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot; width=&quot;991&quot; height=&quot;305&quot;&gt;&lt;/svg&gt;" alt=""><br>修改 webpack.base.conf.js 文件，添加 <strong>webpack.DllReferencePlugin</strong> 插件</p>
<pre><code>module.exports = {
  plugins: [
    // 引入我们打包后的映射文件new webpack.DllReferencePlugin({
      manifest: path.resolve(__dirname, &apos;../dll/vendors.manifest.json&apos;)
    })
  ]
}
复制代码
</code></pre><p>之后再 webpack 打包的时候，就可以结合之前的全局变量 <strong>vendors</strong> 和 这个新生成的 <strong>vendors.manifest.json</strong> 映射文件，然后来对我们的源代码进行分析，一旦分析出使用第三方库是在 <strong>vendors.dll.js</strong> 里，就会去使用 <strong>vendors.dll.js</strong>，不会去使用 <strong>/node_modules/</strong> 里的第三方库了</p>
<p>再次打包 <code>npm run build</code>，可以把 <strong>webpack.DllReferencePlugin</strong> 模块注释后再打包对比一下</p>
<p>注释前 4000ms 左右，注释后 4300ms 左右，虽然只是快了 300ms，但是我们目前只是实验性的 demo，实际项目中，比如拿 vue 来说，vue，vue-router，vuex，element-ui，axios 等第三方库都可以打包到 dll.js 里，那个时候的打包速度就能提升很多了</p>
<p>还可以继续拆分，修改 webpack.dll.js 文件</p>
<pre><code>const path = require(&apos;path&apos;)
const webpack = require(&apos;webpack&apos;)

module.exports = {
  mode: &apos;production&apos;,
  entry: {
    lodash: [&apos;lodash&apos;],
    jquery: [&apos;jquery&apos;]
  },
  output: {
    filename: &apos;[name].dll.js&apos;,
    path: path.resolve(__dirname, &apos;../dll&apos;),
    library: &apos;[name]&apos;
  },
  plugins: [
    new webpack.DllPlugin({
      name: &apos;[name]&apos;,
      path: path.resolve(__dirname, &apos;../dll/[name].manifest.json&apos;) // 用这个插件来分析打包后的这个库，把库里的第三方映射关系放在了这个 json 的文件下，这个文件在 dll 目录下
    })
  ]
}
复制代码
</code></pre><p>运行 <code>npm run build:dll</code><br><img src="data:image/svg+xml;utf8,&lt;?xml version=&quot;1.0&quot;?&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot; width=&quot;837&quot; height=&quot;329&quot;&gt;&lt;/svg&gt;" alt=""><br>可以把之前打包的 <strong>vendors.dll.js</strong> 和 <strong>vendors.manifest.json</strong> 映射文件给删除掉</p>
<p>然后再修改 webpack.base.conf.js</p>
<pre><code>module.exports = {
  plugins: [
    new AddAssetHtmlWebpackPlugin({
      filepath: path.resolve(__dirname, &apos;../dll/lodash.dll.js&apos;)
    }),
    new AddAssetHtmlWebpackPlugin({
      filepath: path.resolve(__dirname, &apos;../dll/jquery.dll.js&apos;)
    }),
    new webpack.DllReferencePlugin({
      manifest: path.resolve(__dirname, &apos;../dll/lodash.manifest.json&apos;)
    }),
    new webpack.DllReferencePlugin({
      manifest: path.resolve(__dirname, &apos;../dll/jquery.manifest.json&apos;)
    })
  ]
}
复制代码
</code></pre><p>保存后运行 <code>npm run dev</code>，看看能不能成功运行<br><img src="data:image/svg+xml;utf8,&lt;?xml version=&quot;1.0&quot;?&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot; width=&quot;1192&quot; height=&quot;593&quot;&gt;&lt;/svg&gt;" alt=""><br>这还只是拆分了两个第三方模块，就要一个个配置过去，有没有什么办法能简便一点呢? 有!</p>
<p>这里使用 node 的 api，fs 模块来读取文件夹里的内容，创建一个 plugins 数组用来存放公共的插件</p>
<pre><code>const fs = require(&apos;fs&apos;)

const plugins = [
  // 开发环境和生产环境二者均需要的插件new HtmlWebpackPlugin({
    title: &apos;webpack4 实战&apos;,
    filename: &apos;index.html&apos;,
    template: path.resolve(__dirname, &apos;..&apos;, &apos;index.html&apos;),
    minify: {
      collapseWhitespace: true
    }
  }),
  new webpack.ProvidePlugin({ $: &apos;jquery&apos; })
]

const files = fs.readdirSync(path.resolve(__dirname, &apos;../dll&apos;))
console.log(files)
复制代码
</code></pre><p>写完可以先输出一下，把 plugins 给注释掉，<code>npm run build</code> 打包看看输出的内容，可以看到文件夹中的内容以数组的形式被打印出来了，之后我们对这个数组做一些循环操作就行了<br><img src="data:image/svg+xml;utf8,&lt;?xml version=&quot;1.0&quot;?&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot; width=&quot;691&quot; height=&quot;862&quot;&gt;&lt;/svg&gt;" alt=""><br>完整代码：</p>
<pre><code>const path = require(&apos;path&apos;)
const fs = require(&apos;fs&apos;)
const webpack = require(&apos;webpack&apos;)
const HtmlWebpackPlugin = require(&apos;html-webpack-plugin&apos;)
const AddAssetHtmlWebpackPlugin = require(&apos;add-asset-html-webpack-plugin&apos;)

// 存放公共插件const plugins = [
  // 开发环境和生产环境二者均需要的插件new HtmlWebpackPlugin({
    title: &apos;webpack4 实战&apos;,
    filename: &apos;index.html&apos;,
    template: path.resolve(__dirname, &apos;..&apos;, &apos;index.html&apos;),
    minify: {
      collapseWhitespace: true
    }
  }),
  new webpack.ProvidePlugin({ $: &apos;jquery&apos; })
]

// 自动引入 dll 中的文件const files = fs.readdirSync(path.resolve(__dirname, &apos;../dll&apos;))
files.forEach(file =&gt; {
  if (/.*\.dll.js/.test(file)) {
    plugins.push(
      new AddAssetHtmlWebpackPlugin({
        filepath: path.resolve(__dirname, &apos;../dll&apos;, file)
      })
    )
  }
  if (/.*\.manifest.json/.test(file)) {
    plugins.push(
      new webpack.DllReferencePlugin({
        manifest: path.resolve(__dirname, &apos;../dll&apos;, file)
      })
    )
  }
})

module.exports = {
  entry: {
    app: &apos;./src/app.js&apos;
  },
  output: {
    path: path.resolve(__dirname, &apos;..&apos;, &apos;dist&apos;)
  },
  module: {
    rules: [
      {
        test: /\.js$/,
        exclude: /node_modules/,
        use: [
          {
            loader: &apos;babel-loader&apos;
          }
        ]
      },
      {
        test: /\.(png|jpg|jpeg|gif)$/,
        use: [
          {
            loader: &apos;url-loader&apos;,
            options: {
              name: &apos;[name]-[hash:5].min.[ext]&apos;,
              limit: 1000, // size &lt;= 1KB
              outputPath: &apos;images/&apos;
            }
          },
          // img-loader for zip img
          {
            loader: &apos;image-webpack-loader&apos;,
            options: {
              // 压缩 jpg/jpeg 图片
              mozjpeg: {
                progressive: true,
                quality: 65// 压缩率
              },
              // 压缩 png 图片
              pngquant: {
                quality: &apos;65-90&apos;,
                speed: 4
              }
            }
          }
        ]
      },
      {
        test: /\.(eot|ttf|svg)$/,
        use: {
          loader: &apos;url-loader&apos;,
          options: {
            name: &apos;[name]-[hash:5].min.[ext]&apos;,
            limit: 5000, // fonts file size &lt;= 5KB, use &apos;base64&apos;; else, output svg file
            publicPath: &apos;fonts/&apos;,
            outputPath: &apos;fonts/&apos;
          }
        }
      }
    ]
  },
  plugins,
  performance: false
}
复制代码
</code></pre><p>使用 <code>npm run dev</code> 打开网页也没有问题了，这样自动注入 dll 文件也搞定了，之后还要再打包第三方库只要添加到 <strong>webpack.dll.js</strong> 里面的 <code>entry</code> 属性中就可以了</p>
<h1 id="二十一、多页面打包配置"><a href="#二十一、多页面打包配置" class="headerlink" title="二十一、多页面打包配置"></a>二十一、多页面打包配置</h1><p><a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2FITxiaohao%2Fwebpack4-learn%2Ftree%2Fmaster%2Fdemo21" target="_blank" rel="noopener">demo21 源码地址</a></p>
<p>本节使用 <a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2FITxiaohao%2Fwebpack4-learn%2Ftree%2Fmaster%2Fdemo20" target="_blank" rel="noopener">demo20</a> 的代码为基础</p>
<p>在 src 目录下新建 list.js 文件，里面写 <code>console.log(&#39;这里是 list 页面&#39;)</code><br><img src="data:image/svg+xml;utf8,&lt;?xml version=&quot;1.0&quot;?&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot; width=&quot;354&quot; height=&quot;366&quot;&gt;&lt;/svg&gt;" alt=""><br>在 webpack.base.conf.js 中配置 entry，配置两个入口</p>
<pre><code>module.exports = {
  entry: {
    app: &apos;./src/app.js&apos;,
    list: &apos;./src/list.js&apos;
  }
}
复制代码
</code></pre><p>如果现在我们直接 <code>npm run build</code> 打包，在打包自动生成的 index.html 文件中会发现 list.js 也被引入了，说明多入口打包成功，但并没有实现<strong>多个页面</strong>的打包，我想打包出 <strong>index.html</strong> 和 <strong>list.html</strong> 两个页面，并且在 index.html 中引入 <strong>app.js</strong>，在 list.html 中引入 <strong>list.js</strong>，该怎么做?</p>
<p>为了方便演示，先将 <code>webpack.prod.conf.js</code> 中 <code>cacheGroups</code> 新增一个 <code>default</code> 属性，自定义 name</p>
<pre><code>optimization: {
  splitChunks: {
    chunks: &apos;all&apos;,
    cacheGroups: {
      jquery: {
        name: &apos;jquery&apos;, // 单独将 jquery 拆包
        priority: 15,
        test: /[\\/]node_modules[\\/]jquery[\\/]/
      },
      vendors: {
        test: /[\\/]node_modules[\\/]/,
        name: &apos;vendors&apos;
      },
      default: {
        name: &apos;code-segment&apos;
      }
    }
  }
}
复制代码
</code></pre><p>打开 <code>webpack.base.conf.js</code> 文件，将 <code>HtmlWebpackPlugin</code> 拷贝一份，使用 <code>chunks</code> 属性，将需要打包的模块对应写入</p>
<pre><code>// 存放公共插件
const plugins = [
  new HtmlWebpackPlugin({
    title: &apos;webpack4 实战&apos;,
    filename: &apos;index.html&apos;,
    template: path.resolve(__dirname, &apos;..&apos;, &apos;index.html&apos;),
    chunks: [&apos;app&apos;, &apos;vendors&apos;, &apos;code-segment&apos;, &apos;jquery&apos;, &apos;lodash&apos;]
  }),
  new HtmlWebpackPlugin({
    title: &apos;多页面打包&apos;,
    filename: &apos;list.html&apos;,
    template: path.resolve(__dirname, &apos;..&apos;, &apos;index.html&apos;),
    chunks: [&apos;list&apos;, &apos;vendors&apos;, &apos;code-segment&apos;, &apos;jquery&apos;, &apos;lodash&apos;]
  }),
  new CleanWebpackPlugin(),
  new webpack.ProvidePlugin({ $: &apos;jquery&apos; })
]
复制代码
</code></pre><p>打包后的 dist 目录下生成了两个 html<br><img src="data:image/svg+xml;utf8,&lt;?xml version=&quot;1.0&quot;?&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot; width=&quot;336&quot; height=&quot;304&quot;&gt;&lt;/svg&gt;" alt=""><br>打开 index.html 可以看到引入的是 app.js，而 list.html 引入的是 list.js，这就是 <code>HtmlWebpackPlugin</code> 插件的 <code>chunks</code> 属性，自定义引入的 js</p>
<p>如果要打包三个页面，再去 copy <code>HtmlWebpackPlugin</code>，通过在 entry 中配置，如果有四个，五个，这样手动的复制就比较麻烦了，可以写个方法自动生成 <code>HtmlWebpackPlugin</code> 配置</p>
<p>修改 <code>webpack.base.conf.js</code></p>
<pre><code>const path = require(&apos;path&apos;)
const fs = require(&apos;fs&apos;)
const webpack = require(&apos;webpack&apos;)
const HtmlWebpackPlugin = require(&apos;html-webpack-plugin&apos;)
const AddAssetHtmlWebpackPlugin = require(&apos;add-asset-html-webpack-plugin&apos;)
const CleanWebpackPlugin = require(&apos;clean-webpack-plugin&apos;)

const makePlugins = configs =&gt; {
  // 基础插件const plugins = [
    new CleanWebpackPlugin(),
    new webpack.ProvidePlugin({ $: &apos;jquery&apos; })
  ]

  // 根据 entry 自动生成 HtmlWebpackPlugin 配置，配置多页面Object.keys(configs.entry).forEach(item =&gt; {
    plugins.push(
      new HtmlWebpackPlugin({
        title: &apos;多页面配置&apos;,
        template: path.resolve(__dirname, &apos;..&apos;, &apos;index.html&apos;),
        filename: `${item}.html`,
        chunks: [item, &apos;vendors&apos;, &apos;code-segment&apos;, &apos;jquery&apos;, &apos;lodash&apos;]
      })
    )
  })

  // 自动引入 dll 中的文件const files = fs.readdirSync(path.resolve(__dirname, &apos;../dll&apos;))
  files.forEach(file =&gt; {
    if (/.*\.dll.js/.test(file)) {
      plugins.push(
        new AddAssetHtmlWebpackPlugin({
          filepath: path.resolve(__dirname, &apos;../dll&apos;, file)
        })
      )
    }
    if (/.*\.manifest.json/.test(file)) {
      plugins.push(
        new webpack.DllReferencePlugin({
          manifest: path.resolve(__dirname, &apos;../dll&apos;, file)
        })
      )
    }
  })

  return plugins
}

const configs = {
  entry: {
    index: &apos;./src/app.js&apos;,
    list: &apos;./src/list.js&apos;
  },
  output: {
    path: path.resolve(__dirname, &apos;..&apos;, &apos;dist&apos;)
  },
  module: {
    rules: [
      {
        test: /\.js$/,
        exclude: /node_modules/,
        use: [
          {
            loader: &apos;babel-loader&apos;
          }
        ]
      },
      {
        test: /\.(png|jpg|jpeg|gif)$/,
        use: [
          {
            loader: &apos;url-loader&apos;,
            options: {
              name: &apos;[name]-[hash:5].min.[ext]&apos;,
              limit: 1000, // size &lt;= 1KB
              outputPath: &apos;images/&apos;
            }
          },
          // img-loader for zip img
          {
            loader: &apos;image-webpack-loader&apos;,
            options: {
              // 压缩 jpg/jpeg 图片
              mozjpeg: {
                progressive: true,
                quality: 65// 压缩率
              },
              // 压缩 png 图片
              pngquant: {
                quality: &apos;65-90&apos;,
                speed: 4
              }
            }
          }
        ]
      },
      {
        test: /\.(eot|ttf|svg)$/,
        use: {
          loader: &apos;url-loader&apos;,
          options: {
            name: &apos;[name]-[hash:5].min.[ext]&apos;,
            limit: 5000, // fonts file size &lt;= 5KB, use &apos;base64&apos;; else, output svg file
            publicPath: &apos;fonts/&apos;,
            outputPath: &apos;fonts/&apos;
          }
        }
      }
    ]
  },
  performance: false
}

makePlugins(configs)

configs.plugins = makePlugins(configs)

module.exports = configs
复制代码
</code></pre><p>再次打包后效果相同，如果还要增加页面，只要在 entry 中再引入一个 js 文件作为入口即可</p>
<blockquote>
<p>多页面配置其实就是定义多个 entry，配合 htmlWebpackPlugin 生成多个 html 页面</p>
</blockquote>
<h1 id="二十二、编写-loader"><a href="#二十二、编写-loader" class="headerlink" title="二十二、编写 loader"></a>二十二、编写 loader</h1><p><a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2FITxiaohao%2Fwebpack4-learn%2Ftree%2Fmaster%2Fdemo22" target="_blank" rel="noopener">demo22 源码地址</a></p>
<p>新建文件夹，<code>npm init -y</code>，<code>npm i webpack webpack-cli -D</code>，新建 src/index.js，写入 <code>console.log(&#39;hello world&#39;)</code></p>
<p>新建 <code>loaders/replaceLoader.js</code> 文件</p>
<pre><code>module.exports = function(source) {
  return source.replace(&apos;world&apos;, &apos;loader&apos;)
}
复制代码
</code></pre><p>source 参数就是我们的源代码，这里是将源码中的 world 替换成 loader</p>
<p>新建 <code>webpack.config.js</code></p>
<pre><code>const path = require(&apos;path&apos;)

module.exports = {
  mode: &apos;development&apos;,
  entry: {
    main: &apos;./src/index.js&apos;
  },
  module: {
    rules: [
      {
        test: /.js/,
        use: [path.resolve(__dirname, &apos;./loaders/replaceLoader.js&apos;)] // 引入自定义 loader
      }
    ]
  },
  output: {
    path: path.resolve(__dirname, &apos;dist&apos;),
    filename: &apos;[name].js&apos;
  }
}
复制代码
</code></pre><p>目录结构：<br><img src="https://user-gold-cdn.xitu.io/2019/4/12/16a100244b7ee724?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""><br>打包后打开 dist/main.js 文件，在最底部可以看到 world 已经被改为了 loader，一个最简单的 loader 就写完了</p>
<p>添加 optiions 属性</p>
<pre><code>const path = require(&apos;path&apos;)

module.exports = {
  mode: &apos;development&apos;,
  entry: {
    main: &apos;./src/index.js&apos;
  },
  module: {
    rules: [
      {
        test: /.js/,
        use: [
          {
            loader: path.resolve(__dirname, &apos;./loaders/replaceLoader.js&apos;),
            options: {
              name: &apos;xh&apos;
            }
          }
        ]
      }
    ]
  },
  output: {
    path: path.resolve(__dirname, &apos;dist&apos;),
    filename: &apos;[name].js&apos;
  }
}
复制代码
</code></pre><p>修改 replaceLoader.js 文件，保存后打包，输出看看效果</p>
<pre><code>module.exports = function(source) {
  console.log(this.query)
  return source.replace(&apos;world&apos;, this.query.name)
}
复制代码
</code></pre><p><img src="https://user-gold-cdn.xitu.io/2019/4/12/16a100254212cdee?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""><br>打包后生成的文件也改为了 options 中定义的 name</p>
<p>更多的配置见官网 <a href="https://link.juejin.im?target=https%3A%2F%2Fwebpack.js.org%2Fapi%2Floaders%2F%23examples" target="_blank" rel="noopener">API</a>，找到 Loader Interface，里面有个 this.query<br><img src="https://user-gold-cdn.xitu.io/2019/4/12/16a100269c333e54?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""><br>如果你的 options 不是一个对象，而是按字符串形式写的话，可能会有一些问题，这里官方推荐使用 <a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fwebpack%2Floader-utils%23getoptions" target="_blank" rel="noopener">loader-utils</a> 来获取 options 中的内容</p>
<p>安装 <code>npm i loader-utils -D</code>，修改 replaceLoader.js</p>
<pre><code>const loaderUtils = require(&apos;loader-utils&apos;)

module.exports = function(source) {
  const options = loaderUtils.getOptions(this)
  console.log(options)
  return source.replace(&apos;world&apos;, options.name)
}
复制代码
</code></pre><p><code>console.log(options)</code> 与 <code>console.log(this.query)</code> 输出内容一致</p>
<p>如果你想传递额外的信息出去，return 就不好用了，官网给我们提供了 <a href="https://link.juejin.im?target=https%3A%2F%2Fwebpack.js.org%2Fapi%2Floaders%2F%23thiscallback" target="_blank" rel="noopener">this.callback</a> API，用法如下</p>
<pre><code>this.callback(
  err: Error | null,
  content: string | Buffer,
  sourceMap?: SourceMap,
  meta?: any
)
复制代码
</code></pre><p>修改 replaceLoader.js</p>
<pre><code>const loaderUtils = require(&apos;loader-utils&apos;)

module.exports = function(source) {
  const options = loaderUtils.getOptions(this)
  const result = source.replace(&apos;world&apos;, options.name)

  this.callback(null, result)
}
复制代码
</code></pre><p>目前没有用到 sourceMap(必须是此模块可解析的源映射)、meta(可以是任何内容(例如一些元数据)) 这两个可选参数，只将 result 返回回去，保存重新打包后，效果和 return 是一样的</p>
<p>如果在 loader 中写异步代码，会怎么样</p>
<pre><code>const loaderUtils = require(&apos;loader-utils&apos;)

module.exports = function(source) {
  const options = loaderUtils.getOptions(this)

  setTimeout(() =&gt; {
    const result = source.replace(&apos;world&apos;, options.name)
    return result
  }, 1000)
}
复制代码
</code></pre><p><img src="https://user-gold-cdn.xitu.io/2019/4/12/16a10025cd97aaf3?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""><br>报错 loader 没有返回，这里使用 <a href="https://link.juejin.im?target=https%3A%2F%2Fwebpack.js.org%2Fapi%2Floaders%2F%23thisasync" target="_blank" rel="noopener">this.async</a> 来写异步代码</p>
<pre><code>const loaderUtils = require(&apos;loader-utils&apos;)

module.exports = function(source) {
  const options = loaderUtils.getOptions(this)

  const callback = this.async()

  setTimeout(() =&gt; {
    const result = source.replace(&apos;world&apos;, options.name)
    callback(null, result)
  }, 1000)
}
复制代码
</code></pre><p>模拟一个同步 loader 和一个异步 loader</p>
<p>新建一个 <code>replaceLoaderAsync.js</code> 文件，将之前写的异步代码放入，修改 <code>replaceLoader.js</code> 为同步代码</p>
<pre><code>// replaceLoaderAsync.jsconst loaderUtils = require(&apos;loader-utils&apos;)
module.exports = function(source) {
  const options = loaderUtils.getOptions(this)
  const callback = this.async()
  setTimeout(() =&gt; {
    const result = source.replace(&apos;world&apos;, options.name)
    callback(null, result)
  }, 1000)
}

// replaceLoader.jsmodule.exports = function(source) {
  return source.replace(&apos;xh&apos;, &apos;world&apos;)
}
复制代码
</code></pre><p>修改 <code>webpack.config.js</code>，loader 的执行顺序是从下到上，先执行异步代码，将 world 改为 xh，再执行同步代码，将 xh 改为 world</p>
<pre><code>module: {
  rules: [
    {
      test: /.js/,
      use: [
        {
          loader: path.resolve(__dirname, &apos;./loaders/replaceLoader.js&apos;)
        },
        {
          loader: path.resolve(__dirname, &apos;./loaders/replaceLoaderAsync.js&apos;),
          options: {
            name: &apos;xh&apos;
          }
        }
      ]
    }
  ]
}
复制代码
</code></pre><p>保存后打包，在 mian.js 中可以看到已经改为了 <code>hello world</code>，使用多个 loader 也完成了</p>
<p>如果有多个自定义 loader，每次都通过 <code>path.resolve(__dirname, xxx)</code> 这种方式去写，有没有更好的方法？</p>
<p>使用 <code>resolveLoader</code>，定义 modules，当你使用 loader 的时候，会先去 <code>node_modules</code> 中去找，如果没找到就会去 <code>./loaders</code> 中找</p>
<pre><code>const path = require(&apos;path&apos;)

module.exports = {
  mode: &apos;development&apos;,
  entry: {
    main: &apos;./src/index.js&apos;
  },
  resolveLoader: {
    modules: [&apos;node_modules&apos;, &apos;./loaders&apos;]
  },
  module: {
    rules: [
      {
        test: /.js/,
        use: [
          {
            loader: &apos;replaceLoader.js&apos;
          },
          {
            loader: &apos;replaceLoaderAsync.js&apos;,
            options: {
              name: &apos;xh&apos;
            }
          }
        ]
      }
    ]
  },
  output: {
    path: path.resolve(__dirname, &apos;dist&apos;),
    filename: &apos;[name].js&apos;
  }
}
复制代码
</code></pre><h1 id="二十三、编写-plugin"><a href="#二十三、编写-plugin" class="headerlink" title="二十三、编写 plugin"></a>二十三、编写 plugin</h1><p><a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2FITxiaohao%2Fwebpack4-learn%2Ftree%2Fmaster%2Fdemo23" target="_blank" rel="noopener">demo23 源码地址</a></p>
<p>首先新建一个文件夹，npm 起手式操作一番，具体的在前几节已经说了，不再赘述</p>
<p>在根目录下新建 plugins 文件夹，新建 <code>copyright-webpack-plugin.js</code>，一般我们用的都是 <code>xxx-webpack-plugin</code>，所以我们命名也按这样来，plugin 的定义是一个类</p>
<pre><code>classCopyrightWebpackPlugin{
  constructor() {
    console.log(&apos;插件被使用了&apos;)
  }
  apply(compiler) {}
}

module.exports = CopyrightWebpackPlugin
复制代码
</code></pre><p>在 webpack.config.js 中使用，所以每次使用 plugin 都要使用 <strong>new</strong>，因为本质上 plugin 是一个类</p>
<pre><code>const path = require(&apos;path&apos;)
const CopyrightWebpackPlugin = require(&apos;./plugins/copyright-webpack-plugin&apos;)

module.exports = {
  mode: &apos;development&apos;,
  entry: {
    main: &apos;./src/index.js&apos;
  },
  plugins: [new CopyrightWebpackPlugin()],
  output: {
    path: path.resolve(__dirname, &apos;dist&apos;),
    filename: &apos;[name].js&apos;
  }
}
复制代码
</code></pre><p>保存后打包，插件被使用了，只不过我们什么都没干<br><img src="data:image/svg+xml;utf8,&lt;?xml version=&quot;1.0&quot;?&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot; width=&quot;550&quot; height=&quot;247&quot;&gt;&lt;/svg&gt;" alt=""><br>如果我们要传递参数，可以这样</p>
<pre><code>new CopyrightWebpackPlugin({
  name: &apos;xh&apos;
})
复制代码
</code></pre><p>同时在 <code>copyright-webpack-plugin.js</code> 中接收</p>
<pre><code>classCopyrightWebpackPlugin{
  constructor(options) {
    console.log(&apos;插件被使用了&apos;)
    console.log(&apos;options = &apos;, options)
  }
  apply(compiler) {}
}

module.exports = CopyrightWebpackPlugin
复制代码
</code></pre><p><img src="data:image/svg+xml;utf8,&lt;?xml version=&quot;1.0&quot;?&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot; width=&quot;593&quot; height=&quot;258&quot;&gt;&lt;/svg&gt;" alt=""><br>我们先把 <strong>constructor</strong> 注释掉，在即将要把打包的结果，<strong>放入 dist 目录之前</strong>的这个时刻，我们来做一些操作</p>
<p><code>apply(compiler) {}</code> compiler 可以看作是 webpack 的实例，具体见官网 <a href="https://link.juejin.im?target=https%3A%2F%2Fwebpack.js.org%2Fapi%2Fcompiler-hooks" target="_blank" rel="noopener">compiler-hooks</a></p>
<p>hooks 是钩子，像 vue、react 的生命周期一样，找到 <code>emit</code> 这个时刻，将打包结果放入 dist 目录前执行，这里是个 <code>AsyncSeriesHook</code> 异步方法<br><img src="data:image/svg+xml;utf8,&lt;?xml version=&quot;1.0&quot;?&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot; width=&quot;1029&quot; height=&quot;719&quot;&gt;&lt;/svg&gt;" alt=""><br>    class CopyrightWebpackPlugin {<br>      apply(compiler) {<br>        compiler.hooks.emit.tapAsync(<br>          ‘CopyrightWebpackPlugin’,<br>          (compilation, cb) =&gt; {<br>            console.log(11)<br>            cb()<br>          }<br>        )<br>      }<br>    }</p>
<pre><code>module.exports = CopyrightWebpackPlugin
复制代码
</code></pre><p>因为 <strong>emit</strong> 是<strong>异步</strong>的，可以通过 <strong>tapAsync</strong> 来写，当要把代码放入到 dist 目录之前，就会触发这个钩子，走到我们定义的函数里，如果你用 <strong>tapAsync</strong> 函数，记得最后要用 <strong>cb()</strong> ，tapAsync 要传递两个参数，第一个参数传递我们定义的插件名称</p>
<p>保存后再次打包，我们写的内容也输出了<br><img src="data:image/svg+xml;utf8,&lt;?xml version=&quot;1.0&quot;?&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot; width=&quot;563&quot; height=&quot;245&quot;&gt;&lt;/svg&gt;" alt=""><br><strong>compilation</strong> 这个参数里存放了这次打包的所有内容，可以输出一下 <code>compilation.assets</code> 看一下<br><img src="data:image/svg+xml;utf8,&lt;?xml version=&quot;1.0&quot;?&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot; width=&quot;621&quot; height=&quot;365&quot;&gt;&lt;/svg&gt;" alt=""><br>返回结果是一个对象，<code>main.js</code> 是 key，也就是打包后生成的文件名及文件后缀，我们可以来仿照一下</p>
<pre><code>classCopyrightWebpackPlugin{
  apply(compiler) {
    compiler.hooks.emit.tapAsync(
      &apos;CopyrightWebpackPlugin&apos;,
      (compilation, cb) =&gt; {
        // 生成一个 copyright.txt 文件
        compilation.assets[&apos;copyright.txt&apos;] = {
          source: function() {
            return&apos;copyright by xh&apos;
          },
          size: function() {
            return15// 上面 source 返回的字符长度
          }
        }
        console.log(&apos;compilation.assets = &apos;, compilation.assets)
        cb()
      }
    )
  }
}

module.exports = CopyrightWebpackPlugin
复制代码
</code></pre><p><img src="data:image/svg+xml;utf8,&lt;?xml version=&quot;1.0&quot;?&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot; width=&quot;679&quot; height=&quot;400&quot;&gt;&lt;/svg&gt;" alt=""><br>在 dist 目录下生成了 <code>copyright.txt</code> 文件</p>
<p>之前介绍的是异步钩子，现在使用同步钩子<br><img src="data:image/svg+xml;utf8,&lt;?xml version=&quot;1.0&quot;?&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot; width=&quot;901&quot; height=&quot;349&quot;&gt;&lt;/svg&gt;" alt=""><br>    classCopyrightWebpackPlugin{<br>      apply(compiler) {<br>        // 同步钩子<br>        compiler.hooks.compile.tap(‘CopyrightWebpackPlugin’, compilation =&gt; {<br>          console.log(‘compile’)<br>        })</p>
<pre><code>    // 异步钩子
    compiler.hooks.emit.tapAsync(
      &apos;CopyrightWebpackPlugin&apos;,
      (compilation, cb) =&gt; {
        compilation.assets[&apos;copyright.txt&apos;] = {
          source: function() {
            return&apos;copyright by xh&apos;
          },
          size: function() {
            return15// 字符长度
          }
        }
        console.log(&apos;compilation.assets = &apos;, compilation.assets)
        cb()
      }
    )
  }
}

module.exports = CopyrightWebpackPlugin
复制代码
</code></pre><h1 id="二十四、编写-Bundle"><a href="#二十四、编写-Bundle" class="headerlink" title="二十四、编写 Bundle"></a>二十四、编写 Bundle</h1><p><a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2FITxiaohao%2Fwebpack4-learn%2Ftree%2Fmaster%2Fdemo24" target="_blank" rel="noopener">demo24 源码地址</a></p>
<h2 id="模块分析"><a href="#模块分析" class="headerlink" title="模块分析"></a>模块分析</h2><p>在 src 目录下新建三个文件 <code>word.js</code>、<code>message.js</code>、<code>index.js</code>，对应的代码：</p>
<pre><code>// word.jsexportconst word = &apos;hello&apos;// message.jsimport { word } from&apos;./word.js&apos;const message = `say ${word}`exportdefault message

// index.jsimport message from&apos;./message.js&apos;console.log(message)
复制代码
</code></pre><p>新建 <code>bundle.js</code></p>
<pre><code>const fs = require(&apos;fs&apos;)

const moduleAnalyser = filename =&gt; {
  const content = fs.readFileSync(filename, &apos;utf-8&apos;)
  console.log(content)
}

moduleAnalyser(&apos;./src/index.js&apos;)
复制代码
</code></pre><p>使用 node 的 <strong>fs</strong> 模块，读取文件信息，并在控制台输出，这里全局安装一个插件，来显示代码高亮，<code>npm i cli-highlight -g</code>，运行 <code>node bundle.js | highlight</code><br><img src="data:image/svg+xml;utf8,&lt;?xml version=&quot;1.0&quot;?&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot; width=&quot;294&quot; height=&quot;74&quot;&gt;&lt;/svg&gt;" alt=""><br>index.js 中的代码已经被输出到控制台上，而且代码有高亮，方便阅读，读取入口文件信息就完成了</p>
<p>现在我们要读取 index.js 文件中使用的 message.js 依赖，<code>import message from &#39;./message.js&#39;</code></p>
<p>安装一个第三方插件 <code>npm i @babel/parser</code></p>
<p><a href="https://link.juejin.im?target=https%3A%2F%2Fbabeljs.io%2Fdocs%2Fen%2Fbabel-parser" target="_blank" rel="noopener">@babel/parser</a> 是 Babel 中使用的 JavaScript 解析器。</p>
<p>官网也提供了相应的示例代码，根据示例代码来仿照，修改我们的文件<br><img src="data:image/svg+xml;utf8,&lt;?xml version=&quot;1.0&quot;?&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot; width=&quot;834&quot; height=&quot;312&quot;&gt;&lt;/svg&gt;" alt=""><br>    const fs = require(‘fs’)<br>    const parser = require(‘@babel/parser’)</p>
<pre><code>const moduleAnalyser = filename =&gt; {
  const content = fs.readFileSync(filename, &apos;utf-8&apos;)
  console.log(
    parser.parse(content, {
      sourceType: &apos;module&apos;
    })
  )
}

moduleAnalyser(&apos;./src/index.js&apos;)
复制代码
</code></pre><p>我们使用的是 es6 的 module 语法，所以 <code>sourceType: &#39;module&#39;</code><br><img src="data:image/svg+xml;utf8,&lt;?xml version=&quot;1.0&quot;?&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot; width=&quot;818&quot; height=&quot;238&quot;&gt;&lt;/svg&gt;" alt=""><br>保存后运行，输出了 <a href="https://link.juejin.im?target=https%3A%2F%2Fsegmentfault.com%2Fa%2F1190000016231512" target="_blank" rel="noopener">AST (抽象语法树)</a>，里面有一个 body 字段，我们输出这个字段</p>
<pre><code>const fs = require(&apos;fs&apos;)
const parser = require(&apos;@babel/parser&apos;)

const moduleAnalyser = filename =&gt; {
  const content = fs.readFileSync(filename, &apos;utf-8&apos;)
  const ast = parser.parse(content, {
    sourceType: &apos;module&apos;
  })
  console.log(ast.program.body)
}

moduleAnalyser(&apos;./src/index.js&apos;)
复制代码
</code></pre><p>打印出了两个 Node 节点，第一个节点的 type 是 <strong>ImportDeclaration</strong>(引入的声明)，对照我们在 index.js 中写的 <code>import message from &#39;./message.js&#39;</code>，第二个节点的 type 是 <strong>ExpressionStatement</strong> (表达式的声明)，对照我们写的 <code>console.log(message)</code><br><img src="data:image/svg+xml;utf8,&lt;?xml version=&quot;1.0&quot;?&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot; width=&quot;565&quot; height=&quot;482&quot;&gt;&lt;/svg&gt;" alt=""><br>使用 babel 来帮我们生成抽象语法树，我们再导入 <code>import message1 from &#39;./message1.js&#39;</code> 再运行<br><img src="data:image/svg+xml;utf8,&lt;?xml version=&quot;1.0&quot;?&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot; width=&quot;517&quot; height=&quot;912&quot;&gt;&lt;/svg&gt;" alt=""><br>抽象语法树将我们的 js 代码转成了对象的形式，现在就可以遍历抽象语法树生成的节点对象中的 type，是否为 <code>ImportDeclaration</code>，就能找到代码中引入的依赖了</p>
<p>再借助一个工具 <code>npm i @babel/traverse</code></p>
<pre><code>const fs = require(&apos;fs&apos;)
const parser = require(&apos;@babel/parser&apos;)
const traverse = require(&apos;@babel/traverse&apos;).default

const moduleAnalyser = filename =&gt; {
  const content = fs.readFileSync(filename, &apos;utf-8&apos;)
  const ast = parser.parse(content, {
    sourceType: &apos;module&apos;
  })
  traverse(ast, {
    ImportDeclaration({ node }) {
      console.log(node)
    }
  })
}

moduleAnalyser(&apos;./src/index.js&apos;)
复制代码
</code></pre><p><img src="data:image/svg+xml;utf8,&lt;?xml version=&quot;1.0&quot;?&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot; width=&quot;554&quot; height=&quot;957&quot;&gt;&lt;/svg&gt;" alt=""><br>只打印了两个 <strong>ImportDeclaration</strong>，遍历结束，我们只需要取到依赖的文件名，在打印的内容中，每个节点都有个 <code>source</code> 属性，里面有个 <code>value</code> 字段，表示的就是文件路径及文件名</p>
<pre><code>const fs = require(&apos;fs&apos;)
const parser = require(&apos;@babel/parser&apos;)
const traverse = require(&apos;@babel/traverse&apos;).default

const moduleAnalyser = filename =&gt; {
  const content = fs.readFileSync(filename, &apos;utf-8&apos;)
  const ast = parser.parse(content, {
    sourceType: &apos;module&apos;
  })
  const dependencise = []
  traverse(ast, {
    ImportDeclaration({ node }) {
      dependencise.push(node.source.value)
    }
  })
  console.log(dependencise)
}

moduleAnalyser(&apos;./src/index.js&apos;)
复制代码
</code></pre><p>保存完重新运行，输出结果：</p>
<pre><code>[&apos;./message.js&apos;, &apos;./message1.js&apos;]
复制代码
</code></pre><p>这样就对入口文件的依赖分析就分析出来了，现在把 index.js 中引入的 <code>message1.js</code> 的依赖给删除，这里有个注意点，打印出来的文件路径是<strong>相对路径</strong>，相对于 <code>src/index.js</code> 文件，但是我们打包的时候不能是入口文件(index.js)的相对路径，而应该是<strong>根目录的相对路径</strong>(或者说是<strong>绝对路径</strong>)，借助 node 的 api，引入一个 path</p>
<pre><code>const fs = require(&apos;fs&apos;)
const path = require(&apos;path&apos;)
const parser = require(&apos;@babel/parser&apos;)
const traverse = require(&apos;@babel/traverse&apos;).default

const moduleAnalyser = filename =&gt; {
  const content = fs.readFileSync(filename, &apos;utf-8&apos;)
  const ast = parser.parse(content, {
    sourceType: &apos;module&apos;
  })
  const dependencise = []
  traverse(ast, {
    ImportDeclaration({ node }) {
      const dirname = path.dirname(filename)
      console.log(dirname)
      dependencise.push(node.source.value)
    }
  })
  // console.log(dependencise)
}

moduleAnalyser(&apos;./src/index.js&apos;)
复制代码
</code></pre><p>输出为 <code>./src</code>，继续修改</p>
<pre><code>ImportDeclaration({ node }) {
  const dirname = path.dirname(filename)
  const newFile = path.join(dirname, node.source.value)
  console.log(newFile)
  dependencise.push(node.source.value)
}
复制代码
</code></pre><p>输出为 <code>src\message.js</code></p>
<blockquote>
<p>windows 和 类 Unix(linux/mac)，路径是有区别的。windows 是用反斜杠 \ 分割目录或者文件的，而在类 Unix 的系统中是用的 <strong>/</strong>。</p>
</blockquote>
<p>由于我是 windows 系统，所以这里输出为 <code>src\message.js</code>，而类 Unix 输出的为 <code>src/message.js</code></p>
<p><code>.\src\message.js</code> 这个路径是我们真正打包时要用到的路径</p>
<pre><code>newFile .\src\message.js
[ &apos;.\\src\\message.js&apos; ]
复制代码
</code></pre><p>既存一个相对路径，又存一个绝对路径</p>
<pre><code>const fs = require(&apos;fs&apos;)
const path = require(&apos;path&apos;)
const parser = require(&apos;@babel/parser&apos;)
const traverse = require(&apos;@babel/traverse&apos;).default

const moduleAnalyser = filename =&gt; {
  const content = fs.readFileSync(filename, &apos;utf-8&apos;)
  const ast = parser.parse(content, {
    sourceType: &apos;module&apos;
  })
  const dependencise = {}
  traverse(ast, {
    ImportDeclaration({ node }) {
      const dirname = path.dirname(filename)
      const newFile = &apos;.\\&apos; + path.join(dirname, node.source.value)
      console.log(&apos;newFile&apos;, newFile)
      dependencise[node.source.value] = newFile
    }
  })
  console.log(dependencise)
  return {
    filename,
    dependencise
  }
}

moduleAnalyser(&apos;./src/index.js&apos;)
复制代码

newFile .\src\message.js
{ &apos;./message.js&apos;: &apos;.\\src\\message.js&apos; }
复制代码
</code></pre><p>因为我们写的代码是 es6，浏览器无法识别，还是需要 babel 来做转换</p>
<p><code>npm i @babel/core @babel/preset-env</code></p>
<pre><code>&apos;use strict&apos;var _message = _interopRequireDefault(require(&apos;./message.js&apos;))

function_interopRequireDefault(obj) {
  return obj &amp;&amp; obj.__esModule ? obj : { default: obj }
}

console.log(_message.default)
复制代码

const fs = require(&apos;fs&apos;)
const path = require(&apos;path&apos;)
const parser = require(&apos;@babel/parser&apos;)
const traverse = require(&apos;@babel/traverse&apos;).default
const babel = require(&apos;@babel/core&apos;)

const moduleAnalyser = filename =&gt; {
  const content = fs.readFileSync(filename, &apos;utf-8&apos;)
  const ast = parser.parse(content, {
    sourceType: &apos;module&apos;
  })
  const dependencise = {}
  traverse(ast, {
    ImportDeclaration({ node }) {
      const dirname = path.dirname(filename)
      const newFile = &apos;.\\&apos; + path.join(dirname, node.source.value)
      dependencise[node.source.value] = newFile
    }
  })
  const { code } = babel.transformFromAst(ast, null, {
    presets: [&apos;@babel/preset-env&apos;]
  })
  return {
    filename,
    dependencise,
    code
  }
}

const moduleInfo = moduleAnalyser(&apos;./src/index.js&apos;)
console.log(moduleInfo)
复制代码
</code></pre><p>分析的结果就在控制台上打印了</p>
<pre><code>{ filename: &apos;./src/index.js&apos;,
  dependencise: { &apos;./message.js&apos;: &apos;.\\src\\message.js&apos; },
  code:
   &apos;&quot;use strict&quot;;\n\nvar _message = _interopRequireDefault(require(&quot;./message.js&quot;));\n\nfunction _interopRequireDefault(obj) { return obj &amp;&amp; obj.__esModule ? obj : { default: obj }; }\n\nconsole.log(_message.default);&apos; }
复制代码
</code></pre><p>目前我们只对一个模块进行分析，接下来要对整个项目进行分析，所以我们先分析了入口文件，再分析入口文件中所使用的依赖</p>
<h4 id="依赖图谱"><a href="#依赖图谱" class="headerlink" title="依赖图谱"></a>依赖图谱</h4><p>创建一个函数来循环依赖并生成图谱</p>
<pre><code>// 依赖图谱const makeDependenciesGraph = entry =&gt; {
  const entryModule = moduleAnalyser(entry)
  const graphArray = [entryModule]
  for (let i = 0; i &lt; graphArray.length; i++) {
    const item = graphArray[i]
    const { dependencise } = item
    // 如果入口文件有依赖就去做循环依赖，对每一个依赖做分析if (dependencise) {
      for (const j in dependencise) {
        if (dependencise.hasOwnProperty(j)) {
          graphArray.push(moduleAnalyser(dependencise[j]))
        }
      }
    }
  }
  console.log(&apos;graphArray = &apos;, graphArray)
}
复制代码
</code></pre><p>将入口的依赖，依赖中的依赖全部都分析完放到 <strong>graphArray</strong> 中，控制台输出的打印结果<br><img src="data:image/svg+xml;utf8,&lt;?xml version=&quot;1.0&quot;?&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot; width=&quot;675&quot; height=&quot;267&quot;&gt;&lt;/svg&gt;" alt=""><br>可以看到 <strong>graphArray</strong> 中一共有三个对象，就是我们在项目中引入的三个文件，全部被分析出来了，为了方便阅读，我们创建一个 graph 对象，将分析的结果依次放入</p>
<pre><code>// 依赖图谱const makeDependenciesGraph = entry =&gt; {
  const entryModule = moduleAnalyser(entry)
  const graphArray = [entryModule]
  for (let i = 0; i &lt; graphArray.length; i++) {
    const item = graphArray[i]
    const { dependencise } = item
    // 如果入口文件有依赖就去做循环依赖，对每一个依赖做分析if (dependencise) {
      for (const j in dependencise) {
        if (dependencise.hasOwnProperty(j)) {
          graphArray.push(moduleAnalyser(dependencise[j]))
        }
      }
    }
  }
  // console.log(&apos;graphArray = &apos;, graphArray)// 创建一个对象，将分析后的结果放入const graph = {}
  graphArray.forEach(item =&gt; {
    graph[item.filename] = {
      dependencise: item.dependencise,
      code: item.code
    }
  })
  console.log(&apos;graph = &apos;, graph)
  return graph
}
复制代码
</code></pre><p>输出的 <strong>graph</strong> 为:<br><img src="data:image/svg+xml;utf8,&lt;?xml version=&quot;1.0&quot;?&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot; width=&quot;508&quot; height=&quot;268&quot;&gt;&lt;/svg&gt;" alt=""><br>最后在 <code>makeDependenciesGraph</code> 函数中将 <strong>graph</strong> 返回，赋值给 <strong>graphInfo</strong>，输出的结果和 graph 是一样的</p>
<pre><code>const graghInfo = makeDependenciesGraph(&apos;./src/index.js&apos;)
console.log(graghInfo)
复制代码
</code></pre><h2 id="生成代码"><a href="#生成代码" class="headerlink" title="生成代码"></a>生成代码</h2><p>现在已经拿到了所有代码生成的结果，现在我们借助 <strong>DependenciesGraph(依赖图谱)</strong> 来生成真正能在浏览器上运行的代码</p>
<p>最好放在一个大的闭包中来执行，<strong>避免污染全局环境</strong></p>
<pre><code>const generateCode = entry =&gt; {
  // makeDependenciesGraph 返回的是一个对象，需要转换成字符串const graph = JSON.stringify(makeDependenciesGraph(entry))
  return`
    (function (graph) {

    })(${graph})
  `
}

const code = generateCode(&apos;./src/index.js&apos;)
console.log(code)
复制代码
</code></pre><p><img src="data:image/svg+xml;utf8,&lt;?xml version=&quot;1.0&quot;?&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot; width=&quot;916&quot; height=&quot;197&quot;&gt;&lt;/svg&gt;" alt=""><br>我这里先把输出的 graph 代码格式化了一下，可以发现在 <code>index.js</code> 用到了 <code>require</code> 方法，<code>message.js</code> 中不仅用了 <code>require</code> 方法，还用 <code>exports</code> 对象，但是在浏览器中，这些都是不存在的，如果我们直接去执行，是会报错的</p>
<pre><code>let graph = {
  &apos;./src/index.js&apos;: {
    dependencise: { &apos;./message.js&apos;: &apos;.\\src\\message.js&apos; },
    code: `
      &quot;use strict&quot;;\n\n
       var _message = _interopRequireDefault(require(&quot;./message.js&quot;));\n\n
       function _interopRequireDefault(obj){ return obj &amp;&amp; obj.__esModule ? obj : { default: obj }; } \n\n
       console.log(_message.default);
      `
  },
  &apos;.\\src\\message.js&apos;: {
    dependencise: { &apos;./word.js&apos;: &apos;.\\src\\word.js&apos; },
    code:
      &apos;&quot;use strict&quot;;\n\nObject.defineProperty(exports, &quot;__esModule&quot;, {\n  value: true\n});\nexports.default = void 0;\n\nvar _word = require(&quot;./word.js&quot;);\n\nvar message = &quot;say &quot;.concat(_word.word);\nvar _default = message;\nexports.default = _default;&apos;
  },
  &apos;.\\src\\word.js&apos;: {
    dependencise: {},
    code:
      &apos;&quot;use strict&quot;;\n\nObject.defineProperty(exports, &quot;__esModule&quot;, {\n  value: true\n});\nexports.word = void 0;\nvar word = \&apos;hello\&apos;;\nexports.word = word;&apos;
  }
}
复制代码
</code></pre><p>接下来要去构造 require 方法和 exports 对象</p>
<pre><code>const generateCode = entry =&gt; {
  console.log(makeDependenciesGraph(entry))
  // makeDependenciesGraph 返回的是一个对象，需要转换成字符串const graph = JSON.stringify(makeDependenciesGraph(entry))
  return`
    (function (graph) {
      // 定义 require 方法
      function require(module) {

      };
      require(&apos;${entry}&apos;)
    })(${graph})
  `
}

const code = generateCode(&apos;./src/index.js&apos;)
console.log(code)
复制代码
</code></pre><p>graph 是依赖图谱，拿到 entry 后去执行 <code>./src/index.js</code> 中的 code，也就是下面高亮部分的代码，为了直观我把前面输出的 graph 代码拿下来参考：</p>
<pre><code>let graph = {
  &apos;./src/index.js&apos;: {
    dependencise: { &apos;./message.js&apos;: &apos;.\\src\\message.js&apos; },
    code: `
      &quot;use strict&quot;;\n\n
       var _message = _interopRequireDefault(require(&quot;./message.js&quot;));\n\n
       function _interopRequireDefault(obj){ return obj &amp;&amp; obj.__esModule ? obj : { default: obj }; } \n\n
       console.log(_message.default);
      `
  }
}
复制代码
</code></pre><p>为了让 code 中的代码执行，这里<strong>再使用一个闭包</strong>，让每一个模块里的代码放到闭包里来执行，这样模块的变量就不会影响到外部的变量</p>
<pre><code>return`
    (function (graph) {
      // 定义 require 方法
      function require(module) {
        (function (code) {
          eval(code)
        })(graph[module].code)
      };
      require(&apos;${entry}&apos;)
    })(${graph})
  `复制代码
</code></pre><p>闭包里传递的是 <code>graph[module].code</code>，现在 entry 也就是 <code>./src/index.js</code> 这个文件，会传给 require 中的 module 变量，实际上去找依赖图谱中 <code>./src/index.js</code> 对应的对象，然后再去找到 code 中对应的代码，也就是下面这段代码，被我格式化过，为了演示效果</p>
<pre><code>&apos;use strict&apos;var _message = _interopRequireDefault(require(&apos;./message.js&apos;))
function_interopRequireDefault(obj) {
  return obj &amp;&amp; obj.__esModule ? obj : { default: obj }
}
console.log(_message.default)
复制代码
</code></pre><p>但是我们会发现，这里 <code>_interopRequireDefault(require(&#39;./message.js&#39;))</code> 引入的是 <code>./message.js</code> 相对路径，等到第二次执行的时候，<code>require(module)</code> 这里的 <code>module</code> 对应的就是 <code>./message.js</code></p>
<p>它会到 graph 中去找 <code>./message.js</code> 下对应的 code，可是我们在 graph 中存的是 <code>&#39;.\\src\\message.js&#39;</code> 绝对路径，这样就会找不到对象</p>
<p>因为我们之前写代码的时候引入的是相对路径，现在我们要把相对路径转换成绝对路径才能正确执行，定义一个 localRequire 方法，这样当下次去找的时候就会走我们自己定义的 localRequire，其实就是一个相对路径转换的方法</p>
<pre><code>return`
    (function (graph) {
      // 定义 require 方法
      function require(module) {
        // 相对路径转换
        function localRequire(relativePath) {
          return require(graph[module].dependencise[relativePath])
        }
        (function (require, code) {
          eval(code)
        })(localRequire, graph[module].code)
      };
      require(&apos;${entry}&apos;)
    })(${graph})
  `复制代码
</code></pre><p>我们定义了 localRequire 方法，并把它传递到闭包里，当执行了 <code>eval(code)</code> 时执行了 <code>require</code> 方法，就不是执行外部的 <code>require(module)</code> 这个方法，而是执行我们传递进去的 localRequire 方法</p>
<p>我们在分析出的代码中是这样引入 <code>message.js</code> 的</p>
<p><code>var _message = _interopRequireDefault(require(&#39;./message.js&#39;))</code></p>
<p>这里调用了 <code>require(&#39;./message.js&#39;)</code>，就是我们上面写的 <code>require</code> 方法，也就是 <code>localRequire(relativePath)</code></p>
<p>所以 relativePath 就是 <code>&#39;./message.js&#39;</code></p>
<p>这个方法返回的是 <code>require(graph[module].dependencise[relativePath])</code></p>
<p>这里我把参数带进去，就是这样：</p>
<p><code>graph(&#39;./src/index.js&#39;).dependencise[&#39;./message.js&#39;]</code></p>
<pre><code>let graph = {
  &apos;./src/index.js&apos;: {
    dependencise: { &apos;./message.js&apos;: &apos;.\\src\\message.js&apos; },
    code: `
      &quot;use strict&quot;;\n\n
       var _message = _interopRequireDefault(require(&quot;./message.js&quot;));\n\n
       function _interopRequireDefault(obj){ return obj &amp;&amp; obj.__esModule ? obj : { default: obj }; } \n\n
       console.log(_message.default);
      `
  }
}
复制代码
</code></pre><p>对照着图谱就能发现最终返回的就是 <code>&#39;.\\src\\message.js&#39;</code> 绝对路径，返回绝对路径后，我们再调用 <code>require(graph(&#39;./src/index.js&#39;).dependencise[&#39;./message.js&#39;])</code> 就是执行外部定义的 <code>require(module)</code> 这个方法，重新递归的去执行，光这样还不够，这只是实现了 require 方法，还差 exports 对象，所以我们再定义一个 exports 对象</p>
<pre><code>return`
    (function (graph) {
      // 定义 require 方法
      function require(module) {
        // 相对路径转换
        function localRequire(relativePath) {
          return require(graph[module].dependencise[relativePath])
        }
        var exports = {};
        (function (require, exports, code) {
          eval(code)
        })(localRequire, exports, graph[module].code)
        return exports
      };
      require(&apos;${entry}&apos;)
    })(${graph})
  `复制代码
</code></pre><p>最后要记得 <code>return exports</code> 将 exports 导出，这样下一个模块在引入这个模块的时候才能拿到导出的结果，现在代码生成的流程就写完了，最终返回的是一个大的字符串，保存再次运行 <code>node bundle.js | highlight</code><br><img src="data:image/svg+xml;utf8,&lt;?xml version=&quot;1.0&quot;?&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot; width=&quot;918&quot; height=&quot;403&quot;&gt;&lt;/svg&gt;" alt=""><br>这里我是 windows 环境，将输出完的代码直接放到浏览器里不行，我就把压缩的代码格式化成下面这种样子，再放到浏览器里就能输出成功了</p>
<pre><code>;(function(graph) {
  functionrequire(module) {
    functionlocalRequire(relativePath) {
      returnrequire(graph[module].dependencise[relativePath])
    }
    var exports = {}
    ;(function(require, exports, code) {
      eval(code)
    })(localRequire, exports, graph[module].code)
    return exports
  }
  require(&apos;./src/index.js&apos;)
})({
  &apos;./src/index.js&apos;: {
    dependencise: { &apos;./message.js&apos;: &apos;.\\src\\message.js&apos; },
    code:
      &apos;&quot;use strict&quot;;\n\nvar _message = _interopRequireDefault(require(&quot;./message.js&quot;));\n\nfunction _interopRequireDefault(obj) { return obj &amp;&amp; obj.__esModule ? obj : { default: obj }; }\n\nconsole.log(_message.default);&apos;
  },
  &apos;.\\src\\message.js&apos;: {
    dependencise: { &apos;./word.js&apos;: &apos;.\\src\\word.js&apos; },
    code:
      &apos;&quot;use strict&quot;;\n\nObject.defineProperty(exports, &quot;__esModule&quot;, {\n  value: true\n});\nexports.default = void 0;\n\nvar _word = require(&quot;./word.js&quot;);\n\nvar message = &quot;say &quot;.concat(_word.word);\nvar _default = message;\nexports.default = _default;&apos;
  },
  &apos;.\\src\\word.js&apos;: {
    dependencise: {},
    code:
      &apos;&quot;use strict&quot;;\n\nObject.defineProperty(exports, &quot;__esModule&quot;, {\n  value: true\n});\nexports.word = void 0;\nvar word = \&apos;hello\&apos;;\nexports.word = word;&apos;
  }
})
复制代码
</code></pre><p>将上面代码放入浏览器的控制台中，回车就能输出 <code>say hello</code><br><img src="data:image/svg+xml;utf8,&lt;?xml version=&quot;1.0&quot;?&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot; width=&quot;565&quot; height=&quot;631&quot;&gt;&lt;/svg&gt;" alt=""></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这就是打包工具打包后的内容，期间涉及了 node 知识，使用 babel 来转译 ast(抽象语法树)，最后的 generateCode 函数涉及到了<strong>递归</strong>和<strong>闭包</strong>，<strong>形参</strong>和<strong>实参</strong>，需要大家多看几遍，加深理解</p>
<h1 id="To-Be-Continued"><a href="#To-Be-Continued" class="headerlink" title="To Be Continued"></a>To Be Continued</h1><h1 id="个人博客"><a href="#个人博客" class="headerlink" title="个人博客"></a><a href="https://link.juejin.im?target=https%3A%2F%2Fitxiaohao.github.io%2F" target="_blank" rel="noopener">个人博客</a></h1><h1 id="24-个实例入门并掌握「Webpack4」-一"><a href="#24-个实例入门并掌握「Webpack4」-一" class="headerlink" title="24 个实例入门并掌握「Webpack4」(一)"></a><a href="https://juejin.im/post/5cae0f616fb9a068a93f0613" target="_blank" rel="noopener">24 个实例入门并掌握「Webpack4」(一)</a></h1><h1 id="24-个实例入门并掌握「Webpack4」-二"><a href="#24-个实例入门并掌握「Webpack4」-二" class="headerlink" title="24 个实例入门并掌握「Webpack4」(二)"></a><a href="https://juejin.im/post/5cb01ab0e51d456e3428c0ca" target="_blank" rel="noopener">24 个实例入门并掌握「Webpack4」(二)</a></h1>
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/03/31/HTTP缓存机制及原理/" rel="next" title="HTTP缓存机制及原理">
                <i class="fa fa-chevron-left"></i> HTTP缓存机制及原理
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/tx.jpg" alt="李斌">
            
              <p class="site-author-name" itemprop="name">李斌</p>
              <p class="site-description motion-element" itemprop="description">想要飞得高，那就把地平线忘掉</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">151</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">106</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/libin1991" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://juejin.im/user/57e737f6c4c971005f6bcd8d" target="_blank" title="juejin">
                      
                        <i class="fa fa-fw fa-spinner"></i>juejin</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#十七、PWA-配置"><span class="nav-number">1.</span> <span class="nav-text">十七、PWA 配置</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#十八、TypeScript-配置"><span class="nav-number">2.</span> <span class="nav-text">十八、TypeScript 配置</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#引入第三方库"><span class="nav-number">2.1.</span> <span class="nav-text">引入第三方库</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#十九、Eslint-配置"><span class="nav-number">3.</span> <span class="nav-text">十九、Eslint 配置</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#二十、使用-DLLPlugin-加快打包速度"><span class="nav-number">4.</span> <span class="nav-text">二十、使用 DLLPlugin 加快打包速度</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#二十一、多页面打包配置"><span class="nav-number">5.</span> <span class="nav-text">二十一、多页面打包配置</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#二十二、编写-loader"><span class="nav-number">6.</span> <span class="nav-text">二十二、编写 loader</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#二十三、编写-plugin"><span class="nav-number">7.</span> <span class="nav-text">二十三、编写 plugin</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#二十四、编写-Bundle"><span class="nav-number">8.</span> <span class="nav-text">二十四、编写 Bundle</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#模块分析"><span class="nav-number">8.1.</span> <span class="nav-text">模块分析</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#依赖图谱"><span class="nav-number">8.1.0.1.</span> <span class="nav-text">依赖图谱</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#生成代码"><span class="nav-number">8.2.</span> <span class="nav-text">生成代码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#总结"><span class="nav-number">8.3.</span> <span class="nav-text">总结</span></a></li></ol><li class="nav-item nav-level-1"><a class="nav-link" href="#To-Be-Continued"><span class="nav-number">9.</span> <span class="nav-text">To Be Continued</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#个人博客"><span class="nav-number">10.</span> <span class="nav-text">个人博客</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#24-个实例入门并掌握「Webpack4」-一"><span class="nav-number">11.</span> <span class="nav-text">24 个实例入门并掌握「Webpack4」(一)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#24-个实例入门并掌握「Webpack4」-二"><span class="nav-number">12.</span> <span class="nav-text">24 个实例入门并掌握「Webpack4」(二)</span></a></li></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">李斌</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
<script type="text/javascript" src="/js/src/clicklove.js"></script>

